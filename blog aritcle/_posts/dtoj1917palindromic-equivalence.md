---
title: " DTOJ1917Palindromic Equivalence\t\t"
tags:
  - manacher
  - 并查集
url: 784.html
id: 784
categories:
  - DTOJ
  - Solution
date: 2018-02-26 15:44:24
---

先用manachar求出$S$中的回文串。考虑对$S'$的影响。 若$S$中$\[l,r\]$是一个中心在$mid$的回文串，那么对于$S'$的$(mid,r\]$，它们必须和$\[l,mid\]$相同，也就是被固定了。我们可以用并查集将它们并在一起。 对于没有被固定的位置，考虑它能有多少种取值。最多显然只有$26$种，这之中有些不合法的情况。不合法的情况即这个位置填这种字母会使得$S'$中有一个$S$中没有的回文串。发现出现不合法情况的位置只有可能在$r+1$，此时在这个位置填上和$l-1$一样的字母就会导致不合法。 我们对于每个$\[l,r\]$，从$r+1$向$l-1$连一条边，代表这两个位置不能相同。 因此我们从小到大枚举每个没有被固定的位置，通过当前位置向前面的连边判断有几种字母会导致不合法，就可以计算方案数了。 注意从一个位置连出去的多条边中，可能有多个位置被固定成相同的字母，因此要打个标记防止重复计算。