---
title: " DTOJ1877世界树\t\t"
tags:
  - 思路
  - 虚树
url: 5634.html
id: 5634
categories:
  - Solution
date: 2018-12-17 22:46:14
---

注意到要处理出单次询问的答案可以$O(n)$。这个效率是关于点数的。而总询问点数不会超过$3 \\times 10^5$。 这就需要应用虚树解决了。虚树中保留了原图的树形态及相对位置关系，但是仅有需要被利用到的关键点。考虑对于所有的关键点建出虚树。 接下来我们要考虑两个部分：虚树中边上的代价与外枝边上的代价。首先考虑第一部分： 对于虚树上的一条边$(u,v)$:假设这两个点都被同一个关键点控制，那么这条路径上所有点以及其子树都被这个关键点控制。否则，我们可以在其中二分一个$mid$，$(u,mid)$中点及其子树被$u$控制，$(mid,v)$中的点及其子树被$v$控制。这样找出代价最小的mid就好了。 另外有一部分，其子树未被考虑到。那么我们在虚树上dfs的过程中，每次将考虑到的部分从子树中扣掉，那么子树大小中剩下的就是未被考虑的代价。之后这些未被考虑的代价就可以被加到对应的关键点上了。