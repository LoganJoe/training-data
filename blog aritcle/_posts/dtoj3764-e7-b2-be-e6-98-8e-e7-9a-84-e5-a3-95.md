---
title: " DTOJ3764精明的壕\t\t"
tags:
  - 奇技淫巧
  - 线段树
url: 2597.html
id: 2597
categories:
  - DTOJ
  - Solution
  - 不会证
date: 2018-06-22 15:28:54
---

题意很乱，实际上就是对于一个询问$L,R$，找一对$l,r$，使得$L\\leqslant l\\leqslant r\\leqslant r$，且$\\frac{r-l+2-mex}{r-l+2+mex}$最小。 我们记要求的值为一个区间的$val$。容易发现，如果$mex$相等，区间长度越小$val$越小；如果区间长度相等，$mex$越大则$val$越小。 我们考虑固定一个值，然后找另一种的最值。 题解给出的做法是固定$mex$，不断缩小区间长度。我们要找出所有的极小区间，一个区间$\[l,r\]$被称为极小的，当前仅当区间缩小后$mex$会减小。 那么问题就是求出所有的极小区间。 发现当区间的左端点固定后，区间的$mex$随着右端点的右移而变大，即$mex$是单调不降的。我们可以把$mex$相同的分成一段，显然只有每段的最左边可能成为极小区间的右端点。同时要满足当前左端点右移一位时区间$mex$会变，即区间$mex$会被重新赋值。 考虑一种求区间$mex$的经典做法：先将询问离线，然后枚举左端点，用线段树维护右端点在每个位置时的$mex$。当左端点右移一位时，记左端点原来的数为$x$，只要将下一个$x$之前所有$mex>x$的位置改成$x$即可。由于$mex$单调不减，线段树上二分后区间赋值即可。 我们发现，这种做法可以求出，当左端点右移一位时哪些区间的$mex$会变。我们只要把这个范围内的每段$mex$的最左边取出来即可。 极小区间的个数是$\\Theta(n)$级别的（不会证）。因此可以乱搞。我是在线段树上每个结点都开了个vector存下每一段的信息，但其实二分查询每段是否相同好像就行了。 显然答案肯定是某个极小区间的$val$，那么这个问题就变成了一个简单的二维偏序问题了，离线+树状数组即可。