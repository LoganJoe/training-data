---
title: " DTOJ2692图样\t\t"
tags:
  - dp
url: 6374.html
id: 6374
categories:
  - Solution
date: 2019-02-07 15:59:19
---

容易发现任一种方案概率相同。那么我们只要考虑所有的生成树的权值和就好了。 记$f(n,m)$为$n$个点，点权在$\[0,2^m-1\]$内随机时，所有情况下的生成树权值和。我们二进制分类，根据第$m$位将点分为$\\mathrm{S}$和$\\mathrm{T}$两个集合。考虑$\\mathrm{S}$和$\\mathrm{T}$内部一定形成生成树。直接在$\\mathrm{S}$和$\\mathrm{T}$间找到一条最小边即可找到这个生成树。 我们枚举$\\mathrm{S}$和$\\mathrm{T}$中的点数。那么有 $$f(n,m)=\\sum_{i=1}^{m-1}\\binom{n}{i}\\left(f(i,m-1)+2^{i(m-1)}f(n-i,m-1) +2f(n,m-1)+2^{(n+1)(m-1)}+g(i,n-i,m-1)\\right)$$ 考虑如何求$g(S,T,m)$，这个表示两边分别有$S,T$个点，点权在$\[0,2^m-1\]$均匀随机时两边最小值的情况和。现在考虑如何求$g(S,T,m)$。 直接求感觉无从下手。令$h(S,T,m,k)$表示两边分别有$S,T$个点，点权在$\[0,2^m-1\]$均匀随机时，最小边$\\ge k$的方案数。那么：$g(S,T,m)=\\sum_{k=1}^{2^m-1}h(S,T,m,k)$ 类似的，我们仍然可以再根据第$m$位将点分为四部部分$\\mathrm{S0,S1,T0,T1}$。现在,最小边一定在$S0 \\to T0$或者$S1 \\to T1$之间。同样可以在枚举每部分的点转移： $$h(S,T,m,k)=\\sum_{i=0}^{S}\\sum_{j=0}^{T}\\binom{S}{i}\\binom{T}{j}h(i,j,m-1,k)h(S-i,T-j,m-1,k)$$ 于是可以三个记忆搜写过去。$O(n^42^m)$。