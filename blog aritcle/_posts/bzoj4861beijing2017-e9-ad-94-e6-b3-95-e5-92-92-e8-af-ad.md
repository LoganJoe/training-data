---
title: " BZOJ4861[Beijing2017]魔法咒语\t\t"
tags:
  - AC自动机
  - dp
  - 思路
  - 矩阵
url: 5804.html
id: 5804
categories:
  - BZOJ
  - Solution
date: 2018-12-24 23:01:46
---

我们对不能出现的串建AC自动机，那么如果一个串匹配到了单词的末尾结点或者末尾结点在fail树上的子树，就说明这个串是不合法的。 我们可以先把所有不合法的结点标记一下。 考虑在AC自动机上dp。 记$f\[i\]\[j\]$为当前串的长度为$i$，在AC自动机上匹配到了结点$j$的方案数。 记$a\[i\]\[j\]$为从AC自动记上第$i$个点出发，匹配第$j$个基本词汇到达的点。 那么有 $$f\[i\]\[j\]\\Rightarrow f\[i+len\[k\]\]\[a\[j\]\[k\]\]$$ 这就是暴力了，可以通过60%的数据。 考虑剩下40%。 此时基本词汇的长度只有$1$或$2$，那么$f\[i\]\[j\]$只可能对$f\[i+1\]\[k\]$或$f\[i+2\]\[k\]$有贡献。 我们可以把转移看作一个大小为AC自动机点数的矩阵，然后转移用矩阵快速幂优化即可。 数据范围没有写清楚，矩阵大小开到$200$能过。