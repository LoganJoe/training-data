---
title: " BZOJ3238[Ahoi2013]差异\t\t"
tags:
  - 后缀自动机
url: 5778.html
id: 5778
categories:
  - BZOJ
  - Solution
date: 2018-12-23 21:27:19
---

我们发现这个式子很像树上两点的距离。 将后缀放在树上，不就是后缀树吗？ 也就是说我们要求每对后缀在后缀树上的距离和。 我们将串反过来，建立后缀自动机，后缀自动机的parent树就是后缀树。 对于$len(T\_i)$和$len(T\_j)$我们可以单独拿出来算，现在我们只用考虑求$lcp(T\_i,T\_j)$，也就是求后缀树上的每个点作为$LCA$的次数。 后缀树上的一个点$x$，容易想到它的作为$LCA$的次数为$\\frac{t\[x\].right(t\[x\].right-1)}2$，其中$t\[x\].right$为这个点的$right$集合的大小。但是这样有可能算到$LCA$在它的子树内的情况，因此对于一个儿子$son$，贡献次数还要减去$\\frac{t\[son\].right(t\[son\].right-1)}2$。 算出贡献次数再乘上这个点表示的子串中最长的串的长度，加起来就是答案了。