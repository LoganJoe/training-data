---
title: " DTOJ2923Rally\t\t"
tags:
  - 思路
  - 拓扑序
  - 线段树
url: 5164.html
id: 5164
categories:
  - Solution
date: 2018-11-16 17:12:32
---

对于DAG，我们可以用拓扑排序求出最长路。于是我们对于每条边$(u,v)$，$f\[x\]$为该点到达该点的最长路径，$g\[x\]$为从该点出发的最长路径。那么经过这条边的最长路长度就为$f\[u\]+g\[v\]+1$。其中，$f\[x\]$可以通过建反边以后跑拓扑得到。

考虑删掉某个点，相当于去掉了与其所有连边的贡献。而删点以后对于其他最长路的贡献只长不短。

将图划分为2个点集$S,T$。那么初始所有点都在$T$集合内。考虑将点转移到$S$集合内。我们按照拓扑序移点，然后对于两个集合间所有点的连边，我们用权值线段树维护。线段树中每个位置保存该值有没有出现过。那么每当我们丢过去一个点，就直接枚举每条入边，在线段树上对应位置扣掉对应贡献，然后再枚举每条出边，在线段树上加上对应贡献。而查询删掉这个点的答案我们只需要在线段树上二分，找到最大值就可以了。