---
title: " DTOJ4091dist\t\t"
tags:
  - 思路
  - 最短路
url: 5881.html
id: 5881
categories:
  - DTOJ
  - Solution
date: 2018-12-30 22:32:57
---

我们把每个团看成一个点，经过每$i$个团的代价为$k\_i$，然后我们可以用Floyd算出从第$i$个团到第$j$个团的最小代价$val(i,j)$。 记$S\_x$为包含点$x$的团的集合，那么$x$到$y$的最短路就是$dist(x,y)=\\min\\{val(i,j)|i\\in S\_x,j\\in S\_y\\}$。 我们枚举$x$，考虑对于所有的$y$计算$dist(x,y)$。 我们将所有的团按照到$S\_x$中任意一个团的距离的最小值排序。 然后我们依次枚举每个团，计算这个团对答案的贡献。显然我们只用求出这个团中还未被计算过的点$y$的数量，也就是没有在之前的团中出现过的点的数量。 由于团的数量很少，我们可以用二进制数来状压$S\_x$。那么我们相当于求某个团中满足$S\_i$某些位一定$=0$的$i$的数量，$=0$的位置是在这个团之前的团。 这个东西我们可以预处理。记$cnt\_i$为当前团中$i$这些位上（$i$是一个二进制数表示状态）一定$=0$的点的个数。 $cnt_i$初始化后，有 $$ cnt\[i\]\\Rightarrow cnt\[i\\oplus 2^j\] $$ 其中，$\\oplus$表示异或，$j$是$i$二进制上为$1$的某一位。 为了避免重复计算，$j​$要在最外层按顺序枚举，比如从小到大。