---
title: " DTOJ3919树\t\t"
tags:
  - 点分治
url: 3977.html
id: 3977
categories:
  - Solution
date: 2018-09-16 21:08:51
---

看到这种树上路径计数问题很好想到点分治。考虑二分每个点的答案然后计算小于等于答案的路径条数。这样做单点是$nlog^2n$的效率。

但是这个计算可以一并计算出n个点的答案，于是我们每次一起二分$n$个点的答案然后跑一次点分治算出路径数以调整二分范围。

具体点分治的时候记重心到块内每个点的距离$dist\[x\]$，然后对于每个点算出大于$mid\[x\]-dist\[x\]$的$dist$个数。点分治的时候要先计算块内过重心的答案再扣掉同子树的过子树根的答案。

总共的时间效率大概是$O(n log^3 n)$。但是根本不满，因为第三个log是在子树内的点数的log，所以效率其实可以过的去。