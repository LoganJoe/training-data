---
title: " DTOJ3874Permutation\t\t"
tags:
  - 线段树
  - 贪心
url: 3633.html
id: 3633
categories:
  - DTOJ
  - Solution
date: 2018-08-26 21:34:28
---

由于要字典序最大，我们考虑贪心。 记$i$在$p\_i$中的位置为$pos\_i$。 先考虑$1$能连的点最大是什么。显然$1$连出去的点，要么是$p_{pos\_1+1}$，要么是$pos\_1$左边的某个数。 如果是$pos\_1$左边的某个数，说明从那个数到$pos\_1$形成了一个环，也就是说这些数连出去的点已经固定了。我们给这些固定的点打上一个标记。 如果是$p_{pos\_1+1}$，我们给这个数打上另一种标记，表示这个数和左边的数一定要在一个环中。 那么我们拿$pos\_1$左边的最大值和$p_{pos\_1+1}$比较，就能决定$1$连出去的点。 接着依次考虑$2\\sim n$，每次都考虑当前的数怎么连最优。 如果连$pos\_i$左边的某个数$x$，要保证$x$到$pos\_i$之间经过的数中没有已经被固定的。并且$x$不用和$x$左边的数在一个环中。 我们就是要找到合法的$x$的最大值。 我们可以用线段树维护。每个点维护区间的最大值。 如果有一段区间的数被固定了，我们给这段区间赋值为$\\infty$。 如果一个数要和左边的数在一个环中，我们给把这个数所在位置赋值为$0$。 要找$pos\_i$左边的最大值时，先在线段树上二分找到$pos\_i$往左第一个为$\\infty$的位置$a$，那么$a+1\\sim pos\_i$的最大值就是合法的最大值了。（因为要和左边的数在一个环的数已经被赋值为$0$，不会成为最大值了） 记下每个数的选择，最后输出方案即可。