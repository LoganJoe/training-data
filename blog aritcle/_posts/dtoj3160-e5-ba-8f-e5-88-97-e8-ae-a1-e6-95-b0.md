---
title: " DTOJ3160序列计数\t\t"
tags:
  - dp
  - 卷积
  - 容斥
url: 1739.html
id: 1739
categories:
  - DTOJ
  - Solution
date: 2018-04-26 14:19:35
---

这种“至少有一个”的题目，很容易想到容斥。考虑用所有序列个数减去不含质数的序列个数。 记$f\[i\]\[j\]$为长度为$i$且和$\\%p=j$的序列个数，$g\[i\]\[j\]$为长度为$i$且和$\\%p=j$的不含质数的序列个数。显然答案是$f\[n\]\[0\]-g\[n\]\[0\]$。 考虑转移。记$cnt1\[i\]$为$\\%p=i$的数字个数，$cnt2\[i\]$为$\\%p=i$的合数个数。 那么有 $$f\[i\]\[j\]\\times cnt1\[k\]\\rightarrow f\[i+1\]\[(j+k)\\%p\]$$ $$g\[i\]\[j\]\\times cnt2\[k\]\\rightarrow g\[i+1\]\[(j+k)\\%p\]$$ 显然$f\[i\],g\[i\],cnt1,cnt2$都是一个多项式，而转移就是循环卷积的形式。 那么快速幂加速一下卷积即可。由于模数不是质数不能用ntt优化，但是多项式长度为$100$，暴力乘不会出事。 网上题解一堆说矩阵乘优化看得我一脸懵逼，感觉就是把多项式的系数写成了矩阵……复杂度还多了个$p$。