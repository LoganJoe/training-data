---
title: " DTOJ2692图样\t\t"
tags:
  - dp
  - 期望
url: 835.html
id: 835
categories:
  - DTOJ
  - Solution
date: 2018-02-28 15:37:55
---

发现答案其实就是所有生成树的权值和再除以$2^{nm}$，即方案贡献总和除以方案数，因为每一种方案概率相同。 记$f\[n\]\[m\]$为$n$个点，点权为$\[0,2^m)$的随机值时所有情况的最小生成树的权值和。根据点权第$m$位为$0$或$1$将点分为$X$和$Y$两部分。那么$X$和$Y$内部的点一定分别形成了一棵生成树，只需要在$X$和$Y$中选择一条最小的边将两部分连起来。 枚举$X$和$Y$中的点数，我们有 $$f\[n\]\[m\]=\\sum_{i=1}^{n-1}C_{n}^{i}(2^{(n-i)(m-1)}f\[i\]\[m-1\]+2^{i(m-1)}f\[n-i\]\[m-1\]+g\[i\]\[n-i\]\[m-1\]+2^{(n+1)(m-1)})+2f\[n\]\[m-1\]$$ 其中$g\[x\]\[y\]\[m\]$表示一边有$x$个点，一边有$y$个点，点权为$\[0,2^m)$的随机值时所有情况两边的最小边的和。 解释一下这个式子，组合数是选点的方案，$2^{(n-i)(m-1)}$是$2^{(m-1)^{n-i}}$，即另一边点权随机取的方案数，$2^{i(m-1)}$同理。$2^{(n+1)(m-1)}$是$2^{(m-1)^n}2^{m-1}$，总的方案数乘上最小边的最高位的贡献。$f\[n\]\[m-1\]$即生成树第$m$位权值全部为$0$或全部为$1$的情况。 考虑如何求$g\[x\]\[y\]\[m\]$。 直接求不太好求。令$h\[x\]\[y\]\[m\]\[k\]$为一边有$x$个点，一边有$y$个点，点权为$\[0,2^m)$的随机值时最小边$\\geqslant k$的方案数。那么有 $$g\[x\]\[y\]\[m\]=\\sum_{k=1}^{2^m-1}h\[x\]\[y\]\[m\]\[k\]$$ 因为权值为$v$的最小边会被$h\[x\]\[y\]\[m\]\[k\](1\\leqslant k\\leqslant v)$计算到，共计算到$v$次。 考虑如何求$h\[x\]\[y\]\[m\]\[k\]$。 与求$f\[n\]\[m\]$类似，根据点权第$m$位为$0$或$1$将点分为$X0,X1,Y1,Y2$四部分。最小边一定是$X0$和$Y0$的边或者$X1$和$Y1$的边。如果没有这样的边，最小边第$m$位为$1$。同样枚举每个部分的点数转移，有 $$h\[x\]\[y\]\[m\]\[k\]=\\sum_{i=0}^{x}\\sum_{j=0}^{y}C_{x}^{i}C_{y}^{j}h\[i\]\[j\]\[m-1\]\[k\]\\times h\[x-i\]\[y-j\]\[k\]$$ $i=0$且$j=y$和$i=x$且$j=0$特殊考虑一下。 以上所有转移都要用记忆化搜索，否则可能被卡常。