---
title: " DTOJ3234航海舰队\t\t"
tags:
  - FFT
  - 卷积
  - 奇技淫巧
url: 2334.html
id: 2334
categories:
  - DTOJ
  - Solution
date: 2018-06-12 14:13:46
---

（OJ还没交 为了防止忘记 先写个题解） 假如我们知道了所有能放得下舰队的位置，我们只需要bfs一遍就能知道舰队能走到哪些位置。然后才能求出所有能达到的位置。 一个一个地解决问题。 先考虑求出所有能放下舰队的位置。 把最小的包含舰队的矩形拿出来，记大小为$p\\times q$。那么我们现在要求，对于大矩形里的每个$p\\times q$的子矩形，能放得下舰队。即舰队矩形为o的地方全不为#。 我们把舰队矩形为o的地方记为$1$，原图为#的地方也记为$1$，其他地方都为$0$。那么如果对应位置的值乘积和为$0$，这个子矩形就可以放得下舰队。 显然这是个二维FFT的问题。但是可以转成一维的来解决。（我至今不知道二维FFT怎么写（雾）） 我们把舰队矩形扩大到$n\\times m$，多余的位置全部为$0$。然后把这个矩形转成一维，即每行接在上一行的末尾，记转完后的字符串为$T$。然后我们把原图矩形也转成一维，记转完后的字符串为$S$。 设$(x,y)$在$S$中对于的位置为$a$，那么以$(x,y)$为左上角的子矩形能放得下舰队的条件就是 $$\\sum_{i=0}^{pq-1}S\[a+i\]\\times T\[i\]=0$$ 显然将$S$或$T$反转一下，就是一个卷积的形式。FFT乘一下，判断每位是否为$0$。 然后我们bfs求出所有能走到的位置，即走的每个位置都要能放得下舰队。我们把能走到的位置在$S$中标记成$1$，其他的标记成$0$。 那么$(x,y)$能被某个舰到达的条件就是 $$\\sum_{i=0}^{pq-1}S\[a-i\]\\times T\[i\]>0$$ 同样是个卷积的形式，FFT乘一下即可。