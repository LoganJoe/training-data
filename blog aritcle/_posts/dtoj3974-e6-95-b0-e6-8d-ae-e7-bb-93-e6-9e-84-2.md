---
title: " DTOJ3974数据结构\t\t"
tags:
  - 定理
  - 数学
url: 4833.html
id: 4833
categories:
  - DTOJ
  - Solution
date: 2018-10-30 23:32:16
---

我们考虑$+1$对一个数$x$的影响。 即我们要研究$(x+1)^k$。 根据二项式定理 $$(x+1)^k=\\sum_{i=0}^{k}\\binom{k}{i}x^i$$ 考虑多次$+1$，假设加了$y$次，那么有 $$(x+y)^k=\\sum_{i=0}^{k}\\binom{k}{i}x^{n-i}y^i$$ $x^i$和$\\binom{k}{i}$都是固定的，我们只要维护$y^i$。 具体地，设$a\_i=\\sum{x^{n-i}},b\_i=y^i$，那么答案就是$\\sum_{i=0}^{k}\\binom{k}{i}a\_ib\_i$。 为了使所有数被加的次数都相同，假如我们新加入一个数$v$，当前已经$+1$了$cnt$次，我们可以认为有一个$v-cnt$在最初就被加入了。那我们对每个$a\_i$，加上$(v-cnt)^{n-i}$，然后计算一下对答案的贡献。 那么$+1$的操作就相当于使上面的$y+1$，重新计算每个$b\_i$，同样计算一下对答案的贡献。 时间复杂度$\\Theta(nk\\log k)$。可以通过预处理快速幂变成$\\Theta(nk)$。