---
title: " DTOJ3933Rozstaw szyn\t\t"
tags:
  - 思路
url: 4219.html
id: 4219
categories:
  - DTOJ
  - Solution
date: 2018-10-18 22:34:58
---

我们把权值放在数轴上看，那么问题就变成了最小化相邻两点的距离和。 我们考虑从子树最优推到全局最优。这样正确性是显然的，因为一个点的取值可以根据儿子的取值变化。 通过在数轴上画图可以知道，每个点最优的取值范围都是一段区间。 而一个点的取值区间只和儿子的取值区间有关。 考虑这个点的取值$x$，它和儿子们的距离和最小是多少。 我们把儿子的区间分成三类：整个都在$x$左边，整个都在$x$右边和跨过$x$的。 跨过$x$的区间到$x$的距离最小值一定是$0$。整个都在$x$左边的区间到$x$的距离最小值一定是$x$到区间右端点的距离。整个都在$x$右边的区间同理。 这样我们就可以发现，如果从小到大枚举$x$的话，只有当$x$的变化经过某个区间的端点，最小距离和才会发现变化。 那么我们将所有区间端点从小到大排序，依次枚举过去作为$x$。 同时维护整个都在$x$左边/右边的区间数量和这些区间右端点/左端点的和，就可以求出当前的最小距离和。 取到最优的距离和时的$x$的范围就是这个点的最优取值范围。