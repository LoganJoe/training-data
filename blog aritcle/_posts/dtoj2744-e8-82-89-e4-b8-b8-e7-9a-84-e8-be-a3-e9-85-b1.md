---
title: " DTOJ2744肉丸的辣酱\t\t"
tags:
  - 二分
  - 可持久化线段树
url: 448.html
id: 448
categories:
  - DTOJ
  - Solution
date: 2018-02-01 23:17:15
---

二分答案。将问题转化为子区间$mex\\geqslant ans$的区间个数。 对于单个询问，从小到大枚举一个数$x$。令$f\[i\]$为以$i$为左端点，最近的能使区间$mex\\geqslant x$的右端点，不存在即为$n+1$。每次$x$增加$1$时，用所有$x$的位置去更新$f$值，即区间取最大值。发现$f\[i\]$随$i$的增大单调不减，可以在线段树上二分后区间赋值。区间$\[l,r\]$的子区间$mex\\geqslant ans$的区间个数即为$(r+1)(r-l+1)-\\sum_{i=l}^{r}min(f\[i\],r+1)$。可以先在线段树上二分出$r+1$的位置再分成两部分计算。 多个询问的话，我们就每次增加$x$时开一棵线段树维护新的$f$值，也就是用可持久化线段树维护，在线二分答案回答询问即可。