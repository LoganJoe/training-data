---
title: " DTOJ2718反函数\t\t"
tags:
  - FFT
  - 卷积
  - 点分治
url: 3514.html
id: 3514
categories:
  - DTOJ
  - Solution
date: 2018-08-21 22:03:35
---

zhshr：“这不是一看就是xxx套xxx吗？” 树上路径问题，我们考虑点分治。 记当前重心为$root$，我们考虑$root$到$x$的路径和$root$到$y$的路径能否拼成一个合法的串，如果合法段数是多少。即求出$f(x,y)$。 考虑一个合法的串，把左括号看作$1$，后括号看作$-1$，那么要满足所有的前缀和$\\geqslant 0$，且整串的值为$0$。 记$a\_i$为第$i$个点的权值（$1$或$-1$），$val\_i$为$root$到$i$的路径（包括$root$和$i$）所有点权的和。 记$p$为$root$到$x$的任意一个点，$q$为$root$到$y$的任意一个点，那么要满足 $$val\_x+val\_y+a_{root}=0$$ $$val\_x-val\_p\\geqslant 0$$ $$val\_x+val\_q-a_{root}\\geqslant 0$$ 第三个条件也可以变成 $$val\_y+val\_q\\geqslant 0$$ 那么后两个条件就是说，$x$要是$root$到$x$的路径上$val$最大的点，$y$要是$root$到$y$的路径上$val$最小的点。 那么我们从$root$开始$dfs$一遍，求出到每个点的$val$、当前的最大值、最大值个数、最小值和最小值的个数。 $root$到$x$的段数就是$最大值个数-1$，$root$到$y$的段数就是$最小值个数-1$，那么如果$x$到$y$合法，形成的串的段数就是$最大值个数+最小值个数-1$。 这是一个卷积，我们求出合法的每种最大值个数的个数，然后FFT一下即可。 所以这题是点分治套FFT。