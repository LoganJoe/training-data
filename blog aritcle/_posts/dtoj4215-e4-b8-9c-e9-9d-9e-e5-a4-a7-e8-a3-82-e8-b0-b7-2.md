---
title: " DTOJ4215东非大裂谷\t\t"
tags:
  - 树形dp
url: 6896.html
id: 6896
categories:
  - Solution
date: 2019-03-08 17:02:36
---

考虑两个性质：

*   一条链的极差一定在其两端点取到
*   一条链上的权值一定单调增减。

考虑其正确性证明。显然对于第一个，假设极差不在端点取到，那么截掉多余的两段答案不会变劣。对于第二个从非单调位置截断，答案不会变劣。 考虑做树形dp.$f\[u\]\[0/1\]$表示为根子树内，当前向下一条链递增或递减的最大值。枚举其儿子$v$，首先记$tot=\\sum \\max(f\[v\]\[0\],f\[v\]\[1\])$。那么 $$\\begin{cases} f\[u\]\[0\] = \\max(f\[u\]\[0\], tot - \\max(f\[v\]\[0\], f\[v\]\[1\]) + f\[v\]\[0\] + A\_u - A\_v) & A\_u>A\_v f\[u\]\[1\] = \\max(f\[u\]\[1\], tot - \\max(f\[v\]\[0\], f\[v\]\[1\]) + f\[v\]\[1\] + A\_v - A\_u) & A\_u<A\_v \\end{cases}$$ 那么$O(n)$处理就好了。