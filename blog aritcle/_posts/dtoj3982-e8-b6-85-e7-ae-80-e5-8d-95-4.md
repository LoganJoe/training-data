---
title: " DTOJ3982超简单\t\t"
tags:
  - 奇技淫巧
  - 期望
  - 概率dp
url: 4991.html
id: 4991
categories:
  - DTOJ
  - Solution
date: 2018-11-01 23:00:17
---

题目大意就是选出一些数，使得只有最后一个数出现次数为$2$，其他数出现次数都为$1$，求所有数的和的期望。 考虑dp。 记$f\[i\]\[j\]$为前$i$个数中，选了$j$个数，且最后选的数是第$i$个数的概率，$g\[i\]\[j\]$为前$i$个数，选了$j$个数，且最后选的数是第$i$个数的所有数和的期望。 我们枚举上一个选的数$k$，那么有 $$ f\[i\]\[j\]=\\sum_{k=1}^{i-1}f\[k\]\[j-1\]\\times p\_i $$ $$ g\[i\]\[j\]=\\sum\_{k=1}^{i-1}f\[k\]\[j-1\]\\times v\_i+g\[k\]\[j-1\] $$ 用前缀和优化即可在$\\Theta(n^2)$内求出。 记$f'\[i\]\[j\]$为后$i$个数中，选了$j$个数，且最前面选的数是第$i$个数的概率，$g'\[i\]\[j\]$为后$i$个数，选了$j$个数，且最前面选的数是第$i$个数的所有数和的期望。 我们枚举后一个选的数$k$，那么有 $$ f‘’\[i\]\[j\]=\\sum\_{k=i+1}^{n}f'\[k\]\[j-1\]\\times p\_i $$ $$ g'\[i\]\[j\]=\\sum\_{k=i+1}^{n}f'\[k\]\[j-1\]\\times v\_i+g'\[k\]\[j-1\] $$ 同样用前缀和优化可以在$\\Theta(n^2)$内求出。 枚举选出的所有数中，最后选的数是哪一个。假设是第$x$个数，那么所有数和的期望就是 $$ \\sum\_{i=1}^{x}\\sum_{j=1}^{n-x+1}(g\[x\]\[i\]\\times f'\[x\]\[j\]+g'\[x\]\[j\]\\times f\[x\]\[i\])\\times (i+j-1)! $$ 最后那个阶乘是因为我们在之前的dp中没有考虑选数的顺序。 每个$x$的期望加起来就是答案了。 时间复杂度$\\Theta(n^3)$。有点卡常，如果前面的两个dp不用前缀和优化好像就过不去了。 还有一种时间复杂度$\\Theta(n^2)$的解法，大概是先用dp求出所有数都至多选一次的概率与期望。然后枚举选两次的数，将它从dp里删去，即dp往回退一步（和背包退一个物品差不多），然后再强制这个数要选两次计算概率与期望。