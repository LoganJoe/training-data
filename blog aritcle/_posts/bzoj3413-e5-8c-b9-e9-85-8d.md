---
title: " BZOJ3413匹配\t\t"
tags:
  - 后缀自动机
  - 线段树合并
url: 5786.html
id: 5786
categories:
  - BZOJ
  - Solution
date: 2018-12-23 22:38:42
---

对于每个$s\_i$单独算答案。记当前的$s\_i$长度为$len$。 考虑先找到匹配成功的结尾位置$p$，那么失败的次数就是$p-len$。如果无法匹配成功失败的次数就是$n$。 我们建出串$S$的后缀自动机，沿着转移边找到$s_i$对应的点，点的$right$集合中最小的元素就是$p$。 我们再计算匹配成功的次数，等价于计算每个前缀在$p$之前匹配了多少次，然后加起来。 对于第$i$个前缀，合法的匹配范围是$p-len+i$，如果不存在$p$合法的匹配范围就是$1\\sim n$。 我们在后缀自动机上找到第$i$个前缀对应的点，然后计算这个点$right$集合里有多少个元素在$\[1,p-len+i\]$或者($\[1,n\]$）中。 我们用动态开点的线段树维护后缀自动机上每个点的$right$集合里的元素，$right$集合的求法相当与把parent树上的儿子的线段树合并起来。 那么我们写个线段树合并就能用线段树维护每个点的$right$集合，查询的时候在线段树上查询即可。 找$p$实际上也可以通过在线段树上二分实现。 注意这道题的线段树合并，在两棵树对应节点都不为空时，要新开节点将原节点复制过去。