---
title: " DTOJ3985飘雪圣域\t\t"
tags:
  - 线段树
url: 5050.html
id: 5050
categories:
  - DTOJ
  - Solution
date: 2018-11-05 22:31:09
---

说好noip模拟测试然后t3比t2简单系列。 显然每一个极大连通块都是棵树。 记树的根是树中深度最小的点，那么我们可以通过求有几个树根来求有几个连通块。 显然树根和树根的父亲是不连通的，也就是说，如果$i\\in\[l,r\]$且$fa\_i\\not \\in\[l,r\]$，那么$i$就是树根。其中$fa\_i$是第$i$个点的父亲。 我们把$(i,fa_i)$看作二维平面上的点，那么我们每次询问就等价于求$x\\in\[l,r\],y\\in\[1,l)\\cup(r,n\]$这块矩形区域内的点数。 这是经典的二维数点问题。 可以同主席树在线回答，也可以用线段树+扫描线离线回答。把线段树换成树状数组也行。 时间复杂度$\\Theta(n\\log n)$。