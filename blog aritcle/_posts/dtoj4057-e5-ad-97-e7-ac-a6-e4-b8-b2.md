---
title: " DTOJ4057字符串\t\t"
tags:
  - Trie树
  - 莫队
url: 5384.html
id: 5384
categories:
  - DTOJ
  - Solution
date: 2018-12-07 22:02:58
---

用莫队离线询问。注意这里分块的标准按串长较优，即当前这块的字符串总长$>\\sqrt {\\sum_{i=1}^{M}|s_i|}$就成为一块。 当前区间扩大一位时，我们把增加的串塞进Trie树中，插入的过程中可以维护集合G新加入的元素。 当前区间缩小一位时，我们把删除的串从Trie树中删除（和插入一样，只是打上$-1$标记代表删除），删除的过程中也可以维护集合G中被删除的元素。 现在的问题是如何维护答案，也就是G中大小相邻的两个数差的平方和。 很容易用set实现，但这样复杂度就带上了一个$\\log$，并不能通过。 如果只有删除的话，我们可以用一个链表维护，每次$\\Theta(1)$。 那么我们改变一下莫队回答询问的顺序，使得我们只有删除。 具体地，我们按左端点所在块给询问分类。 对于左端点在同一块的询问，我们按右端点从大到小排序。 我们先把当前块左端点到$N$的所有串插入Trie树中。然后开始处理这块的询问。 对于一个询问，我们先把当前右端点左移到询问右端点，然后把要删的串删了。再把左端点右移到询问左端点，也把要删的串删了。 不同的是，在右移左端点的时候，我们要记下链表在被改之前的信息。在回答完这个询问后，把所有的信息还原，即相当于将左端点移回去了。 时间复杂度$\\Theta(N\\sqrt{N})$。（假设$N,M,len$同阶）