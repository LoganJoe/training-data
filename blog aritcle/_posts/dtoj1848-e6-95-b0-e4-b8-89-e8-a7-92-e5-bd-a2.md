---
title: " DTOJ1848数三角形\t\t"
tags:
  - 数学
url: 1547.html
id: 1547
categories:
  - DTOJ
  - Solution
date: 2018-04-17 13:14:17
---

考虑容斥，用所有方案数减去不合法的方案数。注意下文的$n,m$都是$+1$过的。 所有方案数即任选三个不同的点，即$\\binom{nm}{3}$，不合法的方案数即三点共线的方案数。 三点贡献又分为三种情况，横着共线、竖着共线和斜着共线。 其中，横着和竖着的情况为$n\\binom{m}{3}+m\\binom{n}{3}$。 现在考虑斜着的情况，从左下到右上的斜线和右下到左上的斜线的情况是完全一样的，因此下面只说从左下到右上的斜线的情况。 把三角形中左下的点作为原点，通过枚举三角形中右上的点来代表这条直线，即枚举直线经过点$(x,y)$和$(0,0)$，那么第三个点在线段上有$gcd(x,y)-1$种可能，同时原点可以为网格中合法的任意一点，那么总的方案数就是$(gcd(x,y)-1)(n-i)(m-j)$。 斜着共线的总情况数就是 $$2\\sum_{x=1}^{n-1}\\sum_{y=1}^{m-1}(gcd(x,y)-1)(n-i)(m-j)$$