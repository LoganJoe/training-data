---
title: " DTOJ4058序列\t\t"
tags:
  - 分治
  - 最大权闭合子图
  - 线段树
url: 5454.html
id: 5454
categories:
  - DTOJ
  - Solution
date: 2018-12-12 22:13:17
---

部分分中有$a_i\\leq 2$的点。我们先思考一下这部分要怎么写。 我们可以将问题转换成一个最大权闭合子图的问题：我们选一个点等价于我们要让这个数变成$1$，因此我们要尽可能使原来是$1$的数字保持不变。也就是说，数字$1$对应的点权为$1$，数字$2$对于的点权为$-1$。我们如果选择某个点，即让某位变成$1$，那么以它为最大值的区间都要变成$1$；如果以它为最大值的区间有数变成$1$，那么这位就也要变成$1$。这样就可以建出图，最大权闭合子图就是答案了。 由于边数较多，连边又是一段段区间，因此我们可以用线段树优化建图，这样就可以存的下边了。 考虑满分做法。 我们根据权值分治，对于权值区间$\[l,r\]$，记$mid=\\frac{l+r}{2}$。我们将$\\leq mid$的权值当作$1$，$>mid$的权值当作$2$，用前面的建图去求最大权闭合子图。根据最大权闭合子图的方案，我们可以确定每个位置的数最终是$\\leq mid$还是$>mid$，然后就可以分成两部分继续分治了。 这样我们就可以确定最终每个位置上的数是多少，作差一下算出代价即可。