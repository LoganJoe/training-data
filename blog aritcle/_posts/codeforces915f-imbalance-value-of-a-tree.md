---
title: " Codeforces915F Imbalance Value of a Tree\t\t"
tags:
  - 并查集
url: 5182.html
id: 5182
categories:
  - Codeforces
  - Solution
date: 2018-11-18 11:08:02
---

### 题意

有一棵$n$个点的数，第$i$个点的点权为$a_i$。 一条路径的权值定义为经过的点权最大值与最小值的差。 求所有简单路径的权值和。

### 题解

容易看出这个是点分治的模板题，但是点分治是$\\Theta(n\\log^2 n)$的，明显过不去。 我们可以求出所有简单路径的点权最大值和，再减去所有简单路径点权最小值和，就是答案了。 两个的求法是类似的，这里只讲求最大值和的方法。 我们枚举一个点$x$，考虑经过点$x$且路径最大值为$a_{x}$的路径条数是多少。 我们只连接两个端点的点权都$\\leq a_{x}$的边，那么路径条数就只和$i$所在连通块的大小有关了，我们只用求出$i$所在的连通块大小即可。 将所有点按$a\_i$从小到大排序，记排在第$i$个的点是$p\_i$。 我们从小到大枚举$i$，然后连接与$p\_i$相连且点权$\\leq a\_{p_i}$的点，同时维护连通块的大小。 容易用并查集实现。 时间复杂度$\\Theta(n\\log \\alpha)$。