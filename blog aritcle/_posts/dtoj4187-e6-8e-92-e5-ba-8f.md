---
title: " DTOJ4187排序\t\t"
tags:
  - 思路
url: 6695.html
id: 6695
categories:
  - DTOJ
  - Solution
date: 2019-02-27 19:15:02
---

本文$\\oplus$表示异或。 假设我们有一个$a$，我们要判断是否合法。 如果$p\_i\\oplus p\_j\\leq a$，我们可以认为$p\_i,p\_j$之间连了一条边。 显然每个连通块内的数可以任意交换位置，因此合法的条件就是每个连通块里的数都能在自己块内找到自己的位置，也就是对于任意$i\\in\[1,n\]$，$i$所在的连通块中都要有$p\_i$。 现在看起来毫无头绪了。 不如来打个暴力吧！ 诶！为什么答案都是$2$的幂啊！ 我们来尝试着证明这个结论：合法的最小的$a$一定是$2​$的幂。 不妨设$a=2^k$。 有边的$p\_i,p\_j$一定最高几位都是相同的，考虑从高到低第一个不同的位。 如果是$2^k$这位，这说明$p\_i\\oplus p\_j=2^k$，即除了$2^k$这位，其他位都相同。 否则就是比$2^k$更低的位置，此时无论$p\_i,p\_j$怎么取，都有$p\_i\\oplus p\_j<2^k$。 综上所述，一个连通块内的数在比$2^k$更高的位上都是相同的。 若$2^k<a<2^{k+1}$，和$a=2^k$相比，每个连通块里的点没有发生变化。 也就是说，如果存在$a$满足$2^k<a<2^{k+1}$合法，那么$a=2^k$也合法。 证毕。 那么答案的可能就大大减少了，我们现在已经可以枚举答案了。 如何判断合法呢，暴力建边肯定不行啊。 考虑我们前面所说的连通块的性质：一个连通块内的数在比$2^k$更高的位上都是相同的。 而我们开头又说了$i$和$p\_i$要在一个连通块内。 也就是说，如果$i$和$p\_i$在$2^k$这位上不同，那么答案一定$\\geq 2^k$。 显然只有最高的不同位有用。 我们对于每一个二进制位，维护有多少对$i$和$p\_i$最高的不同位为这一位。查询时扫一遍即可。 时间复杂度$\\Theta(n\\log n)$。