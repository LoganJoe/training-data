---
title: " DTOJ3199水箱\t\t"
tags:
  - dp
  - 线段树
url: 5586.html
id: 5586
categories:
  - DTOJ
  - Solution
date: 2018-12-16 21:36:27
---

考虑dp。 记分割第$i$格和第$i+1$格的挡板的高度为$a\_i$。记$f\[i\]\[j\]$为考虑完前$i$格，其中第$i$格的水高度为$j$，最多能满足多少个条件。 那么有 $$ f\[i\]\[j\]=val(i,j)+\\begin{cases} \\max\_{k=0}^{a_{i-1}}\\{f\[i-1\]\[k\]\\} & j\\leq a_{i-1}\\newline f\[i\]\[j\] & j>a_{i-1} \\end{cases} $$ 其中$val(i,j)$为第$i$格水的高度为$j$能满足的条件数。 我们先不考虑$val(i,j)$，看着这个dp的转移式，很显然可以用线段树优化。 我们只用支持查询区间最大值和区间赋值的操作即可。 考虑如何将$val(i,j)$的贡献也用线段树维护。 显然，$val(i,j)$的取值也是一段一段的。 我们将第$i$格的条件按高度从小到大排序，那么在相邻的两个条件的高度中间，$val$的值是一样的。 我们扫一遍条件，然后在线段树上区间加即可。 时间复杂度$\\Theta(n\\log n)$。