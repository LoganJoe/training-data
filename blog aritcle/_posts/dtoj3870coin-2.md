---
title: " DTOJ3870coin\t\t"
tags:
  - dp
  - 奇技淫巧
url: 3775.html
id: 3775
categories:
  - Solution
date: 2018-08-30 19:04:26
---

首先，我们可以想到dp。$f\[i\]\[j\]$表示对于第$i$种假币，有恰好$j$个人选择的概率。具体dp的时候，设$f\[i\]\[j\]\[k\]$为前$k$个人，第$i$种假币恰好$j$个人喜欢的概率。那么有

$$f\[i\]\[j\]\[k\]=f\[i\]\[j-1\]\[k-1\]\*p_{i,j}+f\[i\]\[j-1\]\[k\]\*(1-p_{i,j}$$

然后设$g\[i\]\[j\]$为第$i$种假币带$j$枚，被拿走的期望个数。转移是

$$g\[i\]\[j\]=\\sum_{k=0}^{n}min(j,k)*f\[i\]\[k\]$$

计算答案的时候可以背包。

但是这样的话，三个转移都是$O(nm^2)$的。

我们抛开背包。发现对于$g$，其差分等于$f$的后缀和，并且，$g$显然是单调不升的。那么我们对于现有的一个状态，可以贪心选择一种假钞然后携带，使得收益最大。前面的性质保证这个贪心思路一定是正确的。然后我们先算出选一个的$g$的差分，然后每次选某一个再$O(n)$推得当前假币下一个$g$的值，那么算g的次数就是$O(n)$的。时间效率就变成了$O(nm+n^2)$