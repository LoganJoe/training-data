---
title: " DTOJ3945集训\t\t"
tags:
  - dp
  - 思路
url: 4286.html
id: 4286
categories:
  - Solution
date: 2018-10-21 12:52:48
---

$p,q$数据范围看反毁一生。

很明显可以看出，每一维之间是互不影响的。那么我们对每一维分别做一下dp。

$f\[i\]\[j\]$为当前在第$i$个点，走了$j$步的方案数。直接做这个dp是$O(n^2q)$的。然后考虑怎么合并。

注意到虽然$p$很大，但是坐标范围即$n$只有$50$。因此我们可以将同种的合并起来做。将回到$1$与回到该坐标的方案数加起来，然后写成了“经过i步回到规定点的方案数”的一个多项式。于是同坐标的都可以倍增合并起来。

之后再将所有坐标的合并起来，乘上一个阶乘就是最后的方案数了。