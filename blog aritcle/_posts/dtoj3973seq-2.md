---
title: " DTOJ3973seq\t\t"
tags:
  - 线段树
url: 4812.html
id: 4812
categories:
  - Solution
date: 2018-10-30 21:08:50
---

hhhhhhhhhhhh测试A掉真鸡儿爽。 首先可以知道的是，前缀最大值一定是单调不降的。 考虑用线段树维护。对于每次操作，影响到的部分是到后面第一个比它大的位置。 那么我们线段树修改一个地方，要考虑当前位置对于后面的影响。 那么我们在线段树上更新，就可以考虑从当前也节点到根路径上的点，其左儿子对于右儿子的影响。可以保证的是这样一定会覆盖掉后面所有可能被更新的区间。 那么对于当前pushup到的某个点，我们要拿左儿子的最大值去更新右儿子所在区间的最大值：设当前拿来更新的最大值为$lmax$，考虑当前更新的区间：

*   假设当前区间中，有$\[l,mid\]$的最大值大于$lmax$。那么$\[mid+1,r\]$这段区间都不会被更新。那么我们递归到$lc$，处理$lc$的答案。
*   假设当前区间中，有$\[l,mid\]$的最大值小于$lmax$，那么$\[l,mid\]$这段的值会被全部改为$lmax$。这个时候由于第一个比$lmax$大的区间可能在$rc$里面，那么我们递归到$rc$，处理$rc$的答案。

这样每次pushup，就可以在$O(\\log n)$内更新出右边的答案。总体线段树一次操作的时间复杂度是$O( \\log^2 n)$，总时间复杂度是$O( n \\log^2 n)$。