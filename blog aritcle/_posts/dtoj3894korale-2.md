---
title: " DTOJ3894Korale\t\t"
tags:
  - 思路
url: 4083.html
id: 4083
categories:
  - DTOJ
  - Solution
date: 2018-10-15 08:01:25
---

枚举所有可能集合要用搜索，因此我们要模拟搜索的过程。 先考虑第一问，我们考虑从小到大枚举每种集合。我们用堆维护选数的集合，同时维护最后选的位置$p$。 显然dfs的时候，我们是从左到右枚举每个数选或不选，那么对于一个集合，下一个比它大的集合有两种可能：

1.  加入一个数。显然加的是$p$右边最小的一个数。
2.  将最后一个数换成另一个数。显然换成刚好比最后一个数大的一个数。我们用类似超级钢琴的写法，假如最后一个数的选择区间是$\[l,r\]$，那么我们从$\[l,p)$和$(p,r\]$中分别选择最小数，然后替换当前数。

比较麻烦的是我们要保证字典序最小。 那么就得保证最靠左选的数必须最小，那么我们可以将dfs的顺序反过来，即从右到左枚举每个数选或不选。 同时我们还要记一下当前状态是由哪个状态转移过来的，也要记一下每个状态的排名。 细节很多，建议参考CQ_zhang的代码。 （举报这种写法空间大时间常数大我手开O2才水过不然就卡一个点气死我了） 如果没信心能卡过去的建议去写线段树的写法。