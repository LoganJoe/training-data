---
title: " DTOJ1482水表已拆\t\t"
tags:
  - 最小生成树
  - 莫队
url: 3586.html
id: 3586
categories:
  - DTOJ
  - Solution
date: 2018-08-26 13:48:03
---

测试的时候可能写了$3$个假算法后终于肝出来了。 每次询问就相当于让你求出用$\[L,R\]$中的边建出的生成树。 考虑莫队，我们维护当前区间$\[l,r\]$的生成树。 往生成树里加一条边是很简单的，但是删除一条边就很麻烦了。 路径压缩的并查集是不支持撤销的，我们考虑不用路径压缩而是用启发式合并的并查集。 每次合并我们记下修改的信息，撤销的时候我们暴力把相关信息改回去即可。 当你写完后，你会愉快的发现，WA了。 这是因为并查集的撤销只有从最后一步倒着一步一步撤销才是有正确性的。如果你加了$\[1,L-1\]$的边，形成了一棵$n$个点的生成树；然后你再加入$\[L,R\]$的边，此时不会有边被加进生成树；然后再把$\[1,L-1\]$的边撤销，那么所有点都不连通了，但是$\[L,R\]$中的边肯定能使一部分的点连通。 我们考虑一种变形的莫队。 左端点和右端点在同块内的我们直接暴力建出生成树解决掉。剩下的，对于左端点在同块内按右端点排序一起做。 初始区间左右端点都在当前块的最右端，然后对于每个询问，右端点不断右移到询问区间的右端点，然后左端点也不断左移到询问区间的左端点。 处理完当前询问后，右端点不动，左端点右移回到当前块的最右端。 因为我们是先右移右端点再左移左端点的，这样可以保证左端点右移时是倒着一步一步撤销的。 处理完左端点在当前块的询问后，所有信息清空，处理在下一个块内的询问即可。