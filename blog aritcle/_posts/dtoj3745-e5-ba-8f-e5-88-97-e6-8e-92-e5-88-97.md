---
title: " DTOJ3745序列排列\t\t"
tags:
  - dp
  - 思路
url: 2317.html
id: 2317
categories:
  - DTOJ
  - Solution
date: 2018-06-11 22:50:15
---

将$\\%p$相同的数分成一组，然后一组一组考虑。这个思路挺巧妙的。 考虑dp，记$f\[i\]\[j\]$为已经放了前$i$组的数，现在有$j$对相邻的数$\\%p$相同的方案数。 对于第$i+1$组，枚举破坏几组之前相邻$\\%p$相同的数对和新增的相邻$\\%p$相同的数对，乘组合数即可转移。 具体地，设破坏$a$对新增$b$对，那么有 $$f\[i\]\[j\]\\times \\binom{j}{a}\\times \\binom{Sum\[i\]+1-j}{cnt\[i+1\]-a-b}\\times \\binom{cnt\[i+1\]-1}{b}\\times cnt\[i+1\]!\\Rightarrow f\[i+1\]\[j-a+b\]$$ 其中，$cnt\[i\]$表示第$i$组（$\\%p=i$）数的个数，$Sum\[i\]=\\sum_{j=0}^{i}cnt\[j\]$。第一个组合数是选出被破坏的$a$对，第二个组合数是把不破坏也不新增的数塞到空位中，第三个组合数是选出新增的$b$对（放隔板把第$i$组的数隔开，$cnt\[i\]-1$个空位，$cnt\[i\]-1-b$个隔板），最后的阶乘是因为之前考虑的是无序的。 最后$f\[m-1\]\[0\]$即为答案。 时间复杂度其实是$\\Theta(n^3)$的。 lt神仙有$\\Theta(n^2)$的。 好像是记$f\[i\]\[j\]$为已经放了前$i$组数，然后把相邻$\\%p$相同的数压成一块，共有$j$块的方案数。 枚举第$i+1$组新增的多少块，同样乘组合数（哪几块，放什么位置）转移。