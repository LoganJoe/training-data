---
title: " DTOJ2246exp\t\t"
tags:
  - 容斥
  - 期望
  - 概率dp
url: 3494.html
id: 3494
categories:
  - Solution
date: 2018-08-17 23:13:46
---

本题解可能包含大量“无需证明的内容”。请读者根据情况自行证明。

设$t\_i$为第$i$次操作恰好染黑的概率，$p\_i$为第$i$次操作以后还未被染黑的概率。那么有$ans=\\sum_{i=0}^{infty}i\\times t\_i$，又因为$p\_i=\\sum_{k=i+1}^{\\infty}t\_i$，那么有$ans=\\sum\_{i=0}^{inf}p_i$。

考虑怎么求$p_i$。

我们枚举集合$S$为在第$i$次后还未染黑的位置集合。那么可以操作的区间就在白色格子之间的黑格子区间内。我们记其数量为$x$，总区间数量为$m=\\frac{n(n+1)}{2}$

P\_i=\\sum\_s (-1)^{|s|-1}\\left( \\frac{x}{m} \\right)^i

容斥的原因是我们只能使得枚举集合中的格子是白色的，而外围的格子并不一定是白色的，相关代价会被其扩大集重复计算，因此使用集合大小容斥。

那么我们要求的ans就变成了

$$ans=\\sum_{S}(-1)^{|S|-1}\\sum_{i=0}^{\\infty}(\\frac{x}{m})^i$$

期望化成概率再化成集合容斥死掉了。

然后化掉最后面那个丑陋的等比数列：

$$ans=\\sum_{S}(-1)^{|S|-1}\\frac{1}{1-\\frac{x}{m}}$$

但是集合中的元素与我们无关，并且与后面的东西不影响。因此我们将相同大小的集合看做等价，我们只需要枚举集合大小的奇偶来容斥，以及x即可以染的区间个数。

具体我们记dp的状态$f\[i\]\[j\]\[0/1\]$,为当前选前$i$个格子，$i$个格子是白的，$j$个可行区间，集合大小为偶/奇的方案数。