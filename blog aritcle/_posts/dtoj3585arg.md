---
title: " DTOJ3585arg\t\t"
tags:
  - LIS
  - 状压dp
url: 1322.html
id: 1322
categories:
  - DTOJ
  - Solution
date: 2018-04-04 16:41:55
---

满足$A$是排列的一个LIS，即要求排列的LIS长度为$|A|$，且$A$中的数在排列中按顺序出现。 发现$n$这么小，我们考虑状压。 思考一下求LIS的$\\Theta(nlog\\space n)$写法：存下LIS长度为$i$的最小结尾，记为$s_i$。 显然$s$数组是单调的，也就是说，如果我们知道了$s$中有哪些数，就能还原出$s$数组。 由于这题求的是一个排列，因此我们可以用$n$位二进制数表示$s$数组的状态。 那么考虑dp，记$f\[i\]\[j\]$为已选数字状态为$i$，$s$数组的状态为$j$的方案数。 我们预处理出每种$s$状态新加一个数之后的状态。就可以通过枚举一个不在$i$中的数来转移。 注意如果加入的数在$A$中，那么需要判断它前一个数是否被加入，如果还没被加入就不能加入当前的数。 最后枚举所有可能的$s$数组的状态就可以求出答案。 但这样是$\\Theta(4^nn)$的，不够优秀。 容易发现对于一个状态$f\[i\]\[j\]$，只有当$j\\subseteq i$时才有意义。 因此我们可以用$n$位三进制数表示原来的两种状态：$0$表示没有选，$1$表示选了但不在$s$数组中，$2$表示选了并且在$s$数组中。 效率就变成了$\\Theta(3^nn)$了。 看样子很险，但这是效率上界，实际上真正的状态数是达不到上界的。因此好像$\\Theta(3^nn^2)$都可以过。