---
title: " BZOJ4001[TJOI2015]概率论\t\t"
tags:
  - 期望
  - 概率
  - 生成函数
url: 6486.html
id: 6486
categories:
  - BZOJ
  - Solution
date: 2019-02-18 14:09:22
---

先考虑$n$个结点的二叉树有多少种，也就是卡特兰数。 考虑卡特兰数的推导。 记$f\_i$为$i$个结点不同的二叉树个数，那么有 $$ f\_i=\\sum_{j=0}^{i-1}f\_j\\times f\_{i-j-1} $$ 我们令$f\_0=1$，记$F(x)$为数列$f\_i$的普通型生成函数，那么有 $$ F(x)=xF(x)^2+1 $$ 因为$f\_i$等式另一边可以看成自己和自己的卷积再位移一位。 那么我们可以解出 $$ F(x)=\\frac{1\\pm \\sqrt{1-4x}}{2x} $$ 如果$F(x)=\\frac{1+\\sqrt{1-4x}}{2x}$，那么分子上常数项不为$0$，就会出现$\\frac 1 x$项，这在生成函数中是无意义的。 也可以认为，$\\sqrt{1-4x}$通过二项式定理展开后，每一项的系数都是负的，而卡塔兰数一定是正的，所以要舍去这个解。 因此 $$ F(x)=\\frac{1- \\sqrt{1-4x}}{2x} $$ 再考虑所有$n$个结点的二叉树的叶子结点数和，记为$g\_n$。显然我们的答案就是$\\frac{g\_n}{f\_n}$。 那么有 $$ \\begin{aligned} g\_i&=\\sum\_{j=0}^{i-1}g\_j\\times f\_{i-j-1}+g_{i-j-1}\\times f\_j\\\ &=2\\sum\_{j=0}^{i-1} f\_j\\times g\_{i-j-1} \\end{aligned} $$ 令$g\_0=1$，记$G(x)$为数列$g\_i$的普通型生成函数，那么有 $$ G(x)=2xF(x)\\cdot G(x)+1 $$ 解得 $$ G(x)=\\frac{x}{1-2xF(x)}=\\frac{x}{\\sqrt{1-4x}} $$ 接下来很神奇。 我们对$x\\cdot F(x)$求导，这个求导有点复杂，我们一步一步来。 首先 $$ xF(x)=\\frac{1-\\sqrt{1-4x}}2=\\frac 1 2-\\frac 1 2(1-4x)^{\\frac 1 2} $$ $\\frac 1 2$求导完后就没了，我们只要考虑$(1-4x)^{\\frac 1 2}$的求导，$-\\frac 1 2$是可以直接乘在$(1-4x)^{\\frac 1 2}$的求导结果上的（导函数的乘法运算法则）。 记$f(x)=x^{\\frac 1 2},g(x)=1-4x$，那么我们要求的就是$(f(g(x)))'$。 根据复合函数的求导法则，有$(f(g(x)))'=g'(x)f'(g(x))$。 $f'(x)=\\frac 1 2 x^{-\\frac 1 2}$，$g'(x)=-4$。将$f(x),f'(x),g(x),g'(x)$全部代入，得到 $$ \\begin{aligned} (f(g(x)))'&=g'(x)f'(g(x))\\\ &=-4\\times \\frac 1 2 (1-4x)^{-\\frac 1 2}\\\ &=-2(1-4x)^{-\\frac 1 2} \\end{aligned} $$ 所以$((1-4x)^{\\frac 1 2})'=-2(1-4x)^{-\\frac 1 2}$，因此$(xF(x))'=(1-4x)^{-\\frac 1 2}$。 然后我们发现 $$ (xF(x))'=\\frac 1 {\\sqrt{1-4x}}=\\frac{G(x)}x $$ 这说明了$f$和$g$是有联系的。 考虑$x\\cdot F(x)$的每一项，形如$x\\cdot f\_i\\cdot x^i=f\_i\\cdot x^{i+1}$。求导完后变成了$(i+1)f\_i\\cdot x^{i}$。 考虑等式右边$x^i$前的系数，为$\\frac{g\_{i+1}\\cdot x^{i+1}}{x}=g_{i+1}\\cdot x^i$。 也就是说，有 $$ g_{i+1}=(i+1)f\_i $$ 因此答案就是$\\frac{nf\_{n-1}}{f\_n}$。 我们知道$f\_i$是卡特兰数，通项公式是$f_i=\\frac{\\binom{2i}{i}}{i+1}$。 那么答案就是 $$ \\frac{n\\cdot \\frac{\\binom{2n-2}{n-1}}{n}}{\\frac{\\binom{2n}{n}}{n+1}}=\\frac{(n+1)\\binom{2n-2}{n-1}}{\\binom{2n}{n}}=\\frac{n(n+1)}{2(2n-1)} $$ 好像打表就可以直接看出来了……