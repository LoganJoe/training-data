---
title: " DTOJ3841传统题\t\t"
tags:
  - 奇技淫巧
  - 思路
url: 3140.html
id: 3140
categories:
  - Solution
date: 2018-07-28 16:46:03
---

暴力与正解丝毫没有关系系列。 这可能又是一篇题解摘抄。 我们只用关心最长的连续子段的长度就可以了。序列中的数字是什么并没有什么关系。 设最长连续相同子段的长度为$x$的方案数为$f\_x$种，答案就是$\\sum\_{i=1}^{n}if\_i$。暴力就是dp求这个东西。 枚举最长段长度$i$，那么我们要考虑计算长度为$i$的合法数量。 答案就是 $$ \\sum\_{i=0}^{n-1}\\sum_{j=1}^{n}m(m-1)^{j-1}\\times (j个\\leq i的正整数变量和为n的方案数) $$ 先考虑后面那个东西。没有$\\leq i$的限制时，隔板法，答案是$\\binom{n-1}{j-1}$。 对于$\\leq i$的限制我们容斥处理，那么答案就会是 $$ \\sum_{i-0}^{n-1}\\sum_{j=1}^{n}m(m-1)^{j-1}\\sum_{k=0}^{j}\\binom{j}{k}\\binom{n-ik-1}{j-1} $$ 尝试化简最后那个组合数并且把m和k往外提，结合组合数的计算方法，会有 $$ \\begin{eqnarray} &=&m\\sum_{i=0}^{n-1}\\sum_{k=0}^{n}(-1)^k\\sum_{j=k}^{n}(m-1)^{j-1}\\binom{j}{k} \\binom{n-ik-1}{j-1} \\newline &=&m\\sum_{i=0}^{n-1}\\sum_{k=0}^{n}(-1)^k\\frac{1}{n-ik}\\sum_{j=k}^{n}j(m-1)^{j-1}\\binom{j}{k}\\binom{n-ik}{j} \\end{eqnarray} $$ 这个式子大概是化不下去了。前面那部分我们会有$ik \\leq n$,枚举的效率是nlog的。我们按照出题人的意思，思考一下后面这坨东西的组合意义。 $$ \\sum_{j=k}^{n}(m-1)^{j-1}\\binom{j}{k}\\binom{n-ik}{j}j $$ 好像并没有什么思路。 有$n-ik$个球，我们先从中选出$j$个，再从选出的$j$个中选出$k$个。在$j$个球中我们选出一个特殊的球，对于剩下的球用$m-1$种颜色染色。 这个意义是zzq想出来的，不是我想出来的。 讨论这个特殊的球是不是这$k$个球中的，那么我们可以把它改成：有$n-ik$个球，我们从中选出$k$个。

1.  在$k$个中选出一个特殊的球，把$k$个球中不特殊的用$m-1$种颜色染色。在剩下的（$n-ik-k$个）球中选出一个子集，用$m-1$种颜色染色。
    
2.  把k个球用$m-1$种颜色染色。在剩下的（$n-ik-k$个）球中选出一个特殊的球，在其他剩下的（$n-ik-k-1$个）球中选出一个子集用$m-1$种颜色染色。
    

考虑这个东西的方案数。

*   在$k$个中选出一个特殊的，把$k$个球中不特殊的用$m-1$种颜色染色:$$k(m-1)^{k-1}$$在剩下的（$n-ik-k$个）球中选出一个子集，用$m-1$种颜色染色。这就相当于用$m$种颜色染色，第$m$种颜色表示不选:$$m^{n-ik-k}$$
*   把k个球用$m-1$种颜色染色:$$(m-1)^k$$在剩下的（$n-ik-k$个）球中选出一个特殊的球:$$n-ik-k$$在剩下的$n-ik-k-1$中选出若干个球（也可以不选）用$m−1$种颜色染色。和上面一样，相当于用$m$种颜色染色：$$m^{n-ik-k-1}$$

那么我们就有 $$ \\sum_{j=k}^{n}j(m-1)^{j-1}\\binom{j}{k}\\binom{n-ik}{j}=k(m-1)^{k-1}m^{n-ik-k}+(n-ik-k)(m-1)^km^{n-ik-k-1} $$ 只要预处理出$m−1$和$m$的次幂这个式子就可以$O(1)$算了 。 时间复杂度在枚举$i,k$,效率是调和级数的效率。也就是$O(n log n)$。