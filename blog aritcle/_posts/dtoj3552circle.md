---
title: " DTOJ3552circle\t\t"
tags:
  - 思路
url: 1033.html
id: 1033
categories:
  - DTOJ
  - Solution
date: 2018-03-12 21:28:21
---

题目等价为选三条线段。显然可以发现跨度为$1$的方案是不存在的。 在环上的问题比较麻烦，考虑将环剪开，变成线段上的问题。 分类讨论可以发现跨度为$0$的线段端点从小到大只有可能是$112233$和$122331$，跨度为$2$的线段端点从小到大只有可能是$123123$。 发现这三种情况单独都比较难计算。考虑用所有方案减去不合法方案。 首先考虑三条线段都没有交点的不合法情况，有$123321$，$112332$，$122133$。这可以通过处理出每条线段左右不想交的线段数和中间被它包含的线段数。这都是二位偏序问题，树状数组维护即可。 接着考虑三条线段有交点的不合法情况。显然只有两种情况：一是一条线段与另外两条没有交点，另外两条相交；二是一条线段与另外两条都相交。这两种情况也很难单独计算。发现这两种情况，都必定有一条线段与一条相交，与令另一条不相交，此时相交的那条线段与不相交的那条线段交或不交都不合法。因此只要处理出和每条线段相交和不相交的线段数，相乘再$\\div 2$就是不合法情况了，$\\div 2$是因为每种情况都会被考虑另一条线段的时候再计算一遍。这也是二位偏序问题，树状数组维护即可。