---
title: " BZOJ2905背单词\t\t"
tags:
  - AC自动机
  - dp
  - 线段树
url: 5809.html
id: 5809
categories:
  - BZOJ
  - Solution
date: 2018-12-25 20:55:30
---

我们建出单词的AC自动机。 如果第$i$个单词是第$j$个单词的子串，那么第$j$个单词的某个前缀对应的节点在fail树上往上跳一定能跳到第$i$个单词的结尾节点。 也就是说，第$j$个单词的某个前缀在第$i$个单词的结尾节点的fail树子树中。 记$f\[i\]$为前$i$个串，第$i$个串一定选的最大子序列和。 那么显然有 $$f\[i\]=\\max\\{f\[j\]\\}+w_i$$ 其中，$j<i$且$i$的某个前缀在第$j$个单词的结尾节点的fail树子树中。 我们可以枚举第$i$个单词的前缀。考虑如何对于一个前缀求出合法的$f\[j\]$的最大值。 我们求出fail树的dfs序，那么每个点的子树就变成了一段区间。对于第$i$个点子树对应的区间里的所有点，$f\[i\]$都是合法的。 这相当于一个区间取$\\max$的操作。 那么我们可以用一棵线段树实时维护当前AC自动机上每个点合法的$f$的最大值。 对于每个前缀在线段树上单点查询即可。