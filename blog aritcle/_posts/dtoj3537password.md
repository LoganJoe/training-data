---
title: " DTOJ3537password\t\t"
tags:
  - 分块
url: 900.html
id: 900
categories:
  - DTOJ
  - Solution
date: 2018-03-05 14:27:37
---

打表可以发现，对于任意的$i\\geqslant 1$，都有第$i+1$行和$i+3$行相同。 试证明一下。 假设$a_{i+1,j}=x$，$a_{i+2,j}=y$。那么说明在$a\_i$的前$j$项中，有$y$个出现了$x$次的数。每一个出现了$x$次的数，在$a\_{i+1}$的前$j$项中对应的位置都会有$1,2,3,…,x$。因此在$a_{i+2}$的前$j$项中，$1,2,3,…,x$都恰好出现了$y$次，所以$a_{i+3,j}=x$。证毕。 那么我们只要维护前三行即可。 考虑分块。 $f\[i\]\[j\]$表示第一行前$i$个块中$j$出现了几次，$g\[i\]\[j\]$表示第二行前$i$个块中$j$出现了几次。 预处理时，对于第一行的一个$j$，会使得$f\[i\]\[j\]+1$，$f\[i\]\[j\]+1$是第二行对应位置的值，因此也会使得$g\[i\]\[f\[i\]\[j\]+1\]+1$。 修改和预处理同理，若修改前的值为$x$，修改后为$y$，会使得$f\[i\]\[x\]-1$，$f\[i\]\[y\]+1$。同时第二行会少了一个$f\[i\]\[x\]$，多了一个$f\[i\]\[y\]+1$。因此让$g\[i\]\[f\[i\]\[x\]\]-1$，$g\[i\]\[f\[i\]\[y\]+1\]+1$即可。 对于查询。若查询$a_{2,i}$，我们知道$a_{1,i}$，记为$v$。则答案为$f\[id\]\[v\]$加上第一行中和$i$同块内的$v$的个数。若查询$a_{3,i}$，我们可以暴力求出和$i$同块内的第二行的值，也就知道了$a_{2,i}$，记为$v$。则答案为$g\[id\]\[v\]$加上第二行中和$i$同块里的$v$个数。$id$为$i$所属的块的编号$-1$。