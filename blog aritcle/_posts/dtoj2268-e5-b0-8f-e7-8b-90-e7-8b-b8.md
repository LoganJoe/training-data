---
title: " DTOJ2268小狐狸\t\t"
tags:
  - 矩阵
url: 3940.html
id: 3940
categories:
  - Solution
date: 2018-09-15 16:40:24
---

我们考虑如果知道了时刻$t$的答案，如何求出$t+1$时刻的答案。

我们可以将四个方向的答案分开考虑。以向左的答案为例，我们记录在t时刻所有方向都为左的狐狸的答案为$ans$，那么这些答案对$t+1$时刻的贡献为：

方向向上的答案$+=ans\*L$;方向向下的答案$+=ans\*R$;方向仍然向左的答案$+=ans\*S+sum\_y\*S$。其中$sum\_y$为$t$时刻方向向左的狐狸的纵坐标的和。

现在我们可以维护出所有答案，但还需要维护$sum\_x,sum\_y$.仍然以方向向左的狐狸为例，那么这些对$t+1$的时刻是：

方向向上的$sum\_x+=sum\_x\*L$;方向向下的$sum\_x+=sum\_x\*R$;同向的$sum_x+=num$.其中$num$为$t$时刻方向向左的狐狸数量。

然后就可以线性递推了。

注意到$t \\leq 10^{18}$，就矩阵快速幂优化就好了。