---
title: " DTOJ3029palindrome\t\t"
tags:
  - 字符串
  - 线段树
url: 419.html
id: 419
categories:
  - DTOJ
  - Solution
date: 2018-01-26 07:21:54
---

发现$K$很小，我们只用考虑长度为$K$以内的回文串。 先预处理出以每个点为起点，长度$\\leqslant K$的回文串个数，记为$f\[i\]$，可以用hash或者manachar解决。 现在考虑修改$\[l,r\]$。则$\[l,r-K+1\]$内的$f\[i\]$都变成$K$。这次修改还会影响到$\[l-K+r,l-1\]$和$\[r-K+2,r\]$，这两段的长度很小，可以用hash或manachar暴力解决。 再考虑询问$\[l,r\]$。左端点在$\[l,r-K+1\]$的答案即为$f\[i\]$，左端点在$\[r-K+2,r\]$的答案我们同样可以暴力算。 因此我们用一棵线段树维护字符串的形态，再用一棵线段树维护$f\[i\]$的区间修改和区间求和即可。