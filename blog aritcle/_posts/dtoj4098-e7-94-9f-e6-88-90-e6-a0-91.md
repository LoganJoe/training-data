---
title: " DTOJ4098生成树\t\t"
tags:
  - dp
  - 思路
url: 5870.html
id: 5870
categories:
  - Solution
date: 2018-12-30 21:31:36
---

### 算法一

暴搜，每次枚举下一步到达的景点以及是否加油，视实现优劣，期望得分 $30$ 至 $50$ 分。

### 算法二

我们可以把暴搜的过程记忆化，以设计DP。 记 $f(i,c,s)$ 表示当前位于景点 $i$，汽车油量为 $c$，目标总路程为 $s$ 时，到结束时花费的钱的最小值。 显然当 $s\\le 0$ 时 $f(i,c,s)=0$。当 $s>0$ 时，枚举下一步的决策，有 $$ f(i,c,s)=\\min \\begin{cases}f(b\_j,c-1,s-l\_j), a\_j=i,&\\mathrm{if\ }c>0,\\newline f(i,\\min{c\_i,C},s)+p\_i,&\\mathrm{if\ }c < c\_i\\end{cases} $$ 时间复杂度 $O(mC\\max{d_i})$，期望得分 $35$ 分。

### 算法三

我们发现钱的范围 $q\_i\\le n^2$，而路程的范围 $d\_i$ 很大，考虑改变DP的状态设计。 记 $f(i,c,q)$ 表示当前位于景点 $i$，汽车油量为 $c$，剩余钱数为 $q$ 时，之后的最大路程。 类似地，可以得到 $$ f(i,c,q)=\\max\\begin{cases}f(b\_j,c-1,q)+l\_j,a\_j=i,&\\mathrm{if\ }c>0\\newline f(i,\\min{c\_i,C},q-p\_i),&\\mathrm{if\ }c<c\_i\\land q\\ge p\_i\\end{cases} $$ 在无法转移时 $f(i,c,q)=0$ 询问时，只需枚举最小的 $q\\le q\_i$ 使得 $f(s\_i,0,q)\\ge d\_i$ 即可。 时间复杂度 $O(mC\\max{q\_i}+Tq\_i)$，期望得分 $60$ 分。

### 算法四

上述DP的瓶颈在于状态数，考虑优化状态。注意到每次加油以后，油量的状态和之前无关，所以考虑以每次加油的位置为状态进行DP。 设 $f(i,q)f(i,q)$ 表示当前位于景点 $i$，下次在 $i$ 位置加油，剩余钱数为 $q$ 时，之后的最大路程。 当 $q<p\_i$ 时，$f(i,q)=0$，否则，转移时枚举第二次加油的位置 $j$，得到 $$ f(i,q)=\\max{f(j,q-p\_i)+w(i,j,\\min{c\_i,C})} $$ 其中 $w(i,j,c)$ 为从 $i$ 到 $ j$ 经过不超过 $c$ 条道路的最大路程。这可以用DP预处理，枚举$i$ 出发的第一条路 $e$，得 $$ w(i,j,c)=\\max\_{a\_e=i}{w(b\_e,j,c-1)+l\_e} $$ 边界是 $w(i,i,0)=0$，$w(i,j,0)=-\\infty$。 询问时，只需枚举最小的 $q\\le q\_i$ 使得 $f(s\_i,q)\\ge d\_i$ 即可。 时间复杂度 $O(n^2\\max{q\_i}+nmC+Tq\_i)=O(n^4+nmC+Tn^2)$，期望得分 $75$ 分。

### 算法五

现在的瓶颈在于预处理 $w(i,j,c)$，我们发现每次 $c$ 只会减少 $1$，于是可以用倍增预处理。 设 $g(i,j,k)$ 为从 $i$ 到 $j$ 经过不超过 $2^k$ 条道路的最大路程，则当$ k>0$ 时： $$ g(i,j,k)=\\max\_x{g(i,x,k-1)+g(x,j,k-1)} $$ 注意到我们只要对所有 $i,j$ 处理出 $w(i,j,\\min{c\_i,C})$，令 $c=\\min{c\_i,C}c=min{ci,C}$，那么每次提取 $c$ 的一个二进制位 $2^k$，可得 $$ w(i,j,c)=\\max\_x{w(i,x,c-2^k)+g(x,j,k)} $$ 只需倍增 $O(\\log C)$ 轮即可。 时间复杂度 $O(n^2\\max{q\_i}+n^3\\log C+Tq\_i)=O(n^4+n^3\\log C+Tn^2)$，期望得分 $95$ 分。

### 算法六

只要把上述算法中，询问时枚举最小的 $q$ 使得 $f(s\_i,q)\\ge d\_i$ 这一步的枚举换成二分，就能把最后一步的 $O(Tq\_i)$ 优化到 $O(T\\log q\_i)$。 时间复杂度 $O(n^2\\max{q\_i}+n^3\\log C+T\\log q\_i)=O(n^4+n^3\\log C+T\\log n)$，期望得分 $100$ 分。