---
title: " DTOJ3959count\t\t"
tags:
  - 拉格朗日插值
url: 4590.html
id: 4590
categories:
  - DTOJ
  - Solution
date: 2018-10-25 22:47:32
---

与$x$互质的数的和是$\\frac{x\\varphi(x)}{2}$，平均数$\\times 2$就是$x$。也就是说$f(x)=x$。 但其实这个是错的……当$x=1$时，$f(x)=2$……因此要特判。 那么我们就是要求$\\sum_{i=L}^{i=R}i^k$。我们只用求出$\\sum_{i=1}^{x}i^k$即可，记这个为$ans(x)$，那么答案就是$ans(R)-ans(L-1)$。 我们要求的就是自然数幂和。这个东西有多种解法。 比如我测试上写的斯特林数，具体可以看[斯特林数总结](http://www.dtenomde.com/author=iftest614/article=3345/)。 但是这个出题人没有开O2，他可能是想卡掉这种常数大的写法。 因此我们只能用拉格朗日插值求。 我们知道答案是一个$k+1$项的多项式（不 我不知道） 那么我们只要知道这个多项式上的$k+2$个点，就能知道$x$取任意值时多项式的值了。 对于任意一个$i\\in\[1,k+2\]$，我们都暴力求出$ans(i)$。 然后代进拉格朗日插值法的式子 $$ans(x)=\\sum_{i=1}^{k+2}ans(i)\\frac{\\prod_{j=1,j\\neq i}^{k+2}(x-j)}{\\prod_{j=1,j\\neq i}^{k+2}(i-j)}$$ 我们枚举$i$，然后可以发现右边那个分式上面分子分母的变化都是连续的。 预处理一下阶乘和阶乘的逆元以及$x-i$的前缀积和后缀积就可以$\\Theta(K)$求出$ans(x)$。 总时间复杂度$\\Theta(K\\log K)$，瓶颈在求出$i\\in\[1,k+2\]$的$ans(i)$。