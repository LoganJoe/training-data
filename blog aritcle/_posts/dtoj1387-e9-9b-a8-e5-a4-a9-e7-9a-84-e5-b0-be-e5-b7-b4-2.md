---
title: " DTOJ1387雨天的尾巴\t\t"
tags:
  - 线段树合并
url: 1793.html
id: 1793
categories:
  - Solution
date: 2018-04-29 20:42:52
---

我们转换一下思路。利用树上差分的思想，相当于是在$1-x$的路径上和$1-y$的路径上法一袋$z$类型的粮食，再从$1-lca$和$1-fa\[lca\]$的路径上各收回一袋z类型的粮食。如果我们不考虑粮食类型的差异，那么每间房子中的粮食数量可以用差分数组然后在树上$dfs$得到。 那么关于有不同粮食的问题，我们可以对于树上每个节点，开一棵线段树，记录每种粮食的出现次数。至于这个我们可以通过差分实现。对于一个修改$(x,y,z)$,我们在$x$节点、$y$节点对应的线段树中的第$z$种粮食打上$+1$标记，在$lca$节点、$fa\[lca\]$节点对应的线段树中的第z种粮食打上$-1$标记。那么对于树上差分数组的维护，我们可以通过线段树维护来实现。对于当前节点已经合并的线段树，只需要通过记录线段树区间最大值然后向比较大的儿子走即可以走到最大的叶子结点。这样就可以统计答案。 顺便吐槽一下，自己当年写的动态开点线段树是真的丑。