---
title: " DTOJ3192Smuggling Marbles\t\t"
tags:
  - 奇技淫巧
  - 思路
  - 树形dp
url: 5717.html
id: 5717
categories:
  - Solution
  - 未分类
date: 2018-12-23 11:42:30
---

感觉直接被水淹没啊...看到题目有点不知所措。 考虑计算要求的方案相对于总方案在模意义下的概率。 $f\[x\]\[i\]\[0/1/2\]$分别表示对于$x$的子树，第$i$层的点中，有$0/1/2+$个点到达$x$的概率。 那么有以下转移： $$f\[x\]\[0\]\[0\]=f\[x\]\[0\]\[1\]=\\frac{1}{2},f\[x\]\[0\]\[2\]=0$$ $$\\begin{aligned}f\[x\]\[i\]\[0\] &\\Leftarrow f'\[x\]\[i\]\[0\] \\times f\[son\]\[i-1\]\[0\] \\newline f\[x\]\[i\]\[1\] &\\Leftarrow f'\[x\]\[i\]\[0\] \\times f\[son\]\[i-1\]\[1\] + f'\[x\]\[i\]\[1\] \\times f\[son\]\[i-1\]\[0\] \\newline f\[x\]\[i\]\[2\] &\\Leftarrow f'\[x\]\[i\]\[0\]\\times f\[son\]\[i-1\]\[2\]+f'\[x\]\[i\]\[1\]\\times f\[son\]\[i-1\]\[2\] \\\ &+ \ f'\[x\]\[i\]\[1\]\\times f\[son\]\[i-1\]\[1\]+f'\[x\]\[i\]\[2\]\\times f\[son\]\[i-1\]\[2\] \\\ &+ \ f'\[x\]\[i\]\[2\]\\times f\[son\]\[i-1\]\[1\]+f'\[x\]\[i\]\[2\]\\times f\[son\]\[i-1\]\[0\]\\end{aligned}$$ 转移完儿子后要将$f\[x\]\[i\]\[2\]$加到$f\[x\]\[i\]\[0\]$里面。 这样做是$O(n^2)$的。考虑优化。 对于每次合并的时候，我们只关心深度相同的部分，而在所有的儿子的dp值，除了深度最大点的dp值其他都与其儿子的dp值有关。也就是说，我们可以将所有的dp值合并到其深度最大的儿子的dp值上。那么下面的dp就是无关的了。 具体我也不是很清楚。 效率$O(n)$。