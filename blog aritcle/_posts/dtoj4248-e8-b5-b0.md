---
title: " DTOJ4248走\t\t"
tags:
  - 期望
  - 高斯消元
url: 7154.html
id: 7154
categories:
  - DTOJ
  - Solution
date: 2019-03-27 22:35:25
---

记$f\[i\]\[j\]\[k\]$为当前在点$i$，当前串结尾匹配到$a$串的第$j$位，匹配到$b$串的第$k$位，期望走多少步能停止。 转移的话就枚举一条边$i\\rightarrow to$，然后在串末尾加上这条边的字符，计算新串匹配到$a$串的位置$j'$，匹配到$b$串的位置$k'$，那么有 $$ f\[i\]\[j\]\[k\]=1+\\frac 1 {deg\_i}\\sum\_{i\\rightarrow to}f\[to\]\[j'\]\[k'\] $$ 其中$deg_i$表示点$i$的出度。 由于图中是有环的，因此$f\[i\]\[j\]\[k\]$要通过高斯消元求出。 直接消元是$\\Theta((n|a||b|)^3)$的。 容易发现，$k'=k+1$或者$k'=k$，那么如果将$(i,j,k)$看成一个点的话，其实是一个分层图。 我们从大到小枚举$k$，这样$f\[i\]\[j\]\[k+1\]$就已经是已知的，我们只用求解当前层的$f\[i\]\[j\]\[k\]$，同样高斯消元即可。 时间复杂度$\\Theta((n|a|)^3|b|)$。