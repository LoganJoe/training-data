---
title: " DTOJ3976植物大战僵尸\t\t"
tags:
  - 博弈
  - 数位dp
url: 4871.html
id: 4871
categories:
  - DTOJ
  - Solution
date: 2018-10-31 15:06:10
---

我们称一个局面必胜当前仅当这个局面能使玩家必败。 考虑怎么判断一个回合开始时的局面是否必胜。 先从最简单的开始。假如位置$i$上有$\\geq 2^i$个僵尸，那么一定必胜，我们只要每次把僵尸对半分即可。 如果位置$i$上有$2^k$个僵尸，则它们要全部到达位置$k$才能必胜。那么我们可以将位置$i$上的这$2^k$个僵尸，认为是位置$i-k$上的一个僵尸。 如果位置$i$上有$x$个僵尸，我们就将$x$拆成若干个$2^k$的和，然后每个$2^k$都变成位置$i-k$上的一个僵尸。 那么必胜的条件就是位置$1$上至少有两个僵尸。 考虑具体化一下这个必胜的条件。 我们把位置$1$当作最高位，位置$2$当作次高位，如此从高到低。每个位置上的僵尸数量为这位的值。 那么我们得到了一个长度为$m$的数字串，$m=\\max_{i=1}^{n}\\{a\_i\\}$。 我们将这个数字串从低到高进位， 每位为$0/1$，即满足这是一个二进制数。 那么每个局面都对应着一个二进制数，必胜的条件就是这个二进制数$\\geq 2^m$。 记这个二进制数为$v$。 那么AI使玩家必败的行动策略的数量，就是满足不等式组 $$\\begin{cases}x+y=v\\\x\\geq 2^{m-1}\\\y\\geq 2^{m-1} \\end{cases}$$ 的合法解的个数。 合法解指的是存在一种上下移动僵尸的方案，使得第一行局面对应的二进制数$=x$，第二行局面对应的二进制数$=y$。 如果$a\_i>n$，那么这些僵尸一定都会被消灭，就不影响局面的胜负。我们就当这些僵尸不存在，如果有必胜方案就乘上这部分对应的方案数。 我们只要知道了第一行局面，也就知道了第二行的局面。 那么$n\\leq 100,a_i\\leq 20$的情况就可以存下局面对应的二进制数然后去dp了。 然而数据里所有的$a_i$都$\\leq 10$。 我们从低位到高位枚举每个位置要怎么移动僵尸。 记$f\[i\]\[j\]$为第一行局面进位到（从低到高）第$i$位，这位未进位时的数为$j$的方案数。 然后我们枚举下一位有多少僵尸在第一行进行转移。 第一行能必胜的局面数就是$f\[m\]\[i\]$，其中$i\\geq 1$。 但是第一行能必胜不代表第二行能必胜。我们还要考虑$y=v-x$是否$\\geq 2^{m-1}$。 由于减法存在借位，可能会对最高位的值造成$1$的影响。 因此我们dp时还要记录一下比当前位低的位组成的数字和$v$中这些位组成的数字的大小关系。