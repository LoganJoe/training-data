---
title: " DTOJ2476ZCC Loves Sequences\t\t"
tags:
  - 思路
url: 878.html
id: 878
categories:
  - DTOJ
  - Solution
  - 不会证
date: 2018-03-04 11:48:21
---

先讲一下正常的写法。 和seq相似的序列可以通过从seq里删掉一个数，再选一个位置插入一个数得到。因此我们可以枚举删掉的数，加入的位置和加入的数，得到相似的序列。但这样子会有重复，因此我们可以把已经计算过的序列hash起来判重。然而加入的数范围可以很大，发现和seq里有出现的数相同最多只有$n$个，因此我们可以把剩下的数用$-1$表示，代表没有在seq中出现的数。显然若答案序列有包含$-1$是可以单独计算方案数的。 效率是O($n^3log\\space n^3$)或者O($n^4log\\space n^3$)，反正能过。 再讲一下非正常写法。 考虑直接计算方案数。若seq中任意两个元素都不相同的话，答案是$n^2(bound-1)+n-(n-1)-(n-1)$。$n^2$是枚举删除的位置和插入的位置，$bound-1$是插入的数。$-1$是因为如果在数$x$前面插入$x$和在数$x$后面插入$x$是一样的，因此要求插入的数不能和插入位置的前面那个数一样，$+n$是补开头插入不可能与前面的数一样，但是也被扣了，因此要补回来。一个$n-1$是在删掉的位置加入和删掉的数一样的数，也就是得到seq，这种情况只能记$1$次，却被记了$n$次。另一个$n-1$是把删掉的数插在删掉的位置后一位，和把后一位的数字删掉加入在前一位一样，就是假如seq为$1 2 3$，删掉$1$加在$2 3$中间和删掉$2$加在$1 3$前面一样，这种情况会发生$n-1$次。 假如seq中相同的元素都连在一起，记有$cnt$个不同的数，答案是$cnt\\times n(bound-1)+cnt-(cnt-1)-(cnt-1)$。可以看做把相同的元素都压在一起，变成长度为$cnt$的任意两个元素都不相同的序列，只是插入的位置变成了$n$个。 但这样还是会多算，在$abab$的时候，即隔一个数相同，记有连续的$cnt$对数间隔相同。举个例子，$1 2 1 2$是有连续$2$对数间隔相同。前面的计数方法会把后面的$1 2$认为和前面的$1 2$不同，因此会有重复，显然只有加$a$或$b$产生的重复才是我们要多考虑的。经打表得知会多$\\frac{cnt(cnt+1)}{2}$种…我的理解是，前面删后面加会和前面加后面删重复，因为序列是$abab$循环的。比方说在$bab$后加$a$，和在$aba$前加$b$一样。因为插入的数不能和前一个位置一样（之前已经考虑过），所以$a$后面只能加$b$，$b$后面只能加$a$。因此可以加入的$cnt+1$个位置，插入位置会和前面每个位置产生一次重复，也就是$1+2+…+cnt$，因此是$\\frac{cnt(cnt+1)}{2}$。 以上关于这种方法的讲述其实都是口糊，不保证想法正确，不保证解法正确，我也很想hack它但一直没有成功。