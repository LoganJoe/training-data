---
title: " DTOJ4089line\t\t"
tags:
  - 凸包
url: 5877.html
id: 5877
categories:
  - DTOJ
  - Solution
date: 2018-12-30 22:13:38
---

显然$a\_i$是一个等差数列，不妨记$a\_i=a\_1+(i-1)d$。 考虑对于一个$d$，有多少个合法的$a\_1$。 我们先考虑一下$d$的范围，由于$l\_i\\leq a\_i\\leq r\_i$，那么有 $$ l\_i\\leq a\_1+(i-1)d\\leq r\_i $$ 移项后是 $$ \\left \\lfloor \\frac{l\_i-a\_1}{i-1}\\right \\rfloor \\leq d\\leq \\left \\lceil \\frac{r\_i-a\_1}{i-1}\\right \\rceil $$ 那么就能确定$d$的范围。实际上并没有什么用。 接着考虑对于固定的$d$，$a\_1$的范围。 同样对于之前的式子移项，有 $$ l\_i-(i-1)d\\leq a\_1\\leq r\_i-(i-1)d $$ 也就是说我们要维护$\\max\\{l\_i-(i-1)d\\}$和$\\min\\{r\_i-(i-1)d\\}$关于$d$的变化情况。 这是一个上凸壳和一个下凸壳，很容易在$\\Theta(n)$的时间内维护出来。 而答案就是上凸壳和下凸壳形成的凸包中的整点的个数。 我们将凸包按照端点的$x$坐标分成许多部分，那么每部分的最大值/最小值来源都是相同的，因此每部分的整点个数可以用等差数列求和公式算出来，需要稍微分讨一下。 测试时我这题看到式子没有马上想到凸包，绕了一大圈后发现可以用凸包维护，但是变得很复杂了，于是写+调了3h+终于对了，代码一度写到5k。