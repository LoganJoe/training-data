---
title: " DTOJ3727荣誉称号\t\t"
tags:
  - 并查集
  - 树形dp
url: 2040.html
id: 2040
categories:
  - DTOJ
  - Solution
date: 2018-05-23 07:54:42
---

编号为$x$的位置向编号为$\\lfloor \\frac{x}{2}\\rfloor$的位置连一条边，那么就得到了一个树的结构。把$a_i$当作编号为$i$的点的权值，那么现在问题就变成了修改点权使得编号$\\geqslant 2^k$的点向上走$k$步经过的边权和为$m$的倍数，求最小的修改代价。 容易发现，第$k+1$层每个点到根的边权和都是$m$的倍数， 第$k+2$层每个点到根的边权和都要和第$1$个点的点权在$\\%m$意义下相等。接下来每层的每个点到根的边权和都要和这个点第$2^k$级祖先到根的边权和在$\\%m$意义下相同。 那么我们把从第$k+2$层开始的所有点，和它们的第$2^k$级祖先用并查集压在一起，形成$2^{k+1}-1$个连通块（假设$n\\geqslant 2^{k+1}-1$）。那么问题变成了，修改点权使得$1$到第$k+1$层每个点的边权和为$m$的倍数，且每个连通块的点权在$\\%m$意义下相等的最小修改代价。 我们可以很容易地求出$g\[i\]\[j\]$表示将第$i$个连通块的点的点权都修改为$\\%m=j$的代价。记$f\[i\]\[j\]$为$i$到它子树内的每个叶子（第$k+1$层点）的边权和都$\\%m=j$的最小代价。那么答案就是$f\[1\]\[0\]$。 考虑转移，显然有 $$f\[i\]\[j\]=min\\{f\[i<<1\]\[k\]+f\[i<<1|1\]\[k\]+g\[i\]\[(j-k+m)\\%m\]\\}$$ 即枚举第$i$个连通块内的点权在$\\%m$意义下是多少进行转移。 时间复杂度$\\Theta(2^{k+1}m^2)$。要注意$2^{k+1}-1>n$的情况。