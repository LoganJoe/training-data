---
title: " DTOJ2983prefix\t\t"
tags:
  - 可持久化线段树
url: 5746.html
id: 5746
categories:
  - Solution
date: 2018-12-23 14:59:06
---

看到题目第一反应：Trie树！区间的话就可持久化Trie树！ 然后每次要遍历Trie树就嗝屁了... 考虑不在数据结构里维护前缀信息。将前缀的信息用hash值维护。 那么我们顺序插入所有前缀的hash值。用map存储每个hash值最后的出现位置。按照序列建立主席树，第$i$棵主席树里面存$\[1,i\]$内所有字符串，而线段树内下标保存每个字符串的有效前缀数量。那么对于一个有效的前缀，我们让最靠后的那个字符串来保留它的代价。那么我们在查询$\[l,r\]$的时候，在第$r$棵主席树内询问代价，就不会计入$\[1,l\]$内的答案了。 而建主席树的时候，对于某个前缀的hash值，假设已经出现就把原来位置的贡献扣掉并且给当前串加上相应贡献即可。