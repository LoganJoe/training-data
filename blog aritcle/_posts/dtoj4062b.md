---
title: " DTOJ4062B\t\t"
tags:
  - 思路
  - 期望
url: 5423.html
id: 5423
categories:
  - DTOJ
  - Solution
  - 不会证
date: 2018-12-10 22:26:21
---

假如我们能求出除了第一个数以外的每个数被操作的期望次数，那么这些数的期望操作次数加起来再加上$a\_1$就是答案了。 考虑求$a\_i$被操作的期望次数。 我们发现期望和除了$a\_1,a\_i$之外的数是无关的。（我发现不了 不会证） 并且我们操作$a\_1$和$a\_i$的概率都是$\\frac{1}{2}$。 现在考虑只有$a\_1$和$a\_i$要怎么求$a\_i$被操作的次数。 我们转换一下问题：我们从$(a\_1,a\_i)$出发，每次随机向下向左走，碰到坐标轴就结束，求向下走的期望步数。 走到$(0,x)$的步数是$a\_i-x$，走到$(x,0)$的步数是$a\_i$，因此期望步数就是 $$\\sum\_{i=0}^{a\_i-1} i\\times \\frac{\\binom{a\_1-1+i}{i}}{2^{a\_1+i}}+a\_i\\times \\left (1-\\sum_{i=0}^{a\_i-1} \\frac{\\binom{a\_1-1+i}{i}}{2^{a\_1+i}}\\right )$$ 直接算一次是$\\Theta(a\_i)$的，总的时间复杂度是$\\Theta(\\sum_{i=2}^{n}a\_i)$的。 观察一下式子，然后作差可以发现，从$a\_i$的期望步数推到$i+1$的期望步数是可以先预处理然后$\\Theta(1)$算的。 这样时间复杂度就变成了$\\Theta(\\max_{i=2}^{n}a_i)$。