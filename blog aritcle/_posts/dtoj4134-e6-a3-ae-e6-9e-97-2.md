---
title: " DTOJ4134森林\t\t"
tags:
  - 思路
url: 6585.html
id: 6585
categories:
  - Solution
date: 2019-02-24 11:44:33
---

首先可以看出的是，答案一定是一个三叉戟，并且其中两条一定在直径上。我们考虑实时维护这个三叉戟。 出题人给出了一个美妙的LCT做法。但是实际上并不需要那么麻烦，我们直接分讨更新当前三叉戟的直径和中间延伸出去的某条链即可。具体地： 我们考虑当前三叉戟，直径起始点分别为$x,y$，直径的lca，长度$len$，以及延伸出去的最长的一条的长度$Max$。其中，我们令$x$一般为直径中深度较深点。 对于新加入的某个点，我们用倍增维护其的lca。下面分讨其与$x$的最近公共祖先$nowlca$与$lca$的关系。

*   当$nowlca$的深度比$lca$的深度浅时，假设$i$与$x$的长度大于$len$，那么这条就是新直径了。我们更新直径起终点$y$，lca，以及直径的长度为原来的长度$+1$。另外假设$i$到$nowlca$的长度大于$Max$，那么这条就可以成为延伸出去的那条侧链。
*   当$nowlca$的深度比$lca$的深度深时：现在$x,y,i$组成了一个三叉戟的形状。其中，两交点分别为$nowlca,lca$。我们令$nowlca$在$(x,lca)$的路径上。那么假设这条边可以成为直径，并且取代的是$x$点，即$deep\[x\]<deep\[i\]$，那么$len+1,x=i$。否则考虑其取代的是$nowlca \\to lca \\to y$的这条路径。同样有$len++,lca=nowlca,y=i$。另外再考虑是否能成为延伸出去的链即可。