---
title: " DTOJ2467树\t\t"
tags:
  - 状压dp
url: 5143.html
id: 5143
categories:
  - DTOJ
  - Solution
date: 2018-11-16 16:31:46
---

发现$W\\leq 7$，因此我们可以考虑一行行地做。 由于向南砍的树会占两行，因此我们得存下当前这行已经被占的格子。 $W$很小，我们考虑状压。 记$f\[i\]\[j\]$为考虑完前$i-1$行的字母，第$i$行被占据的格子状态为$j$的方案数。$g\[i\]\[j\]$为考虑完前$i-1$行的字母，第$i$行被占据的格子状态为$j$的所有方案砍树的总数。 记$a\[i\]\[j\]$为上一行被占据的格子状态为$i$，这一行被占据的格子为$j$，上一行的字母填法的数量。$b\[i\]\[j\]$为上一行被占据的格子状态为$i$，这一行被占据的格子为$j$，上一行的字母所有填法砍树的总数。 我们可以枚举$i$，然后枚举这行字母的填法，按照题意模拟就能求出下一行被占据的格子的状态。这样就能求出$a\[i\]\[j\]$和$b\[i\]\[j\]$了。 那么转移就有 $$f\[i\]\[j\]\\times a\[j\]\[k\]\\Rightarrow f\[i+1\]\[k\]$$ $$f\[i\]\[j\]\\times b\[j\]\[k\]+g\[i\]\[j\]\\times a\[j\]\[k\]\\Rightarrow g\[i+1\]\[k\]$$ 注意最后一行字母的填法和之前的不同，要特殊考虑。 即我们用状压dp求出前$N-1$行的答案，然后枚举最后一行被占据的格子的状态，计算出合法的填法数和砍树的总数，从而求出最终的答案。 时间复杂度$\\Theta(H4^W)$。 神仙slz用了插头dp，时间复杂度$\\Theta(HW2^W)$，跑的飞快。