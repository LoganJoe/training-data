---
title: " DTOJ2469叶落归根\t\t"
tags:
  - 分块
  - 矩阵
url: 3891.html
id: 3891
categories:
  - Solution
date: 2018-09-09 19:19:19
---

要计算一个点的环的方案数，我们很容易想到对于邻接矩阵做矩阵乘法。

考虑做矩阵乘法，单次是$O(n^3)$的，而我们明显要求出所有的矩阵，这个东西显然没法快速幂优化。

但是我们想到，矩阵乘法是满足结合律的，所以对于一个$A^Q$，我们可以把它拆成两个部分$A^{s\_1},A\_{s_2},s1+s2=Q$。

于是对于矩阵的次幂进行拆分，我们处理出$A^1,A^2,...,A^{\\sqrt n}$以及$A^{2\\sqrt n},A^{2\\sqrt n},...,A^{n}$，然后对于任意一个位置的矩阵对角线值，可以由两个矩阵$O(n)$乘出来。

于是时间效率就是$O(N^3\\sqrt N+NQ)$。