---
title: " JZOJ6005数学\t\t"
tags:
  - FFT
  - 奇技淫巧
  - 定理
  - 数学
url: 6094.html
id: 6094
categories:
  - Solution
date: 2019-01-18 22:44:24
---

考虑我们现在要求的东西：$n$个数里面选出$i$个数，选出的数的乘积的和。用暴力$dp$可以做到$O(n^2)$。 这个东西显然是可以用多项式卷积优化的。那么效率就可以拿到$O(n \\log ^2 n)$的了。但是$p$不是NTT模数，所以需要用分治FFT，并且需要卡精。任意模数NTT也可以。 现在考虑怎么处理那个巨大无比的$n$。现在要求的是一个对称轮换多项式$\\prod_{i=1}^{n}(x+i)$在$\\mod p$下有多少项是非零的。 首先设$n = ap+b$。$n \\equiv b \\mod p$。答案可以表示为 $$ \\left(\\prod_{i=1}^{p}(x+i)\\right)^a\\prod_{i=1}^{b}(x+i) $$ 很容易可以看出这是对的，因为在这时多项式是满足幂结合的。 接下来考虑$\\prod_{i=1}^{p}(x+i)$。可以发现，在$\\mod p$下，仅当$x \\in \\mathbb{Z},x \\in\[0,p-1\]$的时候这个多项式为0。同样在$\\mod p$意义下考虑$x^p-x=x(x^{p-1}-1)$，其由费马小定理得$x^{p-1}\\equiv 1 \\mod p$，于是在模$p$意义下，当$x \\in \\mathbb{Z},x \\in\[0,p-1\]$时这个多项式为$0$。 所以在$\\mod p$意义下考虑，由唯一分解定理，有 $$ \\prod_{i=1}^p(x+i)\\equiv x^p-p \\mod x $$ 式子可以写成 $$ x^a(x^{p-1}-1)^a\\prod_{i=1}^{b}(x+i) $$ 该多项式某一项为$0$，考虑两个多项式的简单卷积，仅当存在任一子卷积不为0。 现在分别考虑前后两个的非零项个数。对于前半部分，舍去$x^p$这个整体右移，做二项式展开，得 $$ (x^{p-1}-1)^a=\\sum_{i=0}^{a}x^{(p-1)i}\\binom{a}{i}(-1)^{a-i} $$ 考虑某一项为$0$,仅当组合数在$\\mod p$下为0。 那么$\\binom{a}{i}$非0，当且仅当$i$在$p$进制下每一位都不超过$a$的同一位。 考虑对于$a$做进制转换，那么对于$a$的每一位$a\_i$，其非零项个数就是$\\prod (a\_i+1)$。 而可以想到的是，这个东西其实就是对$n$做$p$进制转换后舍掉最后一位。舍去的最后一位即为$b$。 现在回过头来，考虑$\\prod_{i=1}^{b}(x+i)$。 前面提到过，这个是对称轮换式，可以用分治FFT求出。 现在考虑答案怎么统计：分成两类讨论

*   $b<p-1$，此时前面任一非零项的次数一定都是$p-1$的倍数，因此后面的轮换式对于答案的贡献与前面是互不重叠的。那么其答案，即是前面非零项与后面非零项的个数之积。
*   $b=p-1$。这个时候前后两个东西就并没有区别了。因为此时，后面那个东西即是前面的一个分型。直接做即可。

需要用巧妙的技巧来卡$FFT​$的精度。写双模数$NTT​$R然后再CRT合并也可以。