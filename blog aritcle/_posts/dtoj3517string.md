---
title: " DTOJ3517string\t\t"
tags:
  - 奇技淫巧
  - 期望
url: 422.html
id: 422
categories:
  - DTOJ
  - Solution
date: 2018-01-26 07:48:03
---

不断重复题目所述的实验，把每次实验得到的$S$串连接在一起。 分成三类：

1.  出现在实验结束位置的$T$串，即有几个实验就有几个。
2.  除第$1$类外出现的$T$串，即一个实验的结束部分和下一个实验的开头部分拼起来的$T$串。
3.  除前$2$类之外的其他点。

记三类出现的频率分别为$p1，p2，p3$。 则答案为$\\frac{1}{p1}$，即$S$串的平均长度。 $p1+p2$可以看成出现$T$串的概率，我们有

$p1+p2=\\frac{1}{m^n}$①

$p2$其实是$p1$的后一段作为$T$串的开头，新的实验开头再一段作为$T$串的结尾。因此枚举实验在$T$串的哪个位置结束，我们有（其中$fail$为kmp算法的$fail$数组）

$p2=p1\\times (\\frac{1}{m^{n-fail\[n\]}}+\\frac{1}{m^{n-fail\[fail\[n\]\]}}+…)$②

将②代入①，两边同时$\\times \\frac{m^n}{p1}$，我们有

$\\frac{1}{p1}=m^n+m^{fail\[n\]}+m^{fail\[fail\[n\]\]}+…$

即

$ans\[i\]=ans\[fail\[i\]\]+m^i$