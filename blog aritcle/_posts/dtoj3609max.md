---
title: " DTOJ3609max\t\t"
tags:
  - 期望
  - 概率dp
  - 状压dp
url: 1364.html
id: 1364
categories:
  - DTOJ
  - Solution
date: 2018-04-09 15:15:07
---

发现$m$很小，容易想到状压dp。 考虑期望的线性性，将每个最大值的贡献拆开考虑。 记$f\[i\]\[j\]\[S\]$表示前$i$个数中最大值为$j$，且使用了$S$中的操作的概率。枚举当前的数的值和使用操作的集合，乘上对应概率即可转移。 也就是说，我们要预处理一个$g\[i\]\[j\]\[S\]$表示第$i$个数使用了$S$中的操作，值为$j$的概率。枚举接下来要使用的是哪个操作即可转移。注意这样转移得到的概率是有考虑选择操作的顺序的，但实际这个不应该考虑，因此要最后消序或者限制转移。 那么对于$f$，我们有 $$f\[i\]\[j\]\[S\_1\]\\times g\[i+1\]\[k\]\[S\_2\]\\rightarrow f\[i+1\]\[max(j,k)\]\[S\_1|S\_2\]$$ 答案即为$\\sum_{i=1}^{n}if\[n\]\[i\]\[2^m-1\]$。 时间复杂度上界$\\Theta(n(mc)^23^m)$。由于实际状态数较少，可以通过。 将$max(j,k)$拆开分类讨论即可少掉一个$mc$，使效率看上去更科学，然而我考场并没有想出来。