---
title: " COGS2652秘术「天文密葬法」\t\t"
tags:
  - 分数规划
  - 树形dp
  - 树链剖分
url: 1045.html
id: 1045
categories:
  - Solution
  - 其他OJ
date: 2018-03-15 19:08:46
---

要最小化一个分式，显然先分数规划，二分一个$ans$。问题转化为找一条长度为$m$的路径，使得权值和$\\leqslant 0$。 当然可以用点分治，但是效率是$O(nlog^2\\space n)$的。 考虑神奇的长链剖分。 记$f\[i\]\[j\]$为以$i$为根的子树内，到深度为$j$的点的最小权值和。 对于重儿子直接继承$f$，轻儿子暴力更新。 但是转移时还要加上与儿子边之间的权值，for一遍加的话复杂度就退化了。 记$g\[i\]$表示以$i$为根的子树整体的$f$值被加了多少，也就是说用$f\[i\]\[j\]+g\[i\]$代表真正的$f\[i\]\[j\]$。 那么$g$就直接从重儿子那里转移过来即可。 注意要用指针动态分配空间，或者预处理出按重儿子优先的树剖序。