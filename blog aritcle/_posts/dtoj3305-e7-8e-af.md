---
title: " DTOJ3305环\t\t"
tags:
  - 数学
url: 3578.html
id: 3578
categories:
  - DTOJ
  - Solution
date: 2018-08-25 23:48:56
---

记所有数字的和为$Sum$，那么每段和的$gcd$，一定是是$Sum$的因数。 那么我们考虑枚举$Sum$的一个因数$x$，计算如果优美程度为$x$或$x$的倍数时，最多能分成几段。 记$b\_i=(\\sum\_{j=1}^{i}a\_i)\\%x$。那么最多能分成的段数就是出现次数最多的$b\_i$的出现次数。因为如果$b\_i=b\_j$且$i<j$，那么$i+1\\sim j$的和一定是$x$的倍数。 由于$b_i$可能很大，开数组存不下出现次数，我们可以用map代替。 但是map常数较大，可能会被卡常。我们还可以用sort，看看连续相同的段最长是多少。 但这样一次都是$\\Theta(n\\log n)$的。更好的方案是用hash表，可以做到$\\Theta(n)$，不过sort也能过就是了。