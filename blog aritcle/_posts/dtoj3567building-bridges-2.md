---
title: " DTOJ3567Building Bridges\t\t"
tags:
  - 线段树
url: 3905.html
id: 3905
categories:
  - Solution
date: 2018-09-09 20:50:03
---

我们注意到这个东西可以dp。

$f\[i\]$为抵达$i$根柱子的最小代价。那么有：

$$f\[i\]=\\min_{1 \\leq j < i}\\left\\{f\[j\]+(h\_i-h\_j)^2+\\sum_{k=j+1}^{i-1}w_i\\right\\}$$

这个东西可以斜率优化。但是斜率不单调，x也不单调。于是我们不能用单调队列维护。具体地，可以看做一堆$k = -2*h\_j,b = f\[j\]+h\_j^2-sum\_j $的直线，其中$sum\_{j}=\\sum_{i=1}^{j}w_i$。

这个东西我们可以$CDQ$分治，按照$h$排序以后就是单调的。但是我们有一种更加好写的方法。

对于每条直线，我们可以看做是首项为$k+b$，公差为$k$的等差数列。那么我们相当于是维护一个数组，然后在一段区间内对若干等差数列取最大值。这题之前有一道类似的。我们可以按照$h_i$建出权值线段树，然后在每个位置维护区间内的等差数列最值，具体的可以分类讨论。