---
title: " DTOJ1498法法塔的奖励\t\t"
tags:
  - 树形dp
  - 线段树合并
url: 1675.html
id: 1675
categories:
  - DTOJ
  - Solution
date: 2018-04-24 11:28:07
---

用$f\[i\]\[j\]$表示，以$i$为根的子树内，选的第一个点权值为$j$，最长的不下降子序列长度。 记$val\_i$为第$i$个点的权值，那么有 $$f\[i\]\[j\]=max\\{f\[son\]\[j\]\\}$$ $$f\[i\]\[val\_i\]=max_{j\\leqslant val\_i}\\{f\[son\]\[j\]\\}+1$$ 那么节点$i$的答案就是$f\[i\]\[val\_i\]$。 单独考虑每个点，相当于区间询问最大值和单点修改。 那我们对于每个节点都开一个线段树，第一种转移相当于将所有儿子的线段树合并，第二种转移就相当于在合并后的信息上区间询问最大值后单点修改。