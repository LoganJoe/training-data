---
title: " DTOJ3865树上路径\t\t"
tags:
  - Link-Cut Tree
  - 动态dp
url: 3541.html
id: 3541
categories:
  - DTOJ
  - Solution
date: 2018-08-25 23:37:23
---

这题有点神仙。 我们先考虑$u$到$v$的答案要怎么算。显然重复走只有两种：往子树走然后回来和往回走一步。 我们将$u$到$v$的路径看成一段区间，那么我们可以用dp求出走到第$i$个点的方案数。再记一下第$i$个点是否已经经过两次即可转移。 现在考虑怎么维护答案。 由于有加边和删边，我们考虑LCT。每棵splay都是一条重链，那么我们考虑维护这条重链的方案数。 splay中的每个点，维护这个点的子树对应的重链区间的方案数。 为了求方案数，我们要维护4个dp值，分别表示这段区间的左/右端点被经过了$1/2$次。合并儿子信息的时候，我们只要考虑要不要在右半段的左端点往回走一步，即多覆盖左半段的右端点和右半段的左端点一次。 要注意左半段/右半段只有一个点的情况，此时转移到的dp状态略有不同。 dp的初始化要用到每个点除重链外的子树大小。 那么我们对splay上的每个点维护除重链外的子树大小。在access和Link的时候要注意修改一下。