---
title: " DTOJ2195后缀表达式\t\t"
tags:
  - dp
  - 二分图
  - 奇技淫巧
url: 411.html
id: 411
categories:
  - DTOJ
  - Solution
date: 2018-01-24 21:35:23
---

按表达式为后序遍历建出树，运用交换律和结合律我们可以先把某些非叶子节点和它父亲合并起来。 记$f\[x\]$表示以$x$为根的子树用后缀表达式最少需要的存储单元，$g\[x\]\[i\]$表示在$f\[x\]$的前提下，是否能够以字符$i$作为后缀表达式的开头。 发现如果$x$有一个$i$的叶子节点，并且$x$存在某个非叶结点$son$，且$g\[son\]\[i\]=1$，说明如果使叶子节点$i$和非叶节点$son$相邻，两个字符$i$就在后缀表达式就可以相邻，使答案少$1$。 其实这就是叶子节点和非叶节点的匹配问题，我们当然要使匹配越多越好，因此求的就是最大匹配，即$f\[x\]=(\\sum_{x\\rightarrow y}{}f\[y\])+1-最大匹配$。 接下来考虑维护$g\[x\]\[i\]$。如果某个非叶节点$son$不在某个最大匹配中，则在$son$子树内能做开头的$i$，在$x$的子树内也能做开头。我们先用匈牙利算法求出一个最大匹配，如果某个非叶结点$son$在当前的最大匹配中，我们尝试用匈牙利算法替换$son$的匹配，如果存在另一种方案可以替换，则$son$就可以不在某个最大匹配中。 注意匹配的初始化。