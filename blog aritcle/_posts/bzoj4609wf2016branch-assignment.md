---
title: " BZOJ4609[Wf2016]Branch Assignment\t\t"
tags:
  - dp
  - 决策单调性
  - 带权二分
url: 6417.html
id: 6417
categories:
  - BZOJ
  - Solution
date: 2019-02-08 12:02:36
---

题目有锅，是单向边。 先跑两遍Dijkstra求出总部到点$i$的最短路$dist1\[i\]$和点$i$出发到总部的最短路$dist2\[i\]$。 考虑一个组需要走的距离。 记这个组有$size$个部门，那么每个部门都要到总部$size-1$次，总部也要到每个部门$size-1$次。 那么总共要走的距离就是组内所有点的$dist1$和$dist2$的和再$\\times (size-1)$。 有一个结论，我们按照$dist1+dist2$从大到小给点排序后，每组的点是一段连续的区间。 因为我们实际上要给每个点的$dist1+dist2$赋一个对答案贡献的系数，根据排序不等式，$dist1+dist2$从大到小排序时，系数从小到大最优。 因此我们还可以知道，每组点的个数是越来越多的，虽然这个结论没有什么用。 知道了是连续区间后，我们就可以开始dp了。 记$f\[i\]\[j\]$为前$i$个点分成$j$组的最小总距离。 枚举最后一组点有哪些，我们有 $$ f\[i\]\[j\]=\\min_{k=0}^{j-1}\\{f\[k\]\[j-1\]+(i-k-1)(Sum\[i\]-Sum\[j\])\\} $$ 这样是$\\Theta(n^3)$的。 观察一下可以发现，这个转移满足决策单调性。对于同一个$i$，$j$增大时，最优决策点是右移的；对于同一个$j$，$i$增大时，最优决策点也是右移的。 利用决策单调性我们可以优化到$\\Theta(n^2\\log n)$。 这样已经可以通过了，但还可以更优。 $f\[i\]\[j\]$其实关于$j$是一个下凸的函数，我们可以用dp凸优化，也就是带权二分，把第二维弄掉。 然后就变成了一个1D1D的dp，利用决策单调性可以做到$\\Theta(n\\log n)$。 总时间复杂度$\\Theta(n\\log ^2 n)$。