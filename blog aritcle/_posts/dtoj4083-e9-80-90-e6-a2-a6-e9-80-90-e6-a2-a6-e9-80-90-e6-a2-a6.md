---
title: " DTOJ4083逐梦逐梦逐梦\t\t"
tags:
  - 二分
  - 可持久化线段树
url: 5720.html
id: 5720
categories:
  - DTOJ
  - Solution
date: 2018-12-23 11:22:29
---

先考虑如何选最优，显然要尽量选大的。 我们将$\[L\_i,R\_i\]$的wxh按权值从大到小排序，然后选前$K\_i$个。 如果这$K\_i$个中奇偶都成对的话，那么前$K\_i$个的权值和就是答案了。 如果不成对的话，我们得删掉一个奇数/偶数，然后再选一个偶数/奇数。 显然我们是删掉前$K\_i$中最小的奇数/偶数，也就是最靠后面的。然后找到后面第一个偶数/奇数。 考虑如何快速实现这个过程。 我们以序列为轴建主席树，第$i$棵权值线段树维护权值区间的奇数/偶数的个数以及奇数/偶数的和。 每次询问，我们在用第$R\_i$棵线段树和第$L\_i-1$棵线段树作差得到区间$\[L\_i,R\_i\]$的线段树。 然后我们可以在线段树上二分，求出前$K\_i$大的奇数/偶数的和与个数以及第$K\_i$大的数是多少。 如果奇偶的个数都是偶数，答案就是前$K\_i$大的数的和。 否则我们还是用线段树二分，找到前$K\_i$个中最小的奇数/偶数，以及剩下数中最大的偶数/奇数。然后在两种情况取最大值就是答案了。 注意每种权值的数不止一个的时候的情况。 时间复杂度$\\Theta(n\\log n)​$。 我能说我测试时想错然后就把暴力写错，然后和正解拍上了觉得自己很稳，最终30分吗。 更巧的是slz神仙和我一样想错写出了一样的暴力然后错了一样的数据……