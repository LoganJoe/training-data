---
title: " DTOJ3751仙人掌\t\t"
tags:
  - Trie树
  - 奇技淫巧
url: 2364.html
id: 2364
categories:
  - DTOJ
  - Solution
date: 2018-06-13 19:28:00
---

首先有一个结论：$x\\oplus (x+1)=2zerobit(x)-1$。其中$\\oplus$表示按位异或，$zerobit(x)$表示$x$最后一位为零的位置对应的$2$的次方。这个结论手模几次感觉还是挺显然的。 与一个点相连的点可以分为两部分：儿子和父亲。显然父亲的值我们可以直接维护。 那么现在的问题就是对每个点，维护儿子的值的异或和，要支持插入一个数，删除一个数，所有数$+1$。 对于每个点，我们从低位到高位建一棵Trie，维护儿子的信息。 所有数$+1$，实际上是从Trie树的根节点开始，交换左右子树，然后递归新的左子树。 同时维护每个子树大小的奇偶性，可以在递归的过程中求出所有数的异或和。