---
title: " DTOJ3036区间\t\t"
tags:
  - 思路
  - 线段树
url: 3329.html
id: 3329
categories:
  - Solution
date: 2018-08-07 21:42:13
---

我们区间内的数权值化后在数轴上打标记。那么一个区间是连续的，在数轴上的连续块个数就为1或2。

那么我们先考虑$O(n^2)$的做法。确定一个左端点以后顺序往后推右端点，并且每次加一个数到数轴上。

*   如果两侧均有标记，那么联通块个数减一。  
*   如果仅有一侧有标记，联通块个数不变。
*   否则，联通块个数加一。

考虑这样的问题怎么优化维护。倒着枚举固定数字区间左端点 $i $。我们需要知道对于任意的右端点 $j(i \\leqslant j \\leqslant n)$，区间$ \[i, j\] $会被分为$ P $中几段,记为 $f_{i,j}$。

递推，即左端点枚举到 $i$ 时，我们已知所有 $f_{i+1,j}$

若 $i$ 在 $P$ 中的位置为 $x$，考虑 $x − 1$, $x + 1$ 两个位置上的数

*   若 $P_{x−1} < i$且$P_{x+1} < i$，则 $i$ 只能新开一个连通块  
    $\\forall i \\leq j \\leq n$,$f_{i,j} = f_{i+1,j + 1}$  
*   若 $P_{x−1} > i$且$P_{x+1} > i$，假设 $R = max(P_{x−1}, P_{x+1}), L = min(P_{x−1}, P_{x+1})$
*   $j \\geq R$ 时，$i$ 就能与 $L、R $所在块分别合并，连通块个数减一  
    $\\forall R \\leq j \\leq n, f_{i,j} = f_{i+1,j − 1}$
*   $ L \\leq j < R$ 时，$i$ 能与 $L$ 所在块合并，连通块个数不变  
    $\\forall L \\leq j < R, f_{i,j} = f_{i+1,j}$
*   $i \\leq j < L$，$i$ 只能单独开一段，连通块个数加一  
    $\\forall i \\leq j < L, f_{i,j }= f_{i+1,j + 1}$

$ P_{x−1} $与$ P_{x+1}$中恰有一个数大于$ i$ 的情况可以类似讨论 。

那么我们用线段树维护$f_{i,j}$，每个节点记录最小值与最小值个数，以及次小值与次小值个数。然后统计$f_{i,j}=1/2$的数目即可。