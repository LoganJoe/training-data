---
title: " DTOJ1306卡农\t\t"
tags:
  - dp
url: 1916.html
id: 1916
categories:
  - DTOJ
  - Solution
date: 2018-05-07 22:44:38
---

很巧妙的一个dp。 题目要求的是无序，我们可以先求出有序的，然后通过消序，也就是$\\div m!$来得到答案。 一共有$2^n-1$个不同的片段。先考虑满足片段互不相同和出现次数为偶数的序列个数，为$A_{2^n-1}^{m-1}$，记为$f\[m\]$。因为如果前$m-1$个片段确定了，为了保证出现次数都为偶数，第$m$个片段也确定了。 但这样有两个问题。一个是第$m$个片段为空，或者和之前某个片段重复了。 记$g\[m\]$为长度为$m$的合法序列个数，也就是答案。 考虑从$f\[m\]$中减去两种不合法的情况。 如果第$m$个片段为空，即前$m-1$个片段已经合法，方案数就是$g\[m-1\]$。 如果第$m$个片段和之前某个片段重复，那么我们可以枚举重复的位置，一共有$m-1$个位置。那么去掉这两个片段后，数列仍然合法，方案数为$f\[m-2\]$，而重复的这两个片段的种类有$2^n-1-(m-2)$。那么总共要减去的就是 $$(m-1)(2^n-1-(m-2))\\times f\[m-2\]$$ 从$1$推到$m$即可。