---
title: " DTOJ3935强军如歌\t\t"
tags:
  - dp
  - 容斥
url: 4037.html
id: 4037
categories:
  - Solution
date: 2018-09-23 13:44:09
---

把删去一些数看做保留一些数。那么$f\[i\]\[j\]$表示前$i$个数，选出$j$个数，选出的这些数保证非降序的方案数。直接转移$O(n^3)$。开$n$个树状数组，第$i$个树状数组保存长度为$i$，最后一位为$j$的个数。对于当前数$A\_i$，枚举长度$j$,查询最后一位$\\leq A\_i$的序列个数，然后加到$f\[i\]\[j\]$上，并且更新$j,A_i$的树状数组。这样转移就是$O(n^2)$的了。

那么我们记$ans\[i\]$为长度为$i$的非降序列方案数。显然对于每个方案，删数方案有$(n-i)!$种。所以要乘上$(n-i)!$。

但是考虑，对于长度为$x$的答案，会被长度大于$x$的答案重复计算。因为当前序列非降，加上一部分以后可以得到更长的答案。换句话说，长度更短的答案有些是不对的，在删到长度更长的答案的时候就停止不删了。我们考虑如何容斥处理。

对于长度为$i$的$ans\[i\]$，当前已经是合法的，即剔除掉不合法的方案数的答案。那么对于$j \\in \[1,i-1\]$，$ans\[j\]$都需要扣掉$ans\[i\]\\times \\frac{i!}{j!}$，才能把长度为$i$的不合法给扣掉。

这样算出来的$ans\[i\]$就是对的了。求个和就是最后的答案。