---
title: " DTOJ3133石子游戏\t\t"
tags:
  - 博弈
url: 6182.html
id: 6182
categories:
  - DTOJ
  - Solution
date: 2019-01-24 21:42:35
---

这个游戏就是典型的阶梯博弈，转换模型后相当于用所有离叶子距离为奇数的点上的石子堆玩NIM游戏。 下文我们称离叶子距离为奇数的点为奇数点，偶数点同理。 第一步的必胜策略就是操作完后所有奇数点的异或和为$0$。 记初始所有奇数点的异或和为$val$。 我们可以枚举我们要操作的结点，然后分类讨论。$\\oplus$表示异或。

*   操作奇数点$i$。假设移走了$x$个石子，那么要满足$val\\oplus a\_i\\oplus (a\_i-x)=0$。 即$a\_i-x=val\\oplus a\_i$，也就是$x=a\_i-(val\\oplus a\_i)$。 显然只有一个解，注意要判断一下解是否合法。 如果$i$是叶子节点只有一种操作方式，否则有两种（移动到左/右儿子）。

*   操作偶数点，假设将石子移动到儿子$i$。假设移走了$x$个石子，那么要满足$val\\oplus a\_i\\oplus (a\_i+x)=0$。 即$a\_i+x=val\\oplus a\_i$，也就是$x=(val\\oplus a\_i)-a\_i$。 同样也只有一个解，也要判断一下解是否合法。

时间复杂度$\\Theta(n)$。