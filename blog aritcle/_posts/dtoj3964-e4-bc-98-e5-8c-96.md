---
title: " DTOJ3964优化\t\t"
tags:
  - dp
url: 4556.html
id: 4556
categories:
  - Solution
date: 2018-10-25 14:09:46
---

绝对值的限制很不好处理。 但是我们注意到，对于$s\_i$相对大小的不同，每个$s\_i$的贡献是不同的:

*   $s_{i-1}<s\_i>s\_i+1$，贡献为$2s_i$。
*   $s_{i-1}<s\_i<s\_i+1$或$s_{i-1}>s\_i>s\_i+1$，贡献为$0$。
*   $s_{i-1}>s\_i<s\_i+1$，贡献为$-2s_i$。

之后我们就没有必要硬生生的划分每一段的和了。因为具体到每个数，其对答案的贡献与这段的和是一样的 我们可以做dp的时候，可以记一下这个阶段作为“上升、下降、峰顶、谷底”四个状态来转移。具体地，设$f\[i\]\[j\]$为当前做到第$i$位，当前状态为$j,j \\in \\{0,1,2,3\\}$。 $$ f\[i\]\[j\]\[0\] = \\max \\{ max (f\[i - 1\]\[j - 1\]\[2\], f\[i - 1\]\[j - 1\]\[3\])) + 2 * A\[j\]\\}$$ $$f\[i\]\[j\]\[2\] = \\max \\{ max (f\[i - 1\]\[j - 1\]\[1\], f\[i - 1\]\[j - 1\]\[0\])) - 2 * A\[j\]\\}$$ $$f\[i\]\[j\]\[1\] = \\max \\{ f\[i - 1\]\[j - 1\]\[0\])\\}$$ $$f\[i\]\[j\]\[3\] = \\max \\{ f\[i - 1\]\[j - 1\]\[2\])\\}$$ 其中，状态0/1/2/3分别对应峰顶，下降，峰谷，上升四个状态。