---
title: " DTOJ4045矿石\t\t"
tags:
  - 思路
url: 5235.html
id: 5235
categories:
  - DTOJ
  - Solution
date: 2018-11-22 21:03:57
---

对于一个列表，如果所有矿石的区间交中包含了至少一个采矿点，那么这个列表就是合法的。 考虑用所有方案减去不合法的方案数。 不合法的方案中，区间交要么为空，要么在两个相邻采矿点之间。 一堆区间的交为$\[\\max\\{l\_i\\},\\min\\{r\_i\\}\]$。 我们先对所有区间按左端点排序，然后枚举从小到大枚举一个$i$，表示选的区间的交的左端点为$l\_i$，且第$i$个区间必选。 由于我们要保证选出来区间的交为$l\_i$，因此我们只能在$1\\sim i$的区间中选择。 记$a$为$l\_i$往左第一个采矿点的位置，$b$为$l\_i$往右第一个采矿点的位置。如果$l\_i$上有采矿点我们认为这个采矿点在$l\_i$右边。 然后我们分情况考虑。

*   $r_i<b$。那么无论怎么选区间并肯定都不会包含采矿点，因此方案数是$2^{i-1}$。
*   $r\_i\\geq b$。那么区间交的右端点一定要$<b$，即选出来的最小的右端点要$<b$。假设前$i-1$个区间内右端点$<b$的区间有$cnt$个，那么一共有$\\sum\_{j=i-1-cnt}^{i-2}2^j$中选法。即枚举区间交的右端点是哪个区间的，然后计算对应的方案数。

我们可以用树状数组维护前$i$个区间右端点$<x$的区间个数，注意要先离散化了。 再预处理出$2^i$的前缀和即可。 时间复杂度$\\Theta(n\\log n)$。