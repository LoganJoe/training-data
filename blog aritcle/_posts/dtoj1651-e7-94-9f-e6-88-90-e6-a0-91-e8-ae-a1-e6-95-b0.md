---
title: " DTOJ1651生成树计数\t\t"
tags:
  - 状压dp
  - 矩阵
url: 5899.html
id: 5899
categories:
  - DTOJ
  - Solution
date: 2018-12-31 23:01:14
---

题目提供了一堆知识，比如矩阵树与行列式和prufer序，然而都没有用。用脚想想都知道没用 我刚开始以为可以线性递推的，然后硬肝了样例20min，发现我是个傻逼。 往生成树中加边肯定要考虑点的连通性，由于我们第$i$个点最远只能和第$i-k$个点连边，因此我们只用考虑区间$\[i-k,i\]$之间点的连通性。 考虑状压dp。 记$f\[i\]\[S\]$为前$i$个点，区间$\[i-k,i\]$之间的点的连通状态为$S$的方案数。 我们枚举第$i$个点向前连边的集合，一共有$2^k$种，然后计算出新的连通状态去转移。 状态$S$可以用最小表示法压缩状态数，最少可以压到只有$52$种。 可以发现，转移就是一个矩阵的形式，矩阵大小最多为$52\\times 52$。 我们构造出矩阵，然后用矩阵快速幂优化转移即可。 矩阵的构造有点麻烦，注意如果新的状态与旧的状态相比有一个连通块消失了（也就是没有可能与所有点连通的），这个转移就是不合法的。 时间复杂度$\\Theta(52^3\\log n+52\\times 2^k)$。