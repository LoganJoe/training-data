---
title: " BZOJ2286[Sdoi2011]消耗战\t\t"
tags:
  - 树形dp
  - 虚树
url: 5524.html
id: 5524
categories:
  - BZOJ
  - Solution
date: 2018-12-15 23:06:24
---

虚树模板题。 考虑普通的树形dp。 记$Min_i$为$1$到$i$的路径上代价最小的边的代价。$f\[i\]$为不能得到以$i$为根的子树内的资源的最小代价。 很容易想到转移。

*   第$i$个点上有资源，那么$f\[i\]=Min_i$。
*   第$i$个点上没有资源，那么$f\[i\]=\\min(Min\_i,\\sum\_{son}f\[son\])$。其中$son$为第$i$个点的儿子。

单次dp是$\\Theta(n)$的。但是如果每次询问都跑一次，就是$\\Theta(nm)$的了。 考虑优化。 每次其实上有很多点是我们不需要的，我们只关心有资源的点和这些点之间的$LCA$。也就是有资源的点的虚树。 那么我们每次建出虚树后，在虚树上dp即可。