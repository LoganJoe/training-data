---
title: " DTOJ2921Freight\t\t"
tags:
  - dp
  - 奇技淫巧
url: 4360.html
id: 4360
categories:
  - Solution
date: 2018-10-22 20:40:15
---

首先要发现几个结论

**引理1**：一起出发的一段列车总是会一起回来。

这个很好想到。因为同时发车，占用的“空档”会更小。

那么我们考虑做dp。

设$f\[i\]$为前$i$辆车，全部回来所需要的最小时间。考虑一段的转移，会有：

$$f\[i\]=\\min_{j <i}\\left\\{ 2S+i-j-1 +max(f\[j\]+i-j-1,A_i) \  \\right\\}$$

**引理2**：$f\[i\] > f\[i-1\]$，即$f\[i\]$单调递增。

这个可以由刚才写出的dp式子看出。

有了这个性质，我们发现，$f\[j\]+j$也会是单调的。则$f\[i\]+i-j-1$也会是单调的。于是：

$$f\[i\]=\\begin{cases}2S+i-j-1 +f\[j\]-i+j-1 & f\[i\]+i-j-1>A\_i \\\ 2S+i-j-1+A\[i\] & f\[i\]+i-j-1 \\leq A\_i \\end{cases}$$

要使德$f\[i\]$最小。对于第1个$case$，发现$f\[i\]-j$一直在单调上升（$f\[i\]$每次至少+2），因此取最前面也就是最小的$j$的dp值最优。而后面就是取第二个$case$的情况。第二个cases则是当$j$最大的时候最优。因此两个$case$的最优点相邻，并且转移先递减后递增，最优点在不断后移。这个东西就可以$O(n)$向后推了。