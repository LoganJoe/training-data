---
title: " DTOJ4146归程\t\t"
tags:
  - Kruskal重构树
url: 6998.html
id: 6998
categories:
  - Solution
date: 2019-03-17 10:53:48
---

首先考虑一个简单的离线做法：我们将所有询问按照水深排序，然后每次加入海拔高于当前水深的点。那么每次询问，相当于找出当前联通块中，距离1号节点最近的点，距离1号点的距离。 很明显的，后者不论水深，可以直接Dijkstra_Heap预处理。 接下来考虑如何转到在线做。明显，我们可以将每次的路径转化成开车和走路两部分。前半部分开车的路要求海拔不小于当前水位，后半部分要求找一条最短路。 考虑根据这个性质建立kruscal重构树：对于kruscal重构树的子树中，其边权范围一定小于某个值，并且这些点两两可达。 kruscal重构树，在运行Kruskal算法的过程中，对于两个可以合并的节点$(x,y)$，断开其中的连边，并新建一个节点$T$，把$T$向$(x,y)$连边作为他们的父亲，同时把$(x,y)$之间的边权当做T的点权。 那么，在kruscal重构树上，任意两个点路径上边权的最大值为它们的LCA的点权。观察这个构建方式显然。 于是，我们考虑按照边权倒序建立kruscal重构树。对于当前的询问，在树上倍增找到权值$\\ge p$的深度最小点。那么这个点子树内，同时满足海拔$\\ge p$和联通两条性质。我们预处理出子树内离$1$号点最近的点的距离，就可以回答询问了。