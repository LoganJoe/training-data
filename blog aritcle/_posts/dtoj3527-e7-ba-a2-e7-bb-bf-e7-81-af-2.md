---
title: " DTOJ3527红绿灯\t\t"
tags:
  - dp
  - 线段树
url: 694.html
id: 694
categories:
  - Solution
date: 2018-02-19 20:30:13
---

考虑一个路口是否会有红绿灯影响，一定是在之前所用时间%（g+r）意义下考虑的。 假设在当前路口等完红绿灯，相当于从该路口的第0秒出发。 我们设f\[i\]为在当前路口以第0秒出发（也是模意义下），走到终点所需要的时间。 这个可以由后面路口的f\[i\]推出： 首先我们记sum\[i\]为前i段所需要的时间的前缀和；同样的，我们考虑其在模意义下的结果。

1.  若$sum\[i\]\\leqslant sum\[j\]$，则有$sum\[j\]sum\[i\]\\geqslant g$，即$sum\[j\]\\geqslant sum\[i\]+g$。
2.  若$sum\[i\]>sum\[j\]$，则有$sum\[j\]-sum\[i\]+g+r\\geqslant g$，即$sum\[j\]\\geqslant sum\[i\]-r$。

这样子我们可以通过线段树，找到最早的一个符合条件的j，那么f\[i\]就可以通过f\[j\]推出了。 对于一个询问，相当于走到第一个路口用了$(t\_i+s\_0)/%(g+r)$的时间。之后我们也相当于是要找到一个f\[0\]，即找到一个f\[j\]来更新答案。同上的，我们也是要找到第一个要等红灯的地方j 于是我们需要一棵支持单点修改，区间查询最小值的线段树，数据要求动态开点或者对于下标哈希。如果哈希，则需要将所有可能丢进线段树内得下标都给一个对应值。