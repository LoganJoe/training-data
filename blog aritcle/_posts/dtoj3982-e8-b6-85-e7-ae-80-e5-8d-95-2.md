---
title: " DTOJ3982超简单\t\t"
tags:
  - dp
url: 4381.html
id: 4381
categories:
  - Solution
date: 2018-10-23 17:14:02
---

$\\bullet$题意：

        ⑨有一个有$n$个面的冰骰子（内有蛙），n个面对应的权值以及朝上的概率分别为$v\[i\],p\[i\]$。由于⑨赶着去冻青蛙，于是⑨决定当某一面两次朝上就停下。路过的魔理沙恶意地提问⑨骰子所有朝上的面的权值和的期望是多少。聪明如⑨自然不屑于这种问题，于是把它交给了你。

$\\bullet$题解：

        答案的表达式：

$$\\sum_{i=1}^{n}\\sum_{s,i \\in s}(P_{s} \\times p\[i\])\\times(V_{s}+v\[i\])\\times A_{|s|}^{|s|}$$

由于有且仅有一个数会出现两次，不妨枚举该数$i$，计算其对答案的贡献。

根据表达式可列出转移式：

    $f\[i\]\[j\]$ 表示前$i$个数中取$j$个的期望值；

    $g\[i\]\[j\]$表示前$i$个数中取$j$个的概率；

对于一个合法的方案，去掉出现两次的数以后必呈一个无重复无序的$1\\sim n$的子集（可能为空）。所以如上述表达式，安排掉重复的数$i$以后开始统计所有不含$i$的子集$s$的贡献。

对于第$k$个子集$s_{k}$，贡献为$P_{k}\\times V_{k}$。当我们合法地添加第$i$的数入$s$时，所得新子集的贡献为$(P_{k}\\times p\[i\])\\times (V_{k}+v\[i\])$，展开得：$P_{k}\\times V_{k}\\times p\[i\]+P_{k}\\times p\[i\]\\times v\[i\]$。对应地，新子集的概率为$P_{k}\\times p\[i\]$。

视上述子集$s$对应前$i-1$个数中取$j-1$的状态，则我们可以得到：

    $f\[i\]\[j\]=f\[i-1\]\[j-1\]\\times p\[i\]+g\[i-1\]\[j-1\]\\times p\[i\]\\times v\[i\]$；

    $g\[i\]\[j\]=g\[i-1\]\[j-1\]\\times p\[i\]$；

考虑不取第i位的情况则为：

    $f\[i\]\[j\]=f\[i-1\]\[j-1\]\\times p\[i\]+g\[i-1\]\[j-1\]\\times p\[i\]\\times v\[i\]+f\[i-1\]\[j\]$；

    $g\[i\]\[j\]=g\[i-1\]\[j-1\]\\times p\[i\]+g\[i-1\]\[j\]$；

    边界状态：$f\[0\]\[0\]=0,g\[0\]\[0\]=1$；

如此，我们便可以在枚举重复数位之后算出对应的期望之和了。

效率 $O(n^3)$。

$\\bullet$题解-PLUS：

然而$O(n^3)$的效率还不够美，我们还有更妙哉的写法：

我们假设对于状态$f\[i\]\[j\]$，处在末位的数位为$i$。同时，对于所有不同的排列，对应的$f\[n\]\[j\]$都是相同的。如此，我们是否可以通过不同转移下的$f\[n-1\]\[j\]$来表示排列中没有数位$i$的方案状态？

$Yes Yes Yes Yes Yes Yes ......$

    $f\[n\]\[j\]=f\[n-1\]\[j-1\]\\times p\[i\]+g\[n-1\]\[j-1\]\\times p\[i\]\\times v\[i\]+f\[n-1\]\[j\]$；

    $g\[n\]\[j\]=g\[n-1\]\[j-1\]\\times p\[i\]+g\[n-1\]\[j\]$；

再略一转移得：

    $F\[j\]=f\[n-1\]\[j\]=f\[n\]\[j\]-f\[n-1\]\[j-1\]\\times p\[i\]-g\[n-1\]\[j-1\]\\times p\[i\]\\times v\[i\]+f\[n-1\]\[j\]$；

    $G\[j\]=g\[n-1\]\[j\]=g\[n\]\[j\]-g\[n-1\]\[j-1\]\\times p\[i\]+g\[n-1\]\[j\]$；

蛤？$F$和$G$是什么？$F$表示已安排掉重复的数以后所得的长度为j的子集的期望和,$G$同理。另外$F\[0\]=f\[n\]\[0\],G\[0\]=g\[n\]\[0\]$。

最后按照转移式把重复数位两次加入以计算期望与概率即可。

$f$、$g$的预处理$O(n^2)$，枚举重复数位、计算$F$和$G$并统计答案也是$O(n^2)$，Over。

特别鸣谢：2398886573（快tm来写题解）