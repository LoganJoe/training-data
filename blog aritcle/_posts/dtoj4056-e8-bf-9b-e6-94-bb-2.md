---
title: " DTOJ4056进攻\t\t"
tags:
  - 奇技淫巧
  - 容斥
url: 5543.html
id: 5543
categories:
  - Solution
date: 2018-12-16 12:04:41
---

首先考虑计算覆盖某块的矩形数量。假设覆盖某块的矩形有$s$个，那么可以计入答案的方案数就是$s^{K}$。然而这样会算重。我们考虑容斥。每次固定右下角，考虑右下角往上的矩形数量，然后算出带上左边那个，带上上方那个，以及当前作为左下角的整个$2\\times 2$的矩形数量。类似前缀和计算方法相减就可以容斥掉多余的情况了。 考虑怎么计算覆盖矩形个数。对于每个矩形，肯定是对于其中的所有格子有$+1$的贡献。维护四个角上的差分，那么就是左上/右下$+1$，右下/左上$-1$。 那么现在我们就是要求以每个点为左上/左下/右上/右下角的矩形个数。这个东西可以单调栈分别求出。 然后就可以算了。注意在算容斥的时候，由于矩形会错开一行或者一列，因此要错开一下才能算出正确的答案。