---
title: " DTOJ3984玩具\t\t"
tags:
  - 概率dp
url: 5008.html
id: 5008
categories:
  - Solution
date: 2018-11-02 16:04:28
---

考虑先预处理出$p\[i\]\[j\]$表示$i$个点的森林，有$j$个点在第一棵树的概率。可以写出以下的转移方程： $$p\[i\]\[j\]=\\frac{j-1}{i}p\[i-1\]\[j-1\]+p\[i-1\]\[j\]\\frac{i-j}{i}$$ 要考虑这个式子的正确性，我们可以先行考虑我们在$i-1$个点的森林中塞进一个新的点，其挂到深度为$j-1$的树上的概率为$\\frac{j-1}{i}$。或者挂在其他树上或者新成一棵树，那么就有概率$\\frac{i-j}{i}$。 令$f\[i\]\[j\]$表示有$i$个点的树，深度不超过$j$的概率，$g\[i\]\[j\]$为有$i$个点的森林中，深度最大的树深度不超过$j$的概率。考虑用$g$辅助转移$f$：明显的，有$f\[i\]\[j\]=g\[i-1\]\[j-1\]$，因为我们新加一个点做根，连上其他森林中的所有树，树高变成$j$，而这个的计数明显是不重不漏的。而要从$i-1$棵树的森林转移到$i$棵树的森林，那么我们可以枚举第$i$棵树的大小。然后还要确保第$i$棵树确实有这个大小，那么有 $$g\[i\]\[j\]=\\sum_{k=1}^{i}f\[k\]\[j\]\\times f\[i-k\]\[j\]\\times p\[i\]\[k\]$$。 至于这个东西为什么是正确的，我们考虑$g\[i-k\]\[j\]$这部分的概率是已经符合条件的，而$f\[k\]\[j\]$这个部分仅仅确保这$k$个点深度为$j$，而没有确保不会连在其他树上。乘上$p\[i\]\[k\]$以后相当于强行划出独立的$k$个点给一棵树用，这$k$个点向外不会有连边。于是这样转移就是对的了。 然后要得到深度为$j$的概率，那么用$f\[n\]\[j\]-f\[n\]\[j-1\]$就可以了。