---
title: " DTOJ3607usmjeri\t\t"
tags:
  - 并查集
url: 1373.html
id: 1373
categories:
  - DTOJ
  - Solution
date: 2018-04-10 07:56:24
---

对于一个限制$(a,b)$，它限制了$a$到$LCA$的路径同向，$b$到$LCA$的路径同向，且$a$到$LCA$的路径的方向和$b$到$LCA$的路径的方向相反。可以将每个点拆成两个点，分别代表和父亲的边是哪个方向，然后用并查集维护限制。好像不拆点的并查集也可以。 暴力连边显然会超时。容易发现，并查集限制不同方向只用在$a,b$间连一条边，而限制相同方向却要对于路径上所有点连边。但相同方向的限制只会在一个点和它父亲之间，因此限制多次是没有意义的。 因此从$a,b$往上跳并连限制边的时候，我们可以跳过已经被限制过的点，直接找到下一个还未被限制的点。这个也可以用一个并查集实现，把限制过的连通块压成一个点即可。