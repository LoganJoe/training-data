---
title: " DTOJ4100yjqb\t\t"
tags:
  - dp
  - 平衡树
url: 5990.html
id: 5990
categories:
  - DTOJ
  - Solution
date: 2019-01-04 17:24:43
---

先考虑暴力dp。 记$f\[i\]\[j\]$为$A$部前$i$个点和$B$部前$j$个点合法的最大匹配。 那么有 $$ f\[i\]\[j\]= \\begin{cases} \\max\\{f\[i-1\]\[j\],f\[i\]\[j-1\]\\} & j<L\_i或j>R\_i\\newline \\max\\{f\[i-1\]\[j\],f\[i\]\[j-1\],f\[i-1\]\[j-1\]+1\\} & L\_i\\leq j\\leq R\_i \\end{cases} $$ 我们发现对于同一个$i$，$f\[i\]\[j\]$是单调不降的。 那么我们的dp式子可以稍微的改变一下 $$ f\[i\]\[j\]= \\begin{cases} f\[i-1\]\[j\] & j<L\_i或j>R\_i\\newline \\max\\{f\[i-1\]\[j\],f\[i-1\]\[j-1\]+1\\} & L\_i\\leq j\\leq R\_i \\end{cases} $$ 这样所有的$f\[i\]\[j\]$都是从$f\[i-1\]\[j-1\]$和$f\[i-1\]\[j\]$转移来的，我们考虑如何优化。 我们考虑差分序列，记$g\[i\]\[j\]=f\[i\]\[j\]-f\[i\]\[j-1\]$。 显然$g\[i\]\[j\]=0/1$。 我们观察一下$g\[i-1\]\[j\]$是如何变到$g\[i\]\[j\]$的。 显然从第$L\_i$位开始才可能发现改变。 经过打表或者思考一番可以发现，相当与找到满足$k\\geq R\_i$且$g\[i-1\]\[k\]=1$最小的$k$，然后删掉第$k$位，将第$L\_i$位到第$k-1$位向后移动一位，最后将第$L\_i$位变成$1$。 这些操作可以用平衡树实现，写一棵平衡树即可。 时间复杂度$\\Theta(n\\log n)$。