---
title: " DTOJ3751仙人掌\t\t"
tags:
  - Trie树
url: 6258.html
id: 6258
categories:
  - Solution
date: 2019-01-27 16:44:05
---

思考一下$x+1$在二进制位上的贡献，等价于最小为零位往下所有位翻转的贡献。那么$x \\oplus (x+1)$显然为$2^{zerobit(x)+1}-1$。其中，$zerobit(x)$为最小零位的位数。 提一个点做根。考虑一个点做出的贡献，分别为对儿子的贡献，与对父亲的贡献。考虑分开维护这两个东西。显然对于父亲的贡献可以直接维护。重点考虑维护对儿子的贡献。 那么现在的问题就是对每个点，维护儿子的值的异或和，要支持插入一个数，删除一个数，所有数$+1$。 不妨考虑在Trie上维护01位关系：我们从低位向高位建Trie。那么发现，所谓的所有数$+1$，不过是对于当前节点，交换左右子树，然后向当前交换后的左子树走。这样就可以很好地更新出所有数$+1$的贡献了。插入删除很好处理，并且异或和还可以顺带维护。 $O(n \\log n)$，___天下第一。