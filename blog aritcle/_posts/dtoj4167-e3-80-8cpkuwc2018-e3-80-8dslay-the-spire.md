---
title: " DTOJ4167「PKUWC2018」Slay The Spire\t\t"
tags:
  - dp
  - 思路
url: 6900.html
id: 6900
categories:
  - DTOJ
  - Solution
date: 2019-03-08 20:34:41
---

期望是假的，所以就是要求所有方案的伤害总和。 显然最优策略中，攻击牌一定是在最后出的。并且在出攻击牌前，会把强化牌出完。因为强化牌的系数都$>1$，出两张强化和一张攻击肯定比一张强化和两张攻击优。 那么我们可以将手牌分成两种情况：强化牌数量$<k-1$和强化牌数量$\\geq k-1$。 对于第一种情况，我们肯定是先将所有的强化牌出了，然后出手上最大的几张攻击牌。 我们先将强化牌和攻击牌都从大到小排序。记第$i$张强化牌为$a\_i$，第$i$张攻击牌为$b\_i$。 考虑dp。 记$f\[i\]\[j\]$为前$i$张强化牌中选$j$张，所有方案强化系数的和，也就是所有方案中强化牌乘积的和。 很容易得到转移式 $$ f\[i\]\[j\]=f\[i-1\]\[j\]+f\[i-1\]\[j-1\]\\times a\_i $$ 记$g\[i\]\[j\]$为前$i$张攻击牌选$j$张，所有方案的伤害总和，也就是所有方案中攻击牌的和的和。 也很容易得到转移式 $$ g\[i\]\[j\]=g\[i-1\]\[j\]+g\[i-1\]\[j-1\]+\\binom{i-1}{j-1}\\times b\_i $$ 现在考虑计算第一种情况的伤害总和。 枚举了强化牌的数量$i$，我们还要枚举第$k-i$大的攻击牌是哪张。 那么总贡献就是 $$ \\sum_{i=1}^{k-2}\\sum_{j=1}^{n}f\[n\]\[i\]\\times (g\[j\]\[k-i\]-g\[j-1\]\[k-i\])\\times \\binom{n-j}{m-k} $$ 其中$g\[j\]\[k-i\]-g\[j-1\]\[k-i\]$是前$j$张牌选$k-i$张并且第$j$张一定有选的伤害总和。 这样第一种情况就$\\Theta(n^2)$内算完了。 考虑第二种情况。 仍然枚举强化牌的数量$i$，那么有$m-i$张攻击牌，要出最大的那张。 仍然将强化牌和攻击牌从大到小排序，那么造成的伤害就是前$k-1$张强化牌再乘第一张攻击牌。 然后我们发现，这样我们要枚举第$k-1$张强化牌是哪张，以及第一张攻击牌是哪张，才能计算伤害。这样时间复杂度就是$\\Theta(n^3)$的了。 考虑优化。 注意到从第$k$张开始的强化牌对强化系数是没有贡献的了，我们可以认为它们的强化系数为$1$。 将之前$f\[i\]\[j\]$的定义小小修改一下，如果选的强化牌是第$k$张及之后，就认为强化系数为$1$。 这样子$f\[n\]\[i\]$就是选$i$张强化牌的所有方案中最大的$k-1$张乘积的和了。 那么总贡献就是 $$ \\sum_{i=k-1}^{n}\\sum_{j=1}^nf\[n\]\[i\]\\times b_j\\times \\binom{n-j}{m-i-1} $$ 这样就也在$\\Theta(n^2)$内算完了。