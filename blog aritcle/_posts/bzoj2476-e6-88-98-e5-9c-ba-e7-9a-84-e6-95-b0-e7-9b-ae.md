---
title: " BZOJ2476战场的数目\t\t"
tags:
  - dp
  - 思路
  - 矩阵
url: 6335.html
id: 6335
categories:
  - BZOJ
  - Solution
date: 2019-02-05 14:47:25
---

这题思路很巧妙。 首先周长为奇数时答案一定是$0​$。 记$f\[i\]$为周长为$2i$的连通块的方案数，包含了矩形。 我们只要求出$f\[\\frac p 2\]$然后将矩阵的数量减去即可。 矩形的数量是$\\frac p 2-1$。因为$a+b=\\frac p 2$只有$\\frac p 2 -1$组正整数解。 考虑如何求$f\[i\]$。 对于一个周长为$2i$的连通块，如果最左边/最右边那列的高度为$1$，那么删掉这列就唯一地对应着一个周长为$2(i-1)$的连通块。方案数为$2f\[i-1\]$。 如果最左边和最右边的高度都为$1$，那么删掉这两列就唯一地对应着一个周长为$2(i-2)$的连通块。方案数为$f\[i-2\]$，但这种情况会被上一种情况多计算一次，因此要减去。 如果最左边和最右边的高度都$>1$，那么我们删掉最下面一行，这就唯一地对应着一个周长为$2(i-1)$的连通块。方案数为$f\[i-1\]$。 也就是说 $$ f\[i\]=2f\[i-1\]-f\[i-2\]+f\[i-1\]=3f\[i-1\]-f\[i-2\] $$ 时间复杂度$\\Theta(Tn)$，但仍然不能通过。 注意到这是一个常系数递推式，我们可以写成矩阵的形式，然后用矩阵快速幂优化即可。 时间复杂度$\\Theta(T\\log n)$。