---
title: " DTOJ3742djq和MZ\t\t"
tags:
  - 分块
  - 思路
  - 莫队
url: 2281.html
id: 2281
categories:
  - DTOJ
  - Solution
date: 2018-06-08 22:48:56
---

下面认为$n,m,q$同阶。 没有强制在线，很容易想到莫队+线段树的$\\Theta(n\\sqrt{n}log\\space n)$。但这个是显然不能过的。 修改次数有$n\\sqrt{n}$次，而查询只有$n$次，因此用线段树很不划算。考虑用一个修改$\\Theta(1)$，查询$\\Theta(\\sqrt{n})$的算法。 我们可以$\\Theta(1)$维护区间长度$+1$的答案，但却不能$\\Theta(1)$维护区间长度$-1$的答案。 那么我们只让区间长度$+1$不就可以了吗？ 我们对普通的莫队略作修改。具体地，处理左端点在同一块内的询问，我们右端点仍然不断向右拓展，而左端点每次都从块的右侧往左推，然后维护每种颜色的和。查询的话，我们可以对颜色的和分块，维护每块的最大值，就可以$\\Theta(\\sqrt{n})$完成一次询问了。 注意特判询问左右端点同块的情况，以及查询颜色的左右端点同块的情况。