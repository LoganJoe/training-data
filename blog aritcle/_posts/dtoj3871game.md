---
title: " DTOJ3871game\t\t"
tags:
  - FFT
  - 点分治
url: 3599.html
id: 3599
categories:
  - DTOJ
  - Solution
date: 2018-08-26 18:13:55
---

出题人语文有点差。 题目等价于，随机选择一个点，将该点所在连通块的点全部锤一遍，然后删除该点，如此重复$n$次。 考虑分开算期望，答案就等于每对$i,j$，删除$i$时$j$被锤的概率和。 如果删除$i$时$j$被锤，说明$i$是$i$到$j$路径上第一个被删除的点。 $i$到$j$路径上每个点是第一个被删除的点概率都相同，因此$i$是第一个被删除的点的概率是$\\frac{1}{dist(i,j)}$。 那么问题就变成了，对于每个$x\\in\[1,n\]$，求出树上有多少个有序点对距离为$x$。 暴力是$n^2$的。 考虑点分治，对于过重心的路径，可以用重心到点的路径合并，合并时用FFT就能做到$\\Theta(n\\log n)$。 加上点分治时间复杂度$\\Theta(n\\log^2 n)$。