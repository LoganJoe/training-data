---
title: " DTOJ3494奇诺之旅\t\t"
tags:
  - 树形dp
  - 环加外向树
url: 133.html
id: 133
categories:
  - DTOJ
  - Solution
date: 2018-01-07 16:06:20
---

每一种选择的方法都会选出一个环加外向树森林（$n$个点$n$条边）。 先不考虑删边的情况，最大的环加外向树森林可以用Kruskal像求最小生成树一样求出。大致流程就是先按边权从大到小排序，如果选当前的边不会使连通块之间有大于一个的环，这条边就可以选。 考虑删掉环上的边后的答案。显然这一棵环加外向树由于环被拆开，变成了一棵树，这棵树就可以任选一条没有选过的边连出去，使自己再变成一棵环加外向树或者成为其他环加外向树的树。 考虑删掉树上的边后的答案。这棵环加外向树被分为两个部分：一棵环加外向树和一棵树。树的部分和前面一样，可以选一条没有选过的边连出去；环加外向树的部分不能再选边连出去了，因为如果选边出去，有两种情况，一是不合法，二合法，但不会比树的部分选出去的优，因为如果有一条合法的边又比树的部分连出去的优，这在一开始建环加外向树森林时就会被加进去（Kruskal的贪心）。 若删掉的边不在环加外向树森林上，这个就好办了，答案就是最大的环加外向树森林。 现在我们只要建出环加外向树森林，再用树形dp预处理处每个子树内没有选过的边的最大值和整棵环加外向树没有选过的边的最大值，即可解决问题。