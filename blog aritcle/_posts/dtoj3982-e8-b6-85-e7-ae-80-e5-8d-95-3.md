---
title: " DTOJ3982超简单\t\t"
tags:
  - 奇技淫巧
  - 期望
  - 概率
url: 4930.html
id: 4930
categories:
  - Solution
date: 2018-11-01 13:13:07
---

假设不去考虑那个最后出现两次的人。我们只考虑$f\[i\]\[j\]$为前$i$个数，选了$j$个数，且每个数只选一次的期望。 设$E\[i\]=v\[i\]\\times p\[i\]$，$g\[i\]\[j\]$为前$i$个人选$j$个数的概率和。 拆开期望的式子，可以得到 $$ f\[i\]\[j\]=f\[i-1\]\[j\]+f\[i-1\]\[j-1\]\\times p\[i\]+g\[i-1\]\[j-1\]\\times E\[i\] $$ $$ g\[i\]\[j\]=g\[i-1\]\[j-1\]\\times p\[i\]+g\[i-1\]\[j\] $$ 边界有$g\[i\]\[0\]=1$。 那么当我们钦定某个数出现了两次，我们就要乘上这个数的期望。但是由于在上述方案中，我们钦定的那个数不一定会被选到。因此我们需要将当前dp的状态退一位，也就是从$f\[n\]\[j\]$退到$f\[n-1\]\[j-1\]$的状态，退掉的数就是我们当前钦定的选两次的数。 考虑对于原来的dp式子： $$ f\[i-1\]\[j\]=f\[i\]\[j\]-f\[i-1\]\[j-1\] \\times p\[i\]+g\[i-1\]\[j-1\]\\times E\[i\] $$ $$ $$ 那么假设我们做到了第$n$个，退掉枚举的一个变成$n-1$个。记$F\[j\],G\[j\]$分别为除了当前数外$n-1$个，选了$j$个的期望与概率和。我们枚举$i$为当前钦定的数： 那么有： $$ F\[j\] = f\[n\]\[j\] - F\[j - 1\] \\times p\[i\] + G\[j - 1\] * E\[i\] $$ $$ G\[j\] = g\[n\]\[j\] - G\[j - 1\] \\times p\[i\] $$ 那么当前的$F\[j\]$和$G\[j\]$就是除了当前数外，选$j$个的期望和概率和。 考虑加上当前这个数： $$ F\[j\] = F\[j\] \\times p\[i\] + E\[i\] \\times G\[j\] $$ $$ G\[j\] = G\[j\] \\times p\[i\] $$ 那么当前的$F\[j\]$和$G\[j\]$就是除了选$j+1$个，一定包含第$i$个数的期望和概率和。 那么前面选$j+1$个，结尾为$i$的期望就可以期望为$F\[j\] \\times p\[i\]+ G\[j\] \\times E\[i\]$ 由于前面可以任取，那么上面这个期望还要乘上一个$(j+1)!$。 我离AC这道题差一次CTSC。