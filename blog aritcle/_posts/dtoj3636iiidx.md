---
title: " DTOJ3636IIIDX\t\t"
tags:
  - 线段树
  - 贪心
url: 1437.html
id: 1437
categories:
  - DTOJ
  - Solution
date: 2018-04-14 23:40:30
---

将限制关系看成一棵树，点$i$的父亲是点$\\lfloor \\frac{i}{k}\\rfloor$。那么问题变成了给每个点一个点权，保证父亲的权值比儿子小，求最大的合法解。 考虑贪心。按树的后序遍历从大到小放数字即可。 然而这个方法，在有重复数字的情况下是错的。

> 例如：$k=2, D=\\{1,1,1,2\\}$ 贪心：$1 1 1 2$ 正解：$1 1 2 1$

考虑换一个贪心的思路。这个思路就很巧妙了。 点$1$要尽量大，那我们先确定点$1$的值再让剩下的点尽可能大。 用线段树解决这个问题。 先按数从大到小排序，记$f\[i\]$为第$i$个数左边已经被预定的数的数量（初始为$0$），那么$i-f\[i\]$就是$\\geqslant D\_i$可用的数的个数。 依次考虑每个结点$x$，设结点$x$的子树大小为$size$。那么我们要找到一个最小的位置$p$，使得$\\forall i\\in\[p,n\]$，有$i-f\[i\]\\geqslant size$。那么结点$x$的值就是$D\_p$。接着我们要在$D\_1\\sim D\_p$中选$size-1$个给结点$x$的儿子，即要为儿子预定一些位置，那么我们给$<D\_p$的位置$i$的$f\[i\]$减去$size$，同时最右边的$D\_p$的位置也要减去$size$。 感觉讲的还是很不清楚…出题人是这么解释的：

> 每次选一个数给某个结点都需要提前预定一些数等后面放在子树内。 那么我们要做的就是判断某次选择后，前面结点的预定能否被满足。 然后在此基础上让解最大。

假如进行到第$i$个结点且这个结点有父亲的话，需要将父亲给儿子的预定取消。