---
title: " DTOJ2293幻想乡开店\t\t"
tags:
  - 动态点分治
url: 2460.html
id: 2460
categories:
  - DTOJ
  - Solution
date: 2018-06-15 20:53:37
---

动态点分治模板题。也有树链剖分+主席树的写法。 考虑如果没有年龄限制要怎么写。 我们先跑一遍点分治，建出点分树。 对于一个点$x$，树上所有以点$x$为端点的路径，都能被拆成点$x$到$x$在树上的某个祖先和祖先到子树内其他点的两条路径。 对于$x$的一个祖先$y$，我们考虑$x$到$y$和$y$到$y$的其他子树的路径。我们可以把这两部分的距离分开算。 $x$到$y$的距离可以预处理，$y$到$y$每棵子树所有点的距离和也能预处理。 预处理距离可以点分治的时候求出对于每个重心dfs一遍，也可以直接在原树上倍增求。 注意$x$到$y$的路径不会被考虑到，要单独计算。 那么这样我们就解决了没有年龄限制的情况。 考虑如果有年龄限制怎么办。 也就是说，我们要维护的变成了$y$到$y$的子树内点权在一个范围的点的距离和。 我们可以把每个点子树内的所有点的点权用一个vector存下来，然后按点权大小排序。排序后预处理子树的点到这个点点分树上的父亲的距离的前缀和。 每次询问的话，我们在vector中二分出左右端点，就可以求出答案了。