---
title: " DTOJ3865树上路径\t\t"
tags:
  - Link-Cut Tree
  - 动态dp
url: 3740.html
id: 3740
categories:
  - Solution
date: 2018-08-28 22:14:38
---

神仙题啊。

画一画图就发现，因为同一个点不能经过超过两次，那么只会有三种绕的情况：

*   对于起点或终点的子树，向下走一条简单路径以后回来。
*   在两点之间的路径上往回走一步然后回来，这一段内的子树都不能再次经过。
*   对于一个点，下到他另外一个子树上，走一条简单路径然后回来。

可以把路径上的点看做一段区间。我们只要记录区间的端点有没有经过两次就可以转移。

由于树是动态的，有加边删边操作。于是我们在LCT上维护。对于每个点，我们需要维护这个点子树中对应重链的方案数。

于是我们对于每个点维护4个dp值，分别表示左/右端点经过了1/2次的方案数。然后考虑如何合并。首先可以把没有的经过的接起来，即是否可以多覆盖左半边的右端点一次和右半边的左端点一次。然后我们考虑当前合并的左右端是否只有一个点。

然后我们需要维护的是每个点除了重链外的子树大小，作为一个点dp的初值。