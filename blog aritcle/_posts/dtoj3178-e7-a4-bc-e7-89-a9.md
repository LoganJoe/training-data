---
title: " DTOJ3178礼物\t\t"
tags:
  - FFT
url: 1744.html
id: 1744
categories:
  - DTOJ
  - Solution
date: 2018-04-26 14:34:00
---

显然增加的亮度在$\[0,m\]$中。在第二个手环上加等价于在第一个手环上减，因此我们可以看作在第一个手环上改变$\[-m,m\]$的亮度。记$x\_i$为第一个手环的初始亮度，$y\_i$为第二个手环的初始亮度，那么不旋转手环的差异值就是 $$\\sum_{i=1}^{n}(x\_i+c-y\_i)^2$$ 化简一下，即 $$\\sum_{i=1}^{n}{x\_i}^2+{y\_i}^2+c^2-2x\_iy\_i+2cx\_i-2cy\_i$$ $$\\sum_{i=1}^{n}({x\_i}^2+{y\_i}^2-2x\_iy\_i)+2c\\sum_{i=1}^{n}(x\_i-y\_i)+nc^2$$ 我们发现，无论怎样旋转手环，$\\sum_{i=1}^{n}x\_i-y\_i$都是不会变的，所以改变亮度给差异值带来的贡献我们可以单独计算。而$\\sum_{i=1}^{n}{x\_i}^2+{y\_i}^2$也是不会变的，那么现在就是要求，通过旋转手环，最大的$\\sum_{i=1}^{n}x\_iy\_i$是多少。 为了方便第处理环上的问题，我们将$x$倍长，那么从转到第$i$个位置再开始匹配时，所求的值为 $$\\sum_{j=1}^{n}x_{i+j-1}y\_j$$ 我们将$y$翻转，变成了 $$\\sum\_{j=1}^{n}x_{i+j-1}y_{n-j+1}$$ 发现变成了卷积的形式！ 用FFT优化多项式乘法就可以求出从每个位置开始匹配的值了。