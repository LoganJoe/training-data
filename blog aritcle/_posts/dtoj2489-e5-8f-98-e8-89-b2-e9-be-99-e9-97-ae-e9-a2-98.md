---
title: " DTOJ2489变色龙问题\t\t"
tags:
  - 线段树
url: 1155.html
id: 1155
categories:
  - DTOJ
  - Solution
date: 2018-03-21 16:20:14
---

发现$K$较小，肯定有玄机。 显然一段序列可以压成一个二进制数，表示每种数字有没有出现过，我们要找的就是压完每位都为$1$的最短区间。 两段区间的并压起来的状态，等于两段区间的状态的或，因此我们就可以合并两段区间的信息。 那么来考虑一下线段树。 对于线段树每个结点，考虑存下该结点的所有信息，也就是固定左/右端点为该节点的区间端点，另一端点是该结点区间任一位置的每种区间的状态。 这显然是存不下的。发现很多区间的状态是一样的，一个端点在移动的时候，最多只有$50$种不同的状态，因为状态中$1$的个数只增不减。那么我们只要记下这$50$个区间的信息即可。那么每个结点最多记$100$个区间的信息。 修改直接修改就可以了。 现在考虑如何通过结点的信息来求出答案。 有一种早就会写但一直不知道名字的方法：卡尺法。 对于线段树的每个结点，考虑跨过区间中点的答案。首先固定答案左端点在该结点区间的左端点，然后答案右端点从区间中点开始，不断向右拓展到答案区间合法更新答案或到达边界。然后答案左端点往里缩一格，右端点继续向右拓。 发现如果左右端点每次都只移动一格的话效率很差，因为同样有很多区间的状态是一样的。因此左右端点的每次移动，我们都要保证区间状态多了一个$1$，也就是利用线段树上的信息，不断移动左右端点。那么这样在每个结点上，左右端点最多各移动$50$次。 时间空间都是$100nlog\\space n$的，但是跑不满，空间用vector开的话也开不满，不用vector可能会超一点空间，线段树动态开点就好了。