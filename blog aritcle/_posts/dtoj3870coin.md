---
title: " DTOJ3870coin\t\t"
tags:
  - 奇技淫巧
  - 期望
  - 概率dp
  - 贪心
url: 3625.html
id: 3625
categories:
  - DTOJ
  - Solution
date: 2018-08-26 20:19:47
---

记$f\[i\]\[j\]\[k\]$表示前$j$个人有$k$个人喜欢的假币是$i$的概率，那么有 $$f\[i\]\[j\]\[k\]=f\[i\]\[j-1\]\[k-1\]\\times \\frac{p_{j,i}}{1000}+f\[i\]\[j-1\]\[k\]\\times (1-\\frac{p_{j,i}}{1000})$$ 记$g\[i\]\[j\]$为带$j$张第$i$种假币，会被带走的期望个数，那么有 $$g\[i\]\[j\]=\\sum_{k=0}^{n}\\min(j,k)\\times f\[i\]\[n\]\[k\]$$ 记$h\[i\]\[j\]$为前$i$种假币带了$j$张，拿到喜爱假钞的朋友个数的最大期望，那么有 $$h\[i\]\[j\]=\\max_{k=0}^{j}\\{h\[i-1\]\[j-k\]+g\[i\]\[k\]\\}$$ 但这样求$f,g,h$都是$\\Theta(n^2m)$的，显然过不去。 分析一下$g$的差分，我们发现 $$g\[i\]\[j\]-g\[i\]\[j-1\]=\\sum_{k=j}^{n}f\[i\]\[n\]\[k\]$$ 首先它是非负的，其次它是单调不升的。 也就是说，对于第$i$种假币，带$x+1$张比带$x$张期望大，但是带$x+2$张对于带$x+1$张多出来的期望比带$x+1$张对于带$x$张多出来的期望小。 那么我们先假设所有假币都选了$0$张，然后贪心地选一种能使期望变得最大的假币种类，重复$n$次。 那么有很多$g$的值都是不用算的。因为如果第$i$种假币目前选了$x$张，我们只需要知道$g\[i\]\[x+1\]$即可。 那么我们可以动态算$g$，即每次算出$g$的差分，而$g$的差分的变化就是每次少掉一个$f$。 那么我们只要动态算$f$即可。 动态算$f$可以把最后一维压掉，这样空间就过的去了。