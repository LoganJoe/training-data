---
title: " DTOJ3957The Staging\t\t"
tags:
  - 奇技淫巧
  - 线段树
url: 4482.html
id: 4482
categories:
  - Solution
date: 2018-10-24 15:15:24
---

首先瞄准的人是一个排列，所以指向可以拆成若干个环。我们任意选择一个地方破环成链，考虑维护一个人时间改变以后，后面人的生死状态。

这个东西可以用线段树维护。对于每个区间，保存当左端点是否死亡时，右端点能不能开枪杀死下一个人。那么这样区间就可以合并了。我们可以拿右区间对应的状态得到左区间对应的状态，进而得到左端点对应的状态。

具体地，线段树内保存$l\[0/1\]$为左端点状态为$0/1$时，右端点的下一个人是死是活$0/1$，以及$r\[0/1\]$表示左端点状态为$0/1$时，区间内存活人数。

那么区间pushup可以写成这样：

 for(int k=0;k<2;k++)
        {
            t\[x\].l\[k\]=t\[rc\].l\[t\[lc\].l\[k\]\];
            t\[x\].r\[k\]=t\[lc\].r\[k\]+t\[rc\].r\[t\[lc\].l\[k\]\];
        }

这样就可以用线段树维护了。

然后对于区间维护区间中开枪时间的最小值。每次从最小的那个人开始开枪，跑一遍区间的答案更新即可。