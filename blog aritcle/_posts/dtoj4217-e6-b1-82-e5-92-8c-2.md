---
title: " DTOJ4217求和\t\t"
tags:
  - 数学
url: 6891.html
id: 6891
categories:
  - Solution
date: 2019-03-08 16:55:47
---

先化简一下要求的东西。 $$ \\begin{aligned} ans&=\\sum_{i=0}^{n}\\sum_{j=0}^{m}\\binom{i}{j}\[2|i\]\[2|j\]\\\ &=\\sum_{i=0}^{n}\\sum_{j=0}^{m}\[x^j\](x+1)^i\[2|i\]\[2|j\]\\\ &=\\sum_{j=0}^{m}\[2|j\]\[x^j\]\\left(\\sum_{i=0}^{n}(x+1)^i\[2|i\]\\right) \\end{aligned} $$ 后面相当于是一个公差为$(x+1)^2$的等差数列的形式。那么令$F(x)=\\frac{(x+1)^{n+2}-1}{(x+1)^2-1}$。有 $$ ans=\\sum_{i=0}^{m}\[2|i\]\[x^i\]F(x) $$ 除法很难处理。考虑设 $$ a\_i=\[x^i\](x+1)^{n+2} =\\binom{n+2}{i}, b\_i=\[x^i\]F(x) $$ 对于$\\mod k$意义下，我们可以将$k$拆成$2^t\\times s$两部分分别做再暴力合并同余方程。 $b\_i$显然就是杨辉三角$j$列偶数行上的和。考虑$c\_i$是奇数行上的和,那么由杨辉三角递推式，显然有 $$ b\_i+b\_{i+1}=c_{i+1}+\\binom{n+1}{i+1} $$ 又有一个常用恒等式：一列上的和等于其右下方那个组合数。证明很显然，就是 $$ b_{i+1}+c_{i+1}=\\binom{n+1}{i+2} $$ 那么 $$ b\_i+2b\_{i+1}=\\binom{n+1}{i+1}+\\binom{n+1}{i+2}=\\binom{n+2}{i+2}=a_{i+2} $$ 先考虑求$ans \\mod s$。很明显有$(2,s)=1$,因此一定存在$\\mod s$意义下的$2$的逆元。 那么 $$ b_{i+1}=\\frac{b\_i-a\_{i+2}}{2} $$ 可以直接递推。复杂度就是$O(m \\log n)$的了。 对于$ans \\mod 2^t$，我们用另外一种方法化简那个式子： $$ b\_i=\\binom{n+2}{i+2}-2b\_{i+1} $$ 继续化下去就有$$b\_i=a\_{i+2}-2a{i+3}+4b{i+2}$$... 那么 $$ b\_i=\\sum\_{j \\ge i+2}(-2)^{j-i-2}a\_j $$ 那么当$j-i-2 \\ge t$的时候，显然有$(-2)^{j-i-2}a\_j\\equiv 0 \\mod 2$。 复杂度仍然还是$O(m \\log n)$的。