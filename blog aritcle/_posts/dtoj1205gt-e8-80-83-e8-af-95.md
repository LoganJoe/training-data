---
title: " DTOJ1205GT考试\t\t"
tags:
  - KMP
  - 矩阵
url: 1040.html
id: 1040
categories:
  - DTOJ
  - Solution
date: 2018-03-15 18:23:05
---

记$f\[i\]\[j\]$为准考证号前$i$位的最后$j$位，与不吉利数字的前$j$位相同的方案数。则答案为$\\sum_{i=0}^{m-1}f\[n\]\[i\]$ 准确地说，$f\[i\]\[j\]$中准考证都应合法，且一个准考证号应该被末尾能匹配到的最大的$j$记入方案。 考虑在最后面填什么数字能转移到什么位置，记$A\[i\]\[j\]$为在已经匹配了前$i$位的串后，加一个数字有多少种方法能匹配到第$j$位。显然有$i+1\\geqslant j$。且除了$A\[i\]\[0\]$，其他的$A\[i\]\[j\]\\leqslant 1$。 首先肯定有$A\[i\]\[i+1\]=1$。然后考虑对于$j\\leqslant i$的情况。发现是将一个串的后缀和另一个串的前缀匹配，可以想到kmp。因此可以通过失配数组，判断长度为$i$的串失配后，能重新匹配到一个长度多少的前缀，此时再填入新的数就能使匹配长度$+1$。 因为方案应该要被能匹配最大的$j$记入方案，所以$A\[i\]\[j\]$要按$j$从大到小计算，且一种数字只能计算一次，所以要打标记去重。而$A\[i\]\[0\]$就是所有可能的数字个数减去会匹配到新前缀的数字个数，也就是$10-\\sum_{j=1}^{i+1}A\[i\]\[j\]$。 于是就可以通过$A\[i\]\[j\]$来进行转移，即有 $$f\[i\]\[j\]=\\sum_{k=0}^{m-1}f\[i-1\]\[k\]\\times A\[k\]\[j\]$$ 容易看出$A$是一个矩阵，于是用矩阵快速幂优化dp即可。