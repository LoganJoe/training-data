---
title: " DTOJ2262地震后的幻想乡\t\t"
tags:
  - 奇技淫巧
  - 期望
  - 概率
  - 状压dp
url: 3638.html
id: 3638
categories:
  - Solution
date: 2018-08-26 22:21:07
---

对于每条边给到一个$\[0,1\]$内的随机边权，求最小生成树最大边的期望。

由于题目给了期望的性质，我们只需要关心最大边在所有边中的排名。

那么$ans=\\sum_{i=1}^{m}\\frac{ip(i)}{m+1}$

$p(i)$为瓶颈树中最大边排名为$i$的概率。

但是这个东西不太好求。让我们求瓶颈树中最大边排名大于等于$i$的概率，也就是选了前i小的边，恰好构成生成树的概率。

这个东西等价于用排名严格小于$i$的边不能使图联通的概率，也就是相当于在求选了前$i$小的边，图不能联通的概率。

关于最后那个转化，假设当前算到了一个$k$条边的方案，那么当$i$取遍0到k-1时，它的任意子集都会被统计到，所以答案就会被累计进去了。

那么现在要求$f(i)$为选$i$条边使得点集不连通的方案数，然后我们除以总方案数得到概率。考虑子集dp，令$cnt\[S\]$表示点集$S$之间的无向边边数，$f\[S\]\[i\]$表示点集为$S$，选用$i$条边使点集不连通的方案数，$g\[S\]\[i\]$表示点集为$S$，选用$i$条边使点集连通的方案数。显然有$f\[S\]\[i\]+g\[S\]\[i\]=\\binom{cnt\[S\]}{j}$。

为了不重计数，首先要选一个定点￥p \\in S￥，然后对于$S$枚举其一个真子集$T$，保证$p \\in T$,然后做dp转移。

然后就有：

$$(\\binom{cnt\[T\]}{j}-f\[T\]\[j\])\\times \\binom{cnt\[S\ Xor \ T\]}{i-j}\\Rightarrow f\[S\]\[i\]$$

$p(i)$就可以被计算出来了。