---
title: " DTOJ2518EL_BSGS的区间\t\t"
tags:
  - 分数规划
  - 区间dp
  - 奇技淫巧
url: 5157.html
id: 5157
categories:
  - DTOJ
  - Solution
date: 2018-11-16 16:33:45
---

我们要让$\\frac{sum}{k}$最大，最大化的是一个分式，我们考虑分数规划。 我们二分一个答案$mid$，如果存在$sum$和$k$，满足$\\frac{sum}{k}> mid$，那么答案就可以更大。 记第$i$次拿的收益为$val\_i$，那么$sum=\\sum\_{i=1}^{k}val\_i$。 那么我们就是要求$\\frac{\\sum\_{i=1}^{k}val\_i}{k}>mid$是否成立。 等价于 $$\\sum\_{i=1}^{k}val\_i>mid\\times k$$ $$\\sum\_{i=1}^{k}(val\_i-mid)>0$$ 那么问题就变成了，每次操作的收益是所有牌的和的绝对值$-mid$，求操作任意次后收益是否可能$>0$。即我们要求出最大的收益。 考虑dp。我们称已经被拿走的数为完结的，由完结的数组成的区间为完结区间。一次操作可能会增加多个完结区间。 记$f\[i\]\[j\]$为第$i$个数一定是未完结的，区间$\[i,j\]$中所有完结区间的收益加上所有未完结数的和的最大值。 记$g\[i\]\[j\]$为第$i$个数一定是未完结的，区间$\[i,j\]$中所有完结区间的收益的相反数加上所有未完结数的和的最小值。 两者区别就是已经完结区间的收益的贡献是$+$还是$-$。 我们枚举一个$k\\in(i,j\]$，代表我们要在区间$(i,k\]$中操作一次，即增加一些完结区间。 那么有 $$f\[i\]\[j\]=\\min \\begin{cases} f\[i+1\]\[j\]+a\_i\\\ \\min_{k=i+1}^{j}\\{-g\[i+1\]\[k\]+f\[k+1\]\[j\]-mid\\}+a\_i\\end{cases}$$ $$g\[i\]\[j\]=\\min \\begin{cases} g\[i+1\]\[j\]+a\_i\\\ \\min_{k=i+1}^{j}\\{-f\[i+1\]\[k\]+g\[k+1\]\[j\]+mid\\}+a_i\\end{cases}$$ 最大的收益就是$\\max(f\[1\]\[n\],-g\[1\]\[n\])-mid$。 稍微解释一下为什么没有绝对值的限制。 我们知道$|x|=\\max(x,-x)$（废话）。我们每次把$x$和$-x$的情况都考虑一下，最优解总在这两种情况之中。 那么在$f\[i\]\[j\]$的转移中，我们只考虑这次拿走的数的和是负的情况，因此要使这些数的和最小，这样取反后才是最大的。如果无论怎么取和都$>0$，那么转移会更劣，但由于我们要求的是最大值，因此没有影响。 同样地，在$g\[i\]\[j\]$的转移中，我们只考虑这次拿走的数的和是正的情况，因此要使这些数的和最大。但在$g$中完结区间的贡献是负的，因此收益要取反再算入。