---
title: " DTOJ3528全排列\t\t"
tags:
  - dp
url: 561.html
id: 561
categories:
  - DTOJ
  - Solution
date: 2018-02-16 11:57:16
---

首先吐槽出题人的辣鸡语文。相似明明是定义在排列上的，后面取某一段不是排列的来相似。 相似的定义其实就是两个数列中元素的相对大小关系要相同，也就是把两个数列分别离散后相等。 发现离散后相对大小关系不变，那么逆序对个数也不会变。并且离散后的数列是一个排列，如果能计算出离散后满足逆序对限制的排列个数，就能通过简单的计数知识计算出答案。 令$f\[i\]\[j\]$为长度为$i$，逆序对个数为$j$的排列个数。 显然有$f\[i\]\[j\]=\\sum_{k=0}^{i-1}f\[i-1\]\[j-k\]$，即考虑最大的数$i$要放在哪个位置。 对于一个满足逆序对限制的排列，我们可以统计出离散前的数列个数。 这个计数是很简单的，即从$n$个数选出$i$个数然后让它们排成对应的大小顺序。把这些数当做我们选出的$\[l,r\]$，然后剩下的数随便排。因此答案为$\\sum_{i=1}^{n}{C_{n}^{i}}^2\\times fac\[n-i\]^2\\times (n-i+1)\\sum_{j=0}^{E}f\[i\]\[j\]$。