---
title: " DTOJ3880灌水\t\t"
tags:
  - dp
  - 思路
url: 3678.html
id: 3678
categories:
  - DTOJ
  - Solution
date: 2018-08-28 12:09:10
---

又是这种奇怪的装水问题。 同样还是考虑灌水之后水平面的形状，显然是先递增然后再递减的。 我们发现，如果将递减的那一段插入到递增的中间，是不会影响容积的。 而容积就是水平面形状的面积减去$\\sum_{i=1}^{n}a\_i$，其中$a\_i$为第$i$块木板的长度。 那么问题就变成了，有多少种可能的水平面形状的面积。 记$f\[i\]\[j\]\[k\]$为考虑高度$\\leq i$的木板，还有$j$个没有用，当前面积为$k$是否可行。 那么有 $$f\[i\]\[j\]\[k\]\\Rightarrow f\[i+1\]\[j+cnt_{i+1}-s\]\[k+s(i+1)\] s\\in\[0,j+cnt_{i+1}\]$$ 即枚举高度为$i+1$的水平面有几个。其中，$cnt\_i$是高度为$i$的木板数量。 考虑优化一下，转移其实可以写成这样 $$f\[i\]\[j\]\[k\]\\Rightarrow f\[i+1\]\[j+cnt\_{i+1}\]\[k\]$$ $$f\[i\]\[j\]\[k\]\\Rightarrow f\[i\]\[j-1\]\[k+i\]$$ 由于$f\[i\]\[j\]\[k\]$只可能是$0$或$1$，我们可以拿bitset作第三维，优化一下。第一维也可以滚掉。 那么时间复杂度就是$\\Theta(\\frac{n^2l^2_{max}}{32})$。 lhy和slz大佬直接拿每块木板可能的积水量去做背包，然后bitset优化过了此题，mmp原来这有正确性。