---
title: " BZOJ2873光之大陆\t\t"
tags:
  - dp
  - prufer序列
  - 思路
url: 6768.html
id: 6768
categories:
  - Solution
date: 2019-03-03 14:54:32
---

这是一个弱性质的仙人掌计数：每个**点**仅属于一个简单环。 那么我们将所有的简单环拉出来看做一个块，将普通的不属于环的点也当做一个块。问题转化成了$n$个点$m$个块的生成树计数。 考虑$n$个点的生成树计数，由$purfer$序列可知，$n$个点的生成树个数为$n^{n-2}$个。对于包含块的生成树，我们考虑每次去掉$1$个块，块上挂的点又可以在$1\\sim n$中任取。于是，$n$个点$m$个块的，每个简单环可以有标号带朝向对称翻转的生成树个数为$n^{m-2}$。 需要注意的是，这里的环是有标号，带朝向对称翻转的。也就是说，对于其外向边，我们要考虑其相同外向边结构的翻转情况。 ![](https://img-blog.csdn.net/20180425160009438?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0l6dW1pX0hhbmFrbw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70) 设$f\[i\]\[j\]$表示$i$个点划分成$j$个块的方案数。枚举当前新增的块的大小： $$ f\[i\]\[j\] = \\sum dp\[i-k\]\[j-1\]\\times \\binom{i-1}{k-1}\\times g\[k\] $$ 考虑计数$g\[k\]$为大小为$k$的考虑朝向的带标号简单环数目。 $$ g\[k\]=\\frac{(k-1)!}{2}*k=\\frac{k!}{2} $$ 就可以直接做了。