---
title: " DTOJ3502送你一棵圣诞树xmastree1\t\t"
tags:
  - 树套树
url: 241.html
id: 241
categories:
  - DTOJ
  - Solution
date: 2018-01-15 20:42:28
---

如果没有修改，这是一道很经典的题。 单独考虑某种颜色，将这种颜色的点按照$DFS$序排序，每个点的贡献为$1$，相邻点的$LCA$贡献为$-1$。这样一个子树内的颜色数就是这个子树的$DFS$序区间的贡献和。单点加和区间查询可以用树状数组或线段树维护。 如果要查询颜色区间$\[l,r\]$，那就把线段树改成主席树，用$\[1,r\]$的颜色数$-\[1,l)$的颜色数。 如果有修改，因为强制在线，就需要树套树了。 可以用树状数组套线段树或者线段树套线段树，里面的线段树要像主席树一样动态开点防止$MLE$。外层维护颜色，内层线段树维护贡献和。至于修改，对于每种颜色开一个$set$按这种颜色的点的$DFS$序排序，就可以查询$LCA$来修改了。