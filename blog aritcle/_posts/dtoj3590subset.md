---
title: " DTOJ3590subset\t\t"
tags:
  - CDQ分治
url: 1331.html
id: 1331
categories:
  - DTOJ
  - Solution
date: 2018-04-05 23:21:35
---

同DTOJ2510drinks。 对于一个合法的三元组对应的下标集合，只保留取到最大值的下标。称这样的集合为最简下标集合，显然最简下标集合大小$\\leqslant 3$。 发现最简下标集合和合法三元组是一一对应的关系，因此问题变成了求最简下标集合的数量。 首先大小为$1$的集合一定是最简下标集合。 其次考虑大小为$2$的集合，只要不满足集合中的一个元素在$a,b,c$上都比另一个大即可。那我们可以用大小为$2$的集合的数量，减去大小为$2$的不合法集合的数量。不合法集合要满足其中一个元素在$a,b,c$上都比另一个大，这是一个三维偏序问题，用CDQ+树状数组解决。 最后考虑大小为$3$的集合，这说明集合中的每个元素都在$a,b,c$其中一个上最大。 仍然考虑用总的集合数减去不合法的集合数。 第一种不合法的情况是其中一个元素在$a,b,c$上都是最大的，即类似大小为$2$的不合法集合。同样可以用CDQ+树状数组解决。记这种不合法的情况有$A$个。 第二种不合法的情况是其中一个元素在$a,b,c$中的两项最大，另一个元素在$a,b,c$另一项上最大。记这种不合法的情况有$B$个。 枚举$a,b,c$中的两项，计算满足其中一个元素在这两项上最大的集合数量。记三种情况的集合数量的和为$C$。 那么可以发现，第一种不合法的情况对$C$产生了三次贡献，第二种不合法情况对$C$产生了一次贡献，也就是说我们有$3A+B=C$。 $C$可以用树状数组求出。那我们已知$A$和$C$，就可以解出$B$了。