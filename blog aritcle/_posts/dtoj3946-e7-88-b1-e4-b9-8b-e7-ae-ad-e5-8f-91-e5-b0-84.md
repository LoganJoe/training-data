---
title: " DTOJ3946爱之箭发射\t\t"
tags:
  - 线段树合并
url: 4290.html
id: 4290
categories:
  - Solution
date: 2018-10-21 13:48:45
---

不妨将删边改成加边。倒序处理询问，每次相当于合并两棵树，得到答案。

对于每个联通块维护一棵权值线段树。那么每次相当于合并两棵线段树。

对于权值线段树上的一段值域，假设其另外一棵线段树上的对应值域为空，那么合并的时候产生的收益增量$\\Delta = rsum*tot$。$lson$是另外一棵线段树在这段区间之后所有区间的$w_i$和。

否则对于一段都有值的区间，当两段区间均为叶子节点，合并的时候就是另一棵树的$rsum$与当前树的$tot$分别相乘得到其中一棵树的$\\Delta$，即是前面多一个数对于后面产生的影响

这样就可以进行线段树合并了。

线段树合并是$O(n \\log n)$的。