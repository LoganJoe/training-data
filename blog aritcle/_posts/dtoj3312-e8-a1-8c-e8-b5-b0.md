---
title: " DTOJ3312行走\t\t"
tags:
  - 并查集
  - 树链剖分
  - 线段树
url: 2155.html
id: 2155
categories:
  - Solution
date: 2018-05-28 21:12:23
---

我们注意，每次除以一个数，那么对于整条链除的就是路径上权值的乘积。因此一个解法是树链剖分加上维护区间积。 由于一开始的数最大1e18，观察到区间积大于1e18时除下去就是0了。因此做一个标记，乘起来如果超出1e18就直接返回某个值。修改和查询是板子。效率$O(n log^2 n)$ 同时我们发现，路径上不为$1$的边权最多只能有$60$个。因为整数的边权至少为2,$2^60 \\geq 10^{18}$。因此我们对于每次修改，假设边权为1则并查集合并上下两条边，然后对于询问暴力跳链，最多跳60次即可。效率$O(n log 10^{18})$