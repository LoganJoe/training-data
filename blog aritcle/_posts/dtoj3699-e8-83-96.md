---
title: " DTOJ3699胖\t\t"
tags:
  - ST表
  - 二分
  - 最短路
url: 1823.html
id: 1823
categories:
  - DTOJ
  - Solution
date: 2018-04-30 20:04:12
---

从$0$号点到瞭望塔的边显然只会更新一次，剩下的都是在瞭望塔之间的更新。 我们要求每个瞭望塔被更新的次数，等价于求每个瞭望塔能更新的节点数的和。 显然每个瞭望塔能更新的点是一段连续的区间。 枚举每个瞭望塔，二分区间端点，然后判断这段区间是否都能被当前瞭望塔更新。等价于判断区间端点是否能被当前瞭望塔更新。 记当前瞭望塔为$x$，区间左端点在$l$，我们要判断$l$是否能被$x$更新。 记$d=x-l$，那么在$x$能更新到$l$之前，$\[l-d,l+d)$中的点都能更新到$l$，为了使$l$最终会被$x$更新，说明用$\[l-d,l+d)$的点去更新$l$都比用$x$更新$l$劣。即$\[l-d,l+d)$的点到$l$的最短路都大于$x$到$l$的最短路。 最短路可以通过前缀和预处理，然后就变成了区间最值问题。一段区间的点显然只有瞭望塔是有用的（其他点都要从瞭望塔更新），那么我们就是要维护一段区间的瞭望塔到$0$的距离$\\pm$距离前缀和（根据查询的区间在$l$的左右侧有所不同），这个可以用st表预处理出来。查询的时候二分查找到这段区间对应的瞭望塔区间，再查st表即可。 区间右端点同理。 注意考虑多个瞭望塔到同一个点的路径长度相同的情况，如果不加处理的话会算重。在这种情况下可以把这个点归给距离最近（有多个则选左侧）的瞭望塔即可。