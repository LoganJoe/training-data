---
title: " DTOJ1430ballmachine\t\t"
tags:
  - 倍增
  - 思路
url: 2743.html
id: 2743
categories:
  - DTOJ
  - Solution
date: 2018-07-14 14:55:39
---

先考虑放一个球，最终会落到哪里。 按照题意，它会不断往有小数字的子树走。那么我们预处理出，以每个点为根的子树中权值最小的点。这样我们就可以求出每个球依次最终落的位置。记第$i$个球会落到的位置是$a\_i$，记会落到点$i$的是第$b\_i$个球。 那么拿掉一些球之后，再放一个球，这个球一定是会掉到$b\_i$最小且为空的结点上（$i$最小且$a\_i$为空的$a\_i$上）。那么我们可以拿一个set以$b\_i$为关键字维护现在空的结点。每掉下一个球就从set找出最小的元素然后删除它。 现在考虑拿掉一个球。 显然只会影响到往根的路径上的一连串球。对set的影响是会空出空出最上面的一个位置。而影响到的球的数量也可以通过最上面的球的深度来求。 那么我们就是要找到每个球最上面的球在哪。 显然每个球上面都是连续一段有球，那么我们可以倍增找，跳到一个位置看一下这个位置有没有球即可。 那么再给有球的位置打个标记即可。