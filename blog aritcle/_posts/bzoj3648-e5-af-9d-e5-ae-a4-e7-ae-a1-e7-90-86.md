---
title: " BZOJ3648寝室管理\t\t"
tags:
  - 思路
  - 点分治
  - 环加外向树
url: 5822.html
id: 5822
categories:
  - BZOJ
  - Solution
date: 2018-12-27 22:59:02
---

对于$m=n-1$的情况，就是一个点分治的模板题，写一个点分治就可以求出路径数量了。 对于$m=n$的情况，我们先删掉一条环边，把基环树变成树。然后用点分治求出这棵树上合法的路径数量。 考虑单独计算经过被删掉的边的合法路径数。 假设我们被删掉的是$x,y$之间的边，那么我们就是要计算形如$u\\rightarrow x\\rightarrow y\\rightarrow v$的路径中合法的数量。 我们可以维护从$x$出发和从$y$出发的路径信息，然后两段路径拼起来得到总路径（类似点分治中的信息合并）。但是这样拼起来的路径可能会经过重复的边，考虑如何解决这个问题。 贴一张别人blog的图。 ![](http://www.dtenomde.com/wp-content/uploads/2018/12/D59AA400-4520-471E-81D4-5B5AE3EE8E26.jpg) 我们从$x$开始，按顺序枚举环上的点$u$。 然后我们把形如$y\\rightarrow u\\rightarrow v$的路径信息从属于$y$的部分中删掉，把形如$x\\rightarrow u\\rightarrow v$的路径信息加入属于$x$的部分，同时合并路径信息更新答案。具体实现可以用两个树状数组分别维护属于$x$和$y$的路径信息。 找环可以用dfs或者并查集。