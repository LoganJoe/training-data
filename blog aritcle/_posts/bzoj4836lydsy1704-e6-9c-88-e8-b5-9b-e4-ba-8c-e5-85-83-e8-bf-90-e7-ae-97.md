---
title: " BZOJ4836[Lydsy1704月赛]二元运算\t\t"
tags:
  - FFT
  - 分治
  - 生成函数
url: 2465.html
id: 2465
categories:
  - BZOJ
  - Solution
date: 2018-06-15 22:27:26
---

显然要预处理出所有答案然后$\\Theta(1)$回答询问。 先考虑只有$x+y$怎么做。记序列$A$每种值的出现次数的生成函数为$F(x)$，序列$B$每种值的出现次数的生成函数为$G(x)$。那么$a\_i+b\_j=c$的数对$(i,j)$个数就是$F(x)\\times G(x)\[x^c\]$。（好像是这么写的吧？就是$x^c$前面的系数） 再考虑只有$x-y$怎么做。这其实相当于所有的$b\_i$都变成了$-b\_i$，然后和$x+y$是一样的。我们只要把原来$G(x)$初始的系数翻转一下，即把$b$取反然后右移。最后答案的对应项也右移即可。 现在考虑它两种情况的条件，是两个数的大小关系。 相对大小关系可以想到对权值分治，每次只考虑小的和大的之间的影响。 假设当前的值域是$\[l,r\]$，那么我们考虑序列$A$中权值在$\[l,mid\]$的数和序列$B$中权值在$(mid,r\]$的数对答案的贡献。显然它们之间的运算是加。FFT一次即可。 然后再考虑序列$A$中权值在$(mid,r\]$和序列$B$中权值在$\[l,mid\]$的数对答案的贡献。显然它们之间的运算是减。同样FFT一次即可。 对于等于的情况我们单独计算一下加进答案即可。 分治FFT，时间复杂度$\\Theta(n\\log^2 n)$。