---
title: " DTOJ3820灯\t\t"
tags:
  - 分块
  - 思路
url: 2801.html
id: 2801
categories:
  - DTOJ
  - Solution
date: 2018-07-18 18:18:15
---

考虑修改对答案的影响。如果一盏灯亮了而两侧灯是暗的，那么答案$+1$；一盏灯亮了而两侧灯是亮的，那么答案$-1$。当灯暗了也同理。 因此答案的改变只和这种颜色的灯两侧灯都亮的个数和灯都暗的个数有关。考虑如何维护这个东西。 先考虑暴力。 当修改某种颜色的灯后，我们暴力找到每一个这种颜色的灯，然后把灯的状态修改，然后更新个数即可。 但如果同一种颜色的灯出现了很多次，这样修改的效率就很丑了。 注意到，出现很多次的灯的颜色数必然不会很多。 那么我们可以想到按照出现次数给灯分类。容易想到分为$\\leqslant \\sqrt{n}$和$>\\sqrt{n}$两类。 对于出现次数$\\leqslant \\sqrt{n}$的灯，我们可以暴力修改。 而出现次数$>\\sqrt{n}$的灯，必然最多只有$\\sqrt{n}$种。我们考虑维护这类的每种灯两侧灯同亮同暗的个数，最多一共有$2\\sqrt{n}$个值。 我们可以先处理出这些值。每次修改后，我们要更新这$2\\sqrt{n}$个值。 我们发现，每亮/暗一盏灯，如果在这盏灯两侧的那种灯的出现次数$>\\sqrt{n}$，就会对我们要维护的值造成影响。而亮一盏灯的影响是$+1$，暗一盏灯的影响是$-1$。 那么我们只要维护这$\\sqrt{n}$种灯的两侧为每种灯的个数，就能对要维护的值进行修改了。 时间复杂度和空间复杂度都是$\\Theta(n\\sqrt{n})$。