---
title: " DTOJ4242大爷\t\t"
tags:
  - 思路
  - 费用流
url: 7106.html
id: 7106
categories:
  - Solution
date: 2019-03-24 14:10:47
---

考虑对于每个带限制的点，其子树也会有一些带限制的点。 考虑所有带限制的点的限制一定得被满足，所以我们不妨将所有带限制的点看做它及它的子树选了$b\_i$个点。那么我们做一遍树形dp,记录一下每个关键点直接限制的点有几个，以及标记出每个点对应的关键点。可以发现，这就是该点到根路径上离其最近的关键点。 那么现在问题转化成了，选择一些点，使得两棵树上的限制都满足，并且权值最大。考虑选了一个点，可以使得对两边各一个点作出$1$的贡献。于是我们建两排点分别代表两棵树上的关键点，$S$向其中一排点连直接限制的点个数的边，另一边向$T$同理。而对于其中每个点，在两棵树对应的关键点之间，连一条容量为$1$，费用为$w\_i$的边，表示割掉这条边，可以满足两边的点$1$的流量，并且带来$w_i$的收益。至此，这就是一个最大费用最大流问题了。