---
title: " DTOJ3718军训列队\t\t"
tags:
  - 二分
  - 可持久化线段树
url: 1991.html
id: 1991
categories:
  - DTOJ
  - Solution
date: 2018-05-16 11:39:33
---

显然我们要在区间$\[K,K+r-l\]$中找一个分界点$x$，使得编号在$\[l,r\]$中且在$x$左边的学生，最后站在$\[K,x\]$，编号在$\[l,r\]$中且在$x$右边的学生，最后站在$\[x+1,K+r-l\]$。 如果我们知道了$x$，并且知道在$x$左边和右边所有学生的坐标和，那么我们可以很容易地算出所有学生消耗的体力和。 那么现在的问题就是求出$x$和维护学生的坐标和。 坐标和可以用线段树维护，注意到询问有$\[l,r\]$的限制，因此利用前缀和的思想，用主席树维护。 $x$显然是可以用二分求出，我们可以二分一个$mid$，然后每次查询在$mid$左边的学生数量。但这样是$\\Theta(nlog^2\\space n)$的，可能会被卡常？ 我们可以考虑在线段树上二分，在线段树上走的时候根据左儿子区间的学生数量来决定接下来要往左儿子还是右儿子走。这样就是$\\Theta(nlog\\space n)$的了。 注意到$x$最大可以取到$max\\{a_i\\}+n$，同时要注意求出的$x$的左边或右边可能没有一个编号在$\[l,r\]$中的学生，也许需要一些特判。