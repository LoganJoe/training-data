---
title: " BZOJ2873光之大陆\t\t"
tags:
  - dp
  - prufer序列
  - 思路
url: 6754.html
id: 6754
categories:
  - BZOJ
  - Solution
date: 2019-03-03 14:30:11
---

题意就是统计每个点最多在一个环中的图的数量，可以认为是特殊（环不共点）的仙人掌的数量。 还是称我们要统计的这个东西为树吧。 我们可以将树分成若干个点和若干个环。 假设我们的点和环一共有$m$个，那么连成一棵树的方案数是$n^{m-2}$。 这应该算是Prufer序列的拓展，有关Prufer序列，请看[这](http://www.dtenomde.com/author=jiangyutong/article=3148/)。 $m$个点的有标号无根树有$m^{m-2}$种。用Prufer序列来理解，就是长度为$m-2$的Prufer序列，每个位置上能放$\[1,m\]$中的任意一个数，因此Prufer序列有$m^{m-2}$种。 回到刚刚的问题，Prufer序列长度仍然是$m-2$，但是每个位置上能放的数变成了$\[1,n\]$，因此方案数是$n^{m-2}​$。 那么现在的问题就是将$n$个点分成$m​$个点和环的方案数了。 我们认为一个环或一个点为树的一个部分。考虑dp。 记$f\[i\]\[j\]$为把$i$个点分成$j$个部分的方案数。 考虑最后一部分（有第$i$个点的部分）的大小，以及最后一部分有哪些点，我们可以得到转移 $$ f\[i\]\[j\]=\\sum_{k=1}^{i}f\[i-k\]\[j-1\]\\cdot \\binom{i-1}{k-1}\\cdot g\[k\] $$ 其中$g\[k\]$为大小为$k$的部分有多少种方案，也就是树上一个$k$个点的环有多少种方案。特别的$g\[2\]=0$，因为这是不合法的。 我们知道，有编号的大小为$k$的环排列有$(k-1)!$种。但是我们的边是无向的，因此会存在对称的问题（比如说$1\\space 2 \\space 3$和$3\\space 2\\space 1$对应的连边方式实际上是同一种），这样就只有$\\frac {(k-1)!}2$种。 但我们现在还要把环挂在树上。 对于$\\frac{(k-1)!}2$种的任意一种，我们连成一棵树后，将这个环转一个位置，仍然是一种不同的方案。 一共可以转出$k$种方向，因此$g\[k\]=\\frac{k!}2$。 最后统计答案的时候，所有点形成一个环的情况我们特殊考虑，其他的用Prufer序列即可，即 $$ ans=g\[n-1\]+\\sum_{i=2}^n f\[n\]\[i\]\\cdot n^{i-2} $$ 时间复杂度$\\Theta(n^3)$。