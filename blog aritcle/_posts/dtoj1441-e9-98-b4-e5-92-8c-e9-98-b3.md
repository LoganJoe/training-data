---
title: " DTOJ1441阴和阳\t\t"
tags:
  - 点分治
url: 3521.html
id: 3521
categories:
  - DTOJ
  - Solution
date: 2018-08-23 20:30:58
---

树上路径计数问题，考虑点分治。 我们把$0$看作$-1$，那么如果一条路径的权值和为$0$且中间存在一个点到两端的权值和为$0$，那么就是合法的路径。 记当前重心为$root$，$root$到$x$路径的权值和为$val\_x$。 我们dfs求出每个点的$val$的同时，记录一下$root$到$x$的路径上是否已经存在点$p$使得$val\_p=val\_x$，如果存在记$mark\_x=1$，否则$mark\_x=0$。 如果$val\_x+val\_y=0$且$mark\_x|mark\_y=1$，那么$x$到$y$的路径就是合法的。 我们按照$|val|$给所有点分类，然后统计一下每类中$mark=0$和$mark=1$的个数，计算一下合法路径数即可。 对于$val\_x=0$的点可能需要一些特判。