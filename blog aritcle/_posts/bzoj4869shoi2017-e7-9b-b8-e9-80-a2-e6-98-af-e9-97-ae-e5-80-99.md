---
title: " BZOJ4869[Shoi2017]相逢是问候\t\t"
tags:
  - 定理
  - 线段树
url: 959.html
id: 959
categories:
  - BZOJ
  - Solution
date: 2018-03-08 11:34:50
---

扩展欧拉定理

> $a^b\\equiv a^{b\\%φ(p)+φ(p)}(mod\\space p),b\\geqslant φ(p)$

同时有$φ(φ(p))<\\frac{p}{2}$，可以发现一个数被修改了$log\\space p$次后就不会再改变。 于是我们可以暴力修改整个序列，用线段树维护整段区间是否都不需要修改，不需要修改就跳过。 注意计算$φ(p),φ(φ(p)),…$时要计算到$φ(1)=1$而不是$φ(2)=1$。因为如果原序列中出现了$0$，这时候最里面的那层$a^0=1$，此时若$c\\geqslant 2$不多加一层$φ(1)=1$会出错。具体的可以看[这](http://blog.csdn.net/llgyc/article/details/71076172)。 还有就是我们要判断$b\\geqslant φ(p)$，在快速幂时要加一个判断，判断乘的时候有没有$\\geqslant φ(p)$。 这样是$O(nlog^3)$，可以过。 考虑优化一下。发现$p<2^{28}$，预处理出所有$c^k\\%p,c^k\\%φ(p),c^k\\%φ(φ(p))…$可以减少一个$log$。但这样存不下。我们改成预处理出所有$c^k$和$c^{2^{14}k}(k<2^{14})$，同时记下每个结果是否$\\geqslant$模数。这样求快速幂的时候就可以拆成两个相乘快速求出了。