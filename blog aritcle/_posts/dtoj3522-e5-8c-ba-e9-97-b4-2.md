---
title: " DTOJ3522区间\t\t"
tags:
  - ST表
  - 分治
url: 527.html
id: 527
categories:
  - DTOJ
  - Solution
date: 2018-02-05 13:16:43
---

> 相信聪明的你一定能发现，如果你解决了长度为$2$的情况，你就能拿到$100$分了。

这是显然的，把所有长度为$2$的答案并在一起就行了。 所以就变成求长度为$2$的答案。 因为给出的是一个排列，所以连续区间的并也一定是连续区间，可以用反证法证明。 因此我们对于每个连续区间，更新区间内位置的答案，即维护最右的左端点和最左的右端点。 考虑分治。我们从$\[mid,mid+1\]$开始扩展在$\[l,r\]$中跨过$mid$的连续区间。 我们让左端点先向左移动一格，右端点就往右扩到第一个合法的位置，这个可以提前用st表预处理出包含某些连续数字最短的区间来完成。现在就得到了一个连续区间，拿它更新答案。 同样地，我们也可以右端点先向右移动一格，左端点往左扩到第一个合法的位置，更新答案。 剩下的分治进行。 询问就把询问内的答案区间并在一起，这也是一个RMQ问题，同样用st表解决。