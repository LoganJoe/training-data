---
title: " DTOJ4138染色\t\t"
tags:
  - NTT
  - 分治
  - 斯特林数
url: 6590.html
id: 6590
categories:
  - DTOJ
  - Solution
date: 2019-02-24 13:56:22
---

我们先考虑如何计算$\\sum\\limits_{i=1}^c f(i)$。

对于某种颜色的连通块，我们把这个连通块对$\\sum\\limits _{i=1}^c f(i)$的贡献记在连通块中深度最小的点上。

对于一个点，我们考虑将它和儿子的连边都染色完的所有方案中，这个点对$\\sum\\limits _{i=1}^c f(i)$贡献为$1,2,3,…,deg_i$的方案数为多少。

其中$deg_i$表示第$i​$个点的度数。

对于一个非根节点，假设它和父亲的边的颜色为$color$，那么贡献值就是和儿子连边中除了颜色$color$的颜色种类数。我们可以根据这个来计算方案。

我们手模一下$deg_i$较小时的方案数。

 

$0$

$1$

$2$

$3$

$1$

$1$

 

 

 

$2$

$1$

$c-1$

 

 

$3$

$1$

$3(c-1)$

$(c-1)(c-2)$

 

$4$

$1$

$7(c-1)$

$6(c-1)(c-2)$

$(c-1)(c-2)(c-3)$

其中横轴表示对$\\sum\\limits _{i=1}^c f(i)$的贡献，纵轴为$deg_i$。

发现除去常数项，每列都是相同的，且是$c-1$的下降幂。

发现常数项好像也似曾相识，实际上，如果你会手模这个表格，就应该可以意识到递推系数的式子实际上就是第二类斯特林数。

我们要的系数实际上就是斯特林数的某一行，用NTT即可在$\\Theta(deg\_i\\log deg\_i)$内求出。

根节点的贡献也是类似的，这里不具体说了。

一个点对$\\sum \\limits _{i=1}^cf(i)$的贡献我们已经知道了，那么$\\sum\\limits_{i=1}^cf(i) ​$等于所有点的贡献和，我们只用将所有点的贡献合起来就可以了。

一个点对$\\sum\\limits_{i=1}^c f(i)$的贡献可以看成一个多项式，$x^i$前的系数表示贡献为$i$的方案数。

那么$\\sum\\limits _{i=1}^c f(i)=v$的方案数实际上就是所有点的多项式的乘积中$x^v$前的系数。

分治NTT即可。

最后再求一下$k$次方就可以算出答案了。

总时间复杂度$\\Theta(n\\log ^2 n)$。

发现这个效率和$k$毫无关系，但是$0\\leq k\\leq 3$。

这是因为出题人的做法好像是根据$k$的值分类讨论然后去DP的，时间复杂度好像为$\\Theta(n\\log n)$。