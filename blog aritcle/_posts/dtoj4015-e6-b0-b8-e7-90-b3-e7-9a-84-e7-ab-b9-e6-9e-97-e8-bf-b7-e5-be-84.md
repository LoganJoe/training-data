---
title: " DTOJ4015永琳的竹林迷径\t\t"
tags:
  - dp
  - 数学
  - 概率
url: 4843.html
id: 4843
categories:
  - Solution
date: 2018-10-31 13:02:35
---

题目是一棵树上有$n$个点，$k$个关键点。按随机顺序依次经过每一个点，求期望路径。 考虑两个点是否连续，如果连续，则它的贡献值为$dist(a,b)$，而它的概率为$\\frac{(n-1)\\times (n-2)!}{n!}=\\frac{1}{n}$。所以我们只需要求出任意两点间的距离就好了。 考虑计算$\\sum_{i=1}^{n}\\sum_{j=1}^{n,i\\neq j}dist(i,j)$。由于$dist(a,b)=f\_a+f\_b-2*f_{lca(a,b)}$，其中$f\_i$为点$i$到根的距离。因为$f\_i$固定被加$2n-2$次，所以我们只需要求出$\\sum_{i=1}^{n}\\sum_{j=1}^{n,i\\neq j}f_{lca(i,j)}$即可。考虑在$dfs$的过程中，我们可以把每个子树的点与这个子树外的点数乘起来，这样就是以这个点为$lca$的路径条数。