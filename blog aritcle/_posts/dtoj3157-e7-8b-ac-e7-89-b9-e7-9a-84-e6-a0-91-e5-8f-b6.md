---
title: " DTOJ3157独特的树叶\t\t"
tags:
  - hash
  - 思路
url: 5462.html
id: 5462
categories:
  - DTOJ
  - Solution
date: 2018-12-13 14:53:28
---

题意就是问我们去掉B树的哪个叶节点能使得A B这两棵无根树同构。 判断有根树同构可以使用树hash，树hash的方式有很多种，hash的信息越多就越复杂，但也越不容易冲突。 判断无根树同构我们可以找到树的重心，如果在边上就把重心拆成一个点，然后判有根树同构即可。 但这道题，它不是普通的有根树或无根树的同构问题，它还涉及到了删点。 我们删掉一个点后，树的重心会发现变化，hash值就变得不好维护了。 因此我们考虑判断有根树同构。 那么我们要求出A树以每个点为根的hash值，以及B树中删掉每个点后的hash值（根可以任取），然后判断B树的hash值是否在A树的$n$个hash值出现过即可。 树hash的过程相当于树形dp的问题，也就是说我们要实现树形dp中的换根操作。 换根操作一般都可以用两遍dfs完成，一遍自底向上，一遍从上到下。 对于A树，自底向上时我们求出每个点子树的hash值，从上到下时我们可以通过挖掉一个子树再接上一个子树来求出以每个点为根的hash值。 对于B树，我们也同理。然后对于每个叶子的父亲$x$，计算一下以$x$为根再挖掉一个叶子节点的hash值，判断是否和A树的某个hash值相同即可。 由于树hash涉及到去掉某个子树的贡献，建议使用异或的方式将每个子树的hash值合并起来，因为异或两次就等价于删除。如果要用进制的方式可能较为复杂。 异或的树hash较容易冲突，可以双hash或者选择一个合适的模数及种子。