---
title: " DTOJ3757修路\t\t"
tags:
  - Link-Cut Tree
url: 2472.html
id: 2472
categories:
  - DTOJ
  - Solution
  - 不会证
date: 2018-06-15 22:55:54
---

先考虑暴力的想法。 依次计算每条路的代价，这个代价显然是个逆序对问题。我们每次暴力从一个点跳到根，对每个点求逆序对即可。算完之后再跳到根暴力修改颜色。 这样的效率显然是$\\Theta(n^2)$的。 注意到我们可以把颜色相同的点压在一起求逆序对。直观上感受一下，因为每次都是把一个点到根的路径颜色改成相同的，那么每次不同的颜色数量应该不会太多。 然后据说是根据LCT的效率证明每次不同的颜色数量总和是$n\\log n$级别的。好像和access有关，反正我不会证（压根不懂LCT的复杂度分析）。好像ZJOI2018D1T2也是和access有关，出题人说这个是老套路了…… 正解也就是LCT。 每次相当于access($B_i$)，可以发现在同一条重链上的点颜色都相同。 那么我们每次暴力跳重链把每种颜色取出来，同样用树状数组求个逆序对即可。 修改颜色就相当于在access后在Splay上打个标记，每次下放标记即可。 时间复杂度应该是$\\Theta(n\\log^2 n)$。