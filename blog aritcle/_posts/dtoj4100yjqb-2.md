---
title: " DTOJ4100yjqb\t\t"
tags:
  - 平衡树
url: 6016.html
id: 6016
categories:
  - Solution
date: 2019-01-15 20:38:57
---

首先考虑暴力dp。$f\[i\]\[j\]$表示左部匹配到前$i$个点，右部最远匹配到$j$，当前最大匹配数。那么每次转移就是$f\[i-1\]\[1...l-1\] \\to f\[i\]\[l\], f\[i-1\]\[l...r-1\] \\to f\[i-1\]\[pos+1\]$

这相当于每次将$\[l,r\]$的dp值后移一位并逐位+1，在$l$处新插入一个dp值，为前面的最大值+1。

注意到$f\[i\]\[\]$肯定单调不降。那么将dp在差分下考虑。那么操作就是维护一串dp值，每次在$l$位置插入一个$+1$，然后删掉$r$位置后的第一个$+1$。

那么这就可以用splay直接维护了。