---
title: " DTOJ3928剪刀石头布\t\t"
tags:
  - 思路
url: 4118.html
id: 4118
categories:
  - Solution
date: 2018-10-15 19:20:45
---

考虑如何在确定$l,r,w\_a,w\_b,w\_c$的情况下确定局面。其中$w\_c=1-w\_a-w\_b$，也就是出布的概率。我们知道，由于期望是线性的，所以期望胜局等于每个人胜率的和。假设一个人出石头剪刀布的概率为$w\_a,w\_b,w\_c$，那么期望即是$E\_{l,r}=\\sum_{i=l}^{r}(w\_a\\times a\_i+w\_b \\times b\_i + w\_c \\times c\_i)$。然后我们要在$w\_a+w\_b+w\_c=1$的情况下使得$E\_{l,r}$最大。

首先有一个贪心选取的思路就是，使得$w\_a,w\_b,w_c$中最大项对应的$\\sum$最大。那么我们可以对于下列case取得取数方案：

*   当$\\sum_{i=l}^{r}a\_i$最大时，肯定取$w\_a=1,w\_b=w\_c=0$。
*   当$\\sum_{i=l}^{r}a\_i=\\sum\_{i=l}^{r}b\_i$最大时，肯定取$w\_c=0, \\forall w\_b w\_c, w\_b+w\_c=1$。
*   当$w\_a\\neq 0,w\_b \\neq 0,w\_c \\neq 0$，那么要求$\\sum\_{i=l}^{r}a\_i=\\sum\_{i=l}^{r}b\_i =\\sum\_{i=l}^{r}c_i$。显然其他情况做这个一定会更优。
*   当$w\_a\\neq 0,w\_b \\neq 0$,那么要有$ \\sum_{i=l}^{r}c\_i=\\sum\_{i=l}^{r}a\_i \\geq \\sum\_{i=l}^{r}b_i$。

明显在这里的题设里面保证了$w\_a,w\_b \\neq 0$，所以我们考虑最后两种情况即可。

处理所有符合条件的区间个数，关键在于加速预处理。记$Sa,Sb,Sc$分别为$a,b,c$的前缀和，那么考虑第二个情况的条件，即为$Sa\[r\]-Sa\[l-1\]=Sc\[r\]-Sc\[l-1\],Sa\[r\]-Sa\[l-1\] \\geq Sb\[r\]-Sb\[l-1\]$，即有$Sb\[r\]-Sa\[r\]=Sb\[l-1\]-Sa\[l-1\],Sb\[r\]-Sc\[r\] \\geq Sb\[l-1\]-Sc\[l-1\]$。

那么我们可以将所有$Sb-Sa$相同的拿出来，求这些中$Sb-Sc$的顺序对数目即可。

对于第一种情况，更有$Sb-Sc$相同。直接处理。