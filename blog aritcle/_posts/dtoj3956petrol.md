---
title: " DTOJ3956Petrol\t\t"
tags:
  - 最小生成树
  - 最短路
url: 4459.html
id: 4459
categories:
  - Solution
date: 2018-10-23 23:10:16
---

首先可以发现一个性质。就是只有加油站所在的点是有用的。我们称这些点为关键点，我们要求的是关键点之间的最小生成树，而限制即是关键点之间最小生成树上面的最大边小于所给定的油量上限。

求多个点出发的最短路的最小生成树效率并不科学。我们考虑在走的时候会有什么性质。

记$dis\[u\]$为距离$u$点最近的关键点。考虑$A \\to B$的路径，假设其中有一点上$dis\[x\] \\neq A or B$，那么从$A \\to C \\to B$一定更优，路径上耗费的油量最大值会更少。

那么我们得到，加进最小生成树上的边$(A,B)$，一定满足$A \\to B$的路径上，$dis\[x\]$仅属于$A$或$B$。

那么我们考虑用重构边求出图的最小生成树。

对于每个点，用最短路算法求出其到最近关键点的距离$dist\[x\]$，然后修改每条边的边权为$dist\[u\]+dist\[v\]+w$。拿这张图去做最小生成树，得出的答案和关键点间最短路的最小生成树是等价的。

为什么这个是等价的呢？我们不妨直接将路径拆成到一个点>走到最近的加油站>走到对面点>...的路径。假设原路径一定能走到，那么这样优化过的路径一定能走到，如果这样走不会更优，那么一定存在最近加油站过去的路径包含这两点。

从最小生成树的角度解释，两点之间取得最短路，我们让其强制包含一条边，一定会联结整条最短路上面的所有点。那么每条边就是两个关键点之间的一条可行路的边权，整条最小生成树路径上的最小边权也一定相同。

所以当两个关键点之间最短路长度小于$b$时，满足存在一条路径，使得路径上重构边长度均不大于$b$。

于是我们可以将$dist\[u\]+dist\[v\]+w$作为新边权，加进最小生成树中。同时离线询问，每次仅加入边权小于流量的边。那么最后判断两点是否联通就可以知道答案了。