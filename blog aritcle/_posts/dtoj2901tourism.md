---
title: " DTOJ2901tourism\t\t"
tags:
  - 思路
  - 树形dp
url: 4031.html
id: 4031
categories:
  - Solution
date: 2018-09-23 12:36:40
---

首先对于原图$dfs$一遍找出$dfs$树。那么可以得到，$dfs$树上的点深度不超过$10$并且所有非树边都是返祖边。

我们考虑在dfs树上做树形dp。难点在于要记下其到根上所有路径的状态，因为下面的点会对父亲的点有影响。但是由于返祖边的性质，我们发现当前状态只会包含当前点到根的这条链上的点，并且每次转移的时候是相邻深度的的点在转移。

于是我们记状态$f\[i\]\[S\]$为当前点深度为$i$，其到根所有点的状态为$S$。其中S需要记一个三进制状态：对于其中一位：

*   $0$表示当前点选了
*   $1$表示当前点未选，并且不满足条件
*   $2$表示当前点未选，但是已满足条件。  
    

由于深度不超过10，所以后面那个状态是$3^{10}$的。

转移的时候，对于当前点先考虑其父亲的影响。考虑这个点所有的返祖边指向的点。当前状态中假设这些点有$0$的状态，那么就可以有一个$2$的直接转移。另外就是当前点被选，那么上面所有未选且不满足条件的点，在选了这个点之后均可以变成已满足条件的状态。

然后考虑儿子的转移，对于每个儿子的dp值，是包含了当前这个儿子的子树已经全部满足条件，之前枚举到的所有儿子的子树全部满足条件并且记入到答案，上面所有点的状态为S的答案。那么转移的时候只需要在当前这个点有没有选之间取一个最小值就是当前点的答案了。

具体dp的时候还有一些交替转移与答案更新的技巧，具体可以看代码理解。