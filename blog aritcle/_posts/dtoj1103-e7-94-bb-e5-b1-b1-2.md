---
title: " DTOJ1103画山\t\t"
tags:
  - dp
url: 4895.html
id: 4895
categories:
  - DTOJ
  - Solution
date: 2018-10-31 20:20:52
---

直接dp的话，斜率相同的的线段会画出相同的图形，从而造成方案数算重。 因此我们要考虑斜率的影响。 我们先把所有线段的斜率求出来，然后离散去重，记一共有$tot$种斜率。 考虑dp。 记$f\[i\]\[j\]\[k\]$为当前画到$(i,j)$，最后画的线段的斜率是第$k$种的方案数。记$g\[i\]\[j\]=\\sum_{k=1}^{tot}f\[i\]\[j\]\[k\]$。 我们枚举最后一步画的线段在$x$轴上的投影长度为$x$，可以通过预处理求出用第$k$种斜率画出在$x$轴上投影长度为$x$的线段是否可行。 如果可行并且合法，记最后一步画的线段在$y$轴上的投影长度为$y$（可以通过斜率和$x$求出），有 $$g\[i-x\]\[j-y\]-f\[i-x\]\[j-y\]\[k\]\\Rightarrow f\[i\]\[j\]\[k\]$$ $-f\[i-x\]\[j-y\]\[k\]$就是去重，去掉画出相同图形的方案。 最后$g\[n\]\[0\]$就是答案。