---
title: " DTOJ3832能力强化\t\t"
tags:
  - dp
  - 奇技淫巧
  - 容斥
  - 期望
  - 概率
url: 3053.html
id: 3053
categories:
  - Solution
date: 2018-07-25 16:23:33
---

##### 模型转化1

首先要了解一个容斥：min-max容斥。在这里仅做简单介绍。 对于一个集合$S $，$min(S)$ 表示这个集合第一个出现的元素。 $max(S)$表示这个集合最后一个出现的元素。 那么会有： $$ E(max(S))=\\sum_{S'\\subseteq S} E(min(S')) \\times (-1)^{|S'|+1} $$ 那么在本题中，实质上，将能力达到上限看做是出现一个元素，$max(S)$就是所有能力均达到上限的期望了。 于是我们需要求的是$E(min(S))$。

##### 模型转化2

由于每种能力之间并没有区别，那么我们对于元素相同的S可以等同看待，最后乘上一个组合数表示选取了那几个能力就好了。 于是对于大小为$i$的集合$S$，要求的是$i$种能力中，有且仅有一种能力达到上限的期望步数，记为$f\_i$ 。 设$p\_{i,j}$为第$j$次恰好达到上限的概率，那么$f\_i=\\sum\_{j=1}^{\\infty} jp_{i,j}$ 发现貌似不是很好求。于是我们遇之则反，设$q_{i,j}$为第$j$次还没有达到上限的概率。 $$ \\begin{eqnarray} f\_i&=&\\sum\_{j=1}^{\\infty}jp_{i,j} \\newline &=&\\sum_{j=0}^{\\infty}q_{i,j} \\end{eqnarray} $$

##### 模型转化3

那么我们就要考虑$q_{i,j}$怎么求了。设$F(i,j)$为$i$种能力强化$j$次都没有达到上限的方案数目,$g\_i$为一个技能强化$i$次没达到上限的方案数 。 $g\_i$很好求出，至于$F(i,j)$，在转移的时候可以枚举增加一个人，增加多少步，插在那几个位置。那么写出转移就是 $$ f\[i+1\]\[j+k\] \\Longleftarrow f\[i\]\[j\]\\times g\[k\]\\times \\binom{j+k}{k} $$ 就可以求得$q_{i,j}$。 那么我们就可以求出$min(S)$了。注意到前面将所有大小为i的集合看做等同，因此计算的时候要乘上一个$\\binom{m}{i}$。 另外由于我们期望步数是求得作用在$i$个能力上的，因此计算答案的时候要考虑实际的期望步数应该要再乘上$\\frac{m}{i}$。将这些全部带进min-max容斥中就可以得出最后的答案了。