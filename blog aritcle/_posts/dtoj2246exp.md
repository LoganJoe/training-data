---
title: " DTOJ2246exp\t\t"
tags:
  - 容斥
  - 期望
  - 概率dp
url: 3101.html
id: 3101
categories:
  - DTOJ
  - Solution
  - 不会证
date: 2018-07-28 12:20:23
---

记$p\_i$为做$i$次操作后所有棋子都被染黑的概率，那么答案就是 $$ \\sum\_{i=1}^{\\infty}i\\times p\_i $$ 记$p'\_i$为做$i$次操作后所有棋子都还没被染黑的概率，那么有 $$ p' _ i =\\sum_{j=i+1}^{\\infty }p\_j $$ 那么我们把答案的式子化一下，会有 $$ \\sum\_{i=1}^{\\infty}i\\times p\_i=\\sum\_{i=1}^{\\infty}\\sum_{j=1}^{i}p\_i=\\sum\_{i=1}^{\\infty}\\sum_{j=i}^{\\infty}p\_j=\\sum\_{i=0}^{\\infty}p'\_i $$ 因此我们只用求$p'\_i$即可。 假设操作了$i$次后棋盘白格子的位置集合为$S$，记全是黑格子的区间有$x$个，那么这$i$次操作肯定都是操作在这$x$个区间上。记$m$为总区间个数，即$m=\\frac{n(n+1)}{2}$，那么就有 $$ p' _ i=\\sum_{S}(-1)^{|S|-1} \\times (\\frac{x}{m})^i $$ 多出来的容斥，是因为我们并不能保证不在$S$中的位置一定是黑格子，因此要容斥一下。（大概意会，并不会证） 那么答案就变成了 $$ \\sum_{i=0}^{\\infty}p' _ i=\\sum_{S}(-1)^{|S|-1}\\sum_{i=0}^{\\infty}(\\frac{x}{m})^i $$ 后面那个sigma显然是一个等比数列，因为$x<m$，所以可以变成$\\frac{1}{1-\\frac{x}{m}}$。 其实我们并不用知道集合$S$里的元素是什么，我们只需要知道$S$的大小的奇偶和$x$即可。 那么我们可以用dp求出对于不同的$x$和不同的奇偶对应的集合$S$的个数。 具体地，记$f\[i\]\[j\]\[0/1\]$表示前$i$个格子中，第$i$个格子是白的，可行的操作区间有$j$个（即当前$x=j$），一共有偶/奇个白格子。 枚举最后一个白格子的位置和$j$就可以代进容斥的式子里算答案了。