---
title: " DTOJ4080万叶\t\t"
tags:
  - 树形dp
url: 5706.html
id: 5706
categories:
  - DTOJ
  - Solution
  - 不会证
date: 2018-12-22 22:38:21
---

前几天刷cf刚遇到一道很怪的树上最大匹配的dp问题，测试时差点吓死。不过这道题良心很多。 较简单的树形dp，容易想出dp状态：$f\[x\]\[i\]\[0/1\]$为以$x$为根的子树中，最大匹配$\\%m=i$，其中$x$是否已经匹配的方案数。 转移时我们枚举以儿子$son​$为根的子树内的最大匹配$j​$，考虑$x\\rightarrow son​$的边是否要删掉，有 $$ f'\[x\]\[i\]\[0\]\\times f\[son\]\[j\]\[0\]\\Rightarrow f\[x\]\[(i+j)\\%m\]\[0\] $$ $$ f'\[x\]\[i\]\[0\]\\times f\[son\]\[j\]\[0\]\\Rightarrow f\[x\]\[(i+j+1)\\%m\]\[0\] $$ $$ 2\\times f'\[x\]\[i\]\[0\]\\times f\[son\]\[j\]\[1\]\\Rightarrow f\[x\]\[(i+j)\\%m\]\[0\] $$ $$ 2\\times f'\[x\]\[i\]\[1\]\\times f\[son\]\[j\]\[0\]\\Rightarrow f\[x\]\[(i+j)\\%m\]\[1\] $$ $$ 2\\times f'\[x\]\[i\]\[1\]\\times f\[son\]\[j\]\[1\]\\Rightarrow f\[x\]\[(i+j)\\%m\]\[1\] $$ $f'\[x\]\[i\]\[0/1\]$是未考虑以$son$为根的子树的方案数，$f\[x\]\[i\]\[0/1\]$则是考虑完的方案数。 最后$f\[1\]\[0\]\[0\]+f\[1\]\[0\]\[1\]$就是答案。 时间复杂度$\\Theta(nm^2)$，还不够优秀。 在求$f\[x\]\[i\]\[0/1\]$时，我们先令$size\[x\]=1$，然后每转移一个儿子$son$，就令$size\[x\]+=size\[son\]$。 我们在枚举$i,j$的时候令$2i\\leq size\[x\],2j\\leq size\[son\]$，然后就会发现跑的飞快。 这样实际上是$\\Theta(nm)$的。 $m^2$的dp转移不会发生超过$\\frac{n}m$次，具体不会证。