---
title: " DTOJ3880灌水\t\t"
tags:
  - dp
  - 思路
url: 3809.html
id: 3809
categories:
  - Solution
date: 2018-09-03 18:14:39
---

我们先来证明一个很重要的性质。

对于一个木块，其上面水的高度与其他木块是独立的。

我们想，对于一个木块，要凑出某个水的高度，一定是这个高度的木块在一侧，比这个高度高的木块在另外一侧。而在这两块中间，对于这个高度一定是任取的，换句话说，对于每块木块上面的水的合法高度序列，一定可以通过一个木块的重排来得到。

换个角度理解。容易发现对于一种方案，若该 木块对答案的贡献不是$−1$，那么我们可以将当前木块移到其的 某个相邻位置得到贡献。否则我们可以直接将这个木块移到边缘，再将新的木块放到老木块移走前的位置即可。

那么我们对于当前木块$i$，枚举所有可能的$h\_j-h\_i$,然后用这个更新dp。记$f_{i,j}$表示前$i$个木块是否可以凑出高度$j$,用bitset优化转移，时间效率是$O(\\frac{n^2l^2}{32})$。