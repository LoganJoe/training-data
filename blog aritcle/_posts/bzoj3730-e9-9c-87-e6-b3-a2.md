---
title: " BZOJ3730震波\t\t"
tags:
  - 动态点分治
url: 5825.html
id: 5825
categories:
  - BZOJ
  - Solution
date: 2018-12-28 18:20:48
---

在线询问与$x$距离$\\leq k$的点，我们可以用动态点分治。 具体地，我们先建出点分树，然后对于点分树上的每个点，我们开一棵线段树，线段树以到这个点的距离为下标，维护所有点的信息。在此题就是对于每个$d$，维护到每个点距离为$d$的点权和。 为了在计算时消除爬点分树时和儿子重复算的贡献，我们对于每个点还要再开一棵线段树，这棵线段树要以到这个点在点分树上的父亲的距离为下标，维护点权和。 修改$x$的点权时，我们从$x$开始往上跳点分树，然后根据$x$到当前点的距离来在线段树上单点修改。 查询$x$时，我们同样是从$x$开始跳点分树，然后根据$x$到当前点的距离在线段树上区间查询。 对于点$x$的线段树，下标范围不用开到$n$，只用开到点$x$子树中距离$x$最大的距离即可。 这样空间是$n\\log n$级别的。 预处理出欧拉序就可以$\\Theta(1)$查询两点之间的距离了。 时间复杂度$\\Theta(n\\log ^2n)$。