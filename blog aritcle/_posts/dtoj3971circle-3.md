---
title: " DTOJ3971circle\t\t"
tags:
  - 倍增
  - 矩阵
url: 4820.html
id: 4820
categories:
  - DTOJ
  - Solution
date: 2018-10-30 22:41:30
---

点数最小的正环一定不会经过重复的边。（$a\\rightarrow b$和$b\\rightarrow a$算两条边） 先考虑暴力，我们枚举一个起点$S$。 记$f\[i\]\[j\]$为从$S$出发走$i$步到$j$的最大边权和。 枚举一条边然后直接转移即可。 转移就是 $$f\[i\]\[j\]+e\[j\]\[k\]\\Rightarrow f\[i+1\]\[k\]$$ 起点为$S$的答案就是使得$f\[i\]\[S\]>0$成立的最小的$i$。 考虑优化。 我们发现这个转移可以写成矩阵的形式，而每走一步就相当于乘一次邻接矩阵，只不过原来乘法中的乘变成加，原来的加变成取$\\max$。 那么$e^k\[i\]\[j\]$就是从$i$到$j$走$k$步最大的边权和。 我们可以用矩阵快速幂在$\\Theta(n^3\\log k)$内求出$e^k$。 那么我们就可以二分答案+矩阵快速幂判断，时间复杂度$\\Theta(n^3\\log ^2 n)$。 但是这样还是过不去。 我们可以用类似[DTOJ2842Wycieczki](http://www.dtenomde.com/author=jiangyutong/article=4530/)的方法。 我们先求出$e^{2^i}$，其中$i\\in\[0,9\]$。 然后用倍增求出答案。 我们从大到小枚举$i$，然后考虑在当前答案的基础上多走$2^i$步能否找到一个正环。如果不能找到，说明至少还要走$2^i$步，那么就把当前答案$+2^i$。否则就枚举更小的$i$去尝试。 时间复杂度$\\Theta(n^3\\log n)$。跑不满，可以过。