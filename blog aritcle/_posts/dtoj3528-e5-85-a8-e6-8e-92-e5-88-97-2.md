---
title: " DTOJ3528全排列\t\t"
tags:
  - dp
url: 696.html
id: 696
categories:
  - Solution
date: 2018-02-19 20:54:00
---

由于相似的性质，我们只要求这个取出来的这一段“长得类似”即可，即我们认为排列1,6,4,7，只要可以以“a,a+5,a+3,a+6”的类似的形式表示的排列均符合要求。 然后我们要考虑对一个长度为n的排列去取。 设$F_{i j}为长度为i，逆序对个数为j的排列个数。这个的答案十分显然，明显新丢一个数进去让他有j个逆序对，假设当前是第rank大，那么需要原来有j-rank个逆序对。为$f\[i\]\[j\]=\\sum_{k=0}^{i-1}f\[i-1\]\[j-k\]$ 接下来我们考虑答案如何统计： 因为是逆序对个数不超过e的个数，所以对于某个长度i，我们可以将所有逆序对长度0-e的全都sigma起来。由于这个长度为i的串可以取遍（n-i+1）个位置，所以答案要乘上n-i+1。i个数是任取的，于是需要乘上$\\binom{n}{i}$.对于当前的每个情况，该排列的其他n-i个位置均可任意排列。因此最后答案为： $$\\sum_{i=1}^{n}{ (n-i+1)*(\\frac{n!}{i!})^2 \\sum _{i=0}^{k}F_{ij}}$$