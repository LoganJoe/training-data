---
title: " DTOJ1365长跑\t\t"
tags:
  - 并查集
  - 思路
url: 5502.html
id: 5502
categories:
  - DTOJ
  - Solution
date: 2018-12-14 23:07:08
---

网上题解一搜全部都是LCT真可怕。实际上只需要并查集+树状数组+倍增LCA即可解决。 先考虑在一张连通图上进行操作。 首先在一个边双里的点，我们一定是可以全部经过的。 那么我们可以把边双缩起来，将点权变成边双里所有点的权值和。这样我们就得到了一棵树。 我们要在树上查询两点之前的点权和。那么我们可以维护根到每个点的点权和，然后作差相减一下即可得到任意两点之间的点权和。 对于修改，影响的是根到子树内所有的点的点权和，那么我们用树状数组区间加减维护即可。 还有就是加边。 加边会使得某些点变成新的一个边双连通分量。具体地，在$a,b$之间加一条边，会使得$a$到$b$路径上所有点变成一个新的边双，因此我们要将这些点缩起来。 缩点的操作可以用并查集实现，将$a,b$路径上的点在并查集内的父亲全部指向$LCA(a,b)$即可。注意缩点的时候要记得将点权合并。 现在我们考虑初始没有边的情况。问题就在于我们没有缩完边双后的树了。 但我们可以先搞出一棵树来啊。 具体地，我们先把会加的所有边存下来，然后按顺序去建出一棵生成树。 我们可以将这棵树当作我们初始的树，加入非树边时我们就可以开始用并查集缩点了。由于树边是按时间顺序一条条加入的，因此在加入非树边时，非树边所处的连通块的树边一定是在之前被加入的。 注意在查询时，如果两个点此时还不在同一个连通块中要输出$-1$。