---
title: " DTOJ1387雨天的尾巴\t\t"
tags:
  - 线段树合并
url: 1099.html
id: 1099
categories:
  - DTOJ
  - Solution
date: 2018-03-19 19:22:28
---

发放粮食可以看做从$1$到$x$和$1$到$y$发一袋$z$类型的粮食，再从$1$到$x$和$y$的$lca$，$1$到$lca$的父亲回收一袋$z$类型的粮食。也就是给每个点打上不同类型的$+1,-1$的标记，然后询问每个子树内哪种类型的标记和最大。 对于每个点，我们以类型为下标，动态开一棵线段树，存每种类型标记的和的最大值。显然这个信息是可以合并的。 那么每个点的答案就是把以这个点为根的子树里的所有线段树合并起来后，线段树根节点的最大值。 那我们自底向上合并线段树，就可以知道每个点的答案了。 注意初始的时候给每个点开一个空的线段树，但线段树的根节点不能为空，否则很容易出事。