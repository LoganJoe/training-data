---
title: " DTOJ4170「PKUWC2018」猎人杀\t\t"
tags:
  - NTT
  - 分治
  - 概率
url: 7005.html
id: 7005
categories:
  - Solution
date: 2019-03-17 11:48:34
---

这题的概率，由于分母在不断变化，所以很不好求。 由于 $1$ 号可能不是最后一个被杀的，我们容斥一下$1$号之后至少有几个没被杀。首先令$A=\\sum_{i=1}^{n}w\_i$,枚举集合$S$,并令$S$表示在$1$之后被杀的$w\_i$的和： 但是分母依然会改变。我们假设每个人被杀以后依旧存在，但是选中的时候，我们用一次反选消除他的贡献。那么$S$的概率就可以计算： $$ \\begin{aligned} P_{(s)} &=\\sum_{i=0}^{\\infty}\\left(1-\\frac{S+w\_1}{A}\\right)^i\\frac{w\_1}{A}\\\ &=\\frac{w\_1}{A}\\times \\frac{1}{1-1+\\frac{S+w\_1}{A}}\\\ &=\\frac{w\_1}{S+w\_1} \\end{aligned} $$ 那么我们只需要对于每个$S$的值，处理出相应的系数即可。 但是$\\sum w\_i \\le 10^5$，而我们考虑每个$w\_i$相当于是一个背包贡献的形式。我们可以用多项式处理。那么对于每一个$x​$的系数和可以处理成多个生成函数卷积的形式。 那么我们就是要求 $$ \\prod_{i=2}^{n}(1-x^{w_i}) $$ 分治NTT即可。