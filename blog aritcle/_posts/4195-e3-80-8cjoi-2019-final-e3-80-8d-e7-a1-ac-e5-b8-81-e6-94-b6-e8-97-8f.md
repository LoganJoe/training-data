---
title: " 4195「JOI 2019 Final」硬币收藏\t\t"
tags:
  - 思路
url: 6887.html
id: 6887
categories:
  - Solution
date: 2019-03-08 16:23:05
---

首先考虑怎么走能取到最优的答案。 由于每个块到最后位置所要耗费的代价是曼哈顿距离。那么我们先将所有棋子移到$2\\times n$块内距离其最近的那个格子，总代价不会被影响。 现在问题变成了在$2 \\times n$格子内移动棋子，使得最大代价最小。 很明显这是一个二分图带权匹配问题。可以费用流直接跑出来。但是这并不能通过$n \\le 10^5$的测试点。 考虑对于两行顺次推过去，维护使得前面能归位的全部归位的代价。分别维护一个变量$cnt0,cnt1$，表示前面有多少个棋子没有安置或者有多少个空棋子。假设当前有空棋子那么一定可以放，一行有空棋子并且一行有棋子没有安置则要将多余的棋子填到另外一行。现在使得前面的代价最优，剩余的棋子一定要被后面的做贡献，并且付出$|cnt0|+|cnt1|$的代价，表示将棋子移动到后面或者移动到前面的空位置的代价。可以发现，这就是最优的放法了。