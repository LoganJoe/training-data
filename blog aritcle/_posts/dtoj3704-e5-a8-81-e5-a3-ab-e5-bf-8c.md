---
title: " DTOJ3704威士忌\t\t"
tags:
  - 二分
  - 线段树
url: 1973.html
id: 1973
categories:
  - DTOJ
  - Solution
date: 2018-05-15 08:05:58
---

先将粉丝按$a\_i$排序，显然当$a\_0\\in(a\_i,a\_{i+1}\]$时，$b\_0,c\_0$的方案数都是一样的。 考虑如何计算这个时候的方案数。 对于在$i$及$i$之前的粉丝$j$，一定有$a\_0>a\_j$，那么只要满足$b\_0>b\_j$和$c\_0>c\_j$其一。 对于在$i$之后的粉丝$j$，一定有$a\_0\\leqslant a\_j$，那么要满足$b\_0>b\_j$和$c\_0>c\_j$。 如果把一组合法的$(b\_0,c\_0)$看作二维平面上的一个点，那么对于$i$及$i$之前的粉丝$j$，使$b\_0\\leqslant b\_j$且$c\_0\\leqslant c\_j$的点都不合法。对于$i$之后的粉丝$j$，限制了$b\_0>b\_j$且$c\_0>c\_j$。 那么限制就变成了两种：某些矩形内的点不能选，选的点一定要被所有另一种矩形包含。 记$Maxb\_i$为$i\\sim n$的$b\_i$最大值，$Maxc\_i$同理。那么第二种限制就变成了选的点一定要被左下角在$(Maxb\_i+1,Maxc_i+1)$，右上角在$(q,r)$的矩形包含。 我们维护第一种限制的矩形的并，那么现在要求的就是一个矩阵中没有被覆盖的面积，可以通过差分变成一个左下角在原点的矩形中没有被覆盖的面积。 第一种限制的矩形的并，可以用线段树+线段树上二分解决。具体地，以$y$为下标建线段树，维护每个$y$上$x$被覆盖到哪。显然$y$递增的时候，线段树上的值是非增的。那么插入一个矩形时，我们可以在线段树上二分出最小的能被更新的$y$，然后在线段树上区间覆盖即可。查询也是同理，只要维护线段树上区间和然后二分查询即可。 因此我们只要在枚举$i$的同时，不断插入一个矩形，更新线段树，然后在线段树上查询即可以解决这道题。