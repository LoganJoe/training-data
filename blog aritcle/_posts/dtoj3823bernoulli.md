---
title: " DTOJ3823bernoulli\t\t"
tags:
  - 思路
  - 数学
url: 2851.html
id: 2851
categories:
  - DTOJ
  - Solution
date: 2018-07-19 22:52:52
---

这个$K$次方使得我们肯定不可能按位拆开来算。 那我们只能考虑按位或有什么优美的性质。 我们发现$\[0,2^k)$里的每一个数和$x$异或，得到的值恰好也是$\[0,2^k)$里的每一个数。 记$Solve(n,m)$为我们要求的答案。不妨设$n\\geqslant m$。 我们先将$n,m$二进制拆分，然后分两种情况讨论。

*   $n,m$位数不同。记$n$的位数为$k$，那么显然$i$能取到$\[0,2^{k-1})$里的每一个数，$j$可以取$\[0,m\]$的每一个数，那么这部分的答案可以预处理一个数$K$次方的前缀和直接算。 接着考虑$i$取$\[2^{k-1},n\]$里的某个数的情况，显然异或的最高位一定为$1$了，那么这部分的答案与$i$取$\[0,n-2^{k-1}\]$的计算差不多，只是在计算前缀和的时候要手动加上$2^{k-1}$。 那么我们可以把加的值存下来，在算前缀和的时候手动加上。这样我们就可以把$Solve(n,m)$变成求$Solve(n-2^{k-1},m)$了。
*   $n,m$位数相同。记位数为$k$，和前面类似的方法，先求$i,j$都取$\[0,2^{k-1})$的情况。 然后求$i$取$\[0,2^{k-1})$，$j$取$\[2^{k-1},m\]$的情况。 再求$i$取$\[2^{k-1},n\]$，$j$取$\[0,2^{k-1})$的情况。 最后就只剩下$i$取$\[2^{k-1},n\]$，$j$取$\[2^{k-1},m\]$的情况了，显然此时异或的最高位一定为$0$，那么这部分的答案就是$Solve(n-2^{k-1},m-2^{k-1})$了。

递归求解即可，其实也可以写成非递归的形式。