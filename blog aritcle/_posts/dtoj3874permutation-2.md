---
title: " DTOJ3874permutation\t\t"
tags:
  - 线段树
url: 3795.html
id: 3795
categories:
  - Solution
date: 2018-09-03 16:52:03
---

难点是要求字典序最大。我们可以贪心处理。

对于点$i$，可以连出的点一定是$p_{pos\_i+1}$,或者$pos\_i$左边的某个数$x$。其中，要和$x$连起来，说明$x-pos\_i$之间已经存在一个环。那么这些数的出边已经固定了。我们记这些为$mark\_1$。否则，假若向$p_{pos\_i+1}$连边，那么这个数一定和左边的数成环了。我们记这些为$mark\_2$。由上，我们可以讨论出一个点要如何连边。

现在考虑字典序最大的限制。那么我们就是要在合法给定的区间内找到最大的$x$。而之间要可以连边，一定得保证保证$x$到$pos\_i$之间经过的数中没有已经被固定的。并且$x$不需要和$x$左边的数在一个环中。那么我们用线段树来查询区间最大值，对于$mark\_1$，我们赋值为$\\infty$。对于$mark_2$，我们赋值为$0$。合法的区间我们可以用map维护，相当于用set维护一组以$first$为关键字的pair<pos,value>组。然后在map上面lowerbound第一个infty就好了。

对于每个位置，直接输出决策，并且用并查集维护相关性即$mark_2$。