---
title: " DTOJ3226荒芜废墟\t\t"
tags:
  - dp
  - 思路
  - 矩阵
url: 5629.html
id: 5629
categories:
  - DTOJ
  - Solution
date: 2018-12-17 13:22:05
---

发现数据范围很奇怪，$m\\leq 3$，且$t\_i,k=2^a\\times 3^b,0\\leq a,b\\leq 5$，而$n$又很大。 可能什么东西，是有规律的，或者有循环的。 经过研究发现，$2^5\\times 3^5=7776$。也就是说，每$7776$个位置中，能到达的点的相对位置都是相同的。 其实可能比$7776$还小，实际上是$lcm(t\_i,k)$。 我们称位置$\[1,lcm\]$为第$1$块，$\[lcm+1,2lcm\]$为第$2$块，接下来同理。 既然块与块是相同的，考虑一块一块地计算方案数，并且优化。 记$f\[i\]\[j\]$为从某块的第$i$个位置，走到下一块第$j$个位置的方案数。为了不重复计算，我们要求第一步走到的位置一定要$>k$。$f\[i\]\[j\]$显然可以通过简单dp求出。 那么我们发现这是一个矩阵的形式，通过矩阵快速幂优化，我们可以求出从第$1$块的第$i$个位置，走到最后一块的第$j$个位置的方案数。 从$1$走到第$1$块和最后一块走到$n$的方案数我们暴力dp计算一下即可。