---
title: " JZOJ6009Counting\t\t"
tags:
  - dp
  - 思路
url: 6168.html
id: 6168
categories:
  - Solution
  - 其他OJ
date: 2019-01-24 14:29:52
---

我们考虑直接构造能力效果的序列。 对于一个序列，一定有一种构造方法是每次加边后都是一些点形成了一个大的强连通分量，剩下每个强连通分量都是一个点。 这样我们就可以开始考虑dp了。 记$f\[i\]\[j\]\[k\]$表示当前填到序列的第$i$位，大的强连通分量有$j$个点（也就是一共有$n-j+1$个强连通分量），大的强连通分量合并过$k$次（可以理解成序列中有$k$个不同的数）。 显然要保证$j(j-1)+\\frac{(n-j)(n-j-1)}2+j(n-j)\\geq i$，不然强分量分量的个数一定$<n-j+1$。 同样要保证$j-1+k\\leq i$，因为形成$j$个点的强连通分量至少要$j$条边，每合并一次需要多一条边，$-1$是扣掉初始的一号点。 我们考虑这次要不要合并一些点到大强连通分量里即可转移，具体地，有 $$ f\[i\]\[j\]\[k\]=f\[i-1\]\[j\]\[k\]+\\sum_{s=1}^{j-1}f\[i-1\]\[s\]\[k-1\] $$ 容易发现这个可以用前缀和优化。时间复杂度$\\Theta(n^4)$。