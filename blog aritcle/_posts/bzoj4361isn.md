---
title: " BZOJ4361isn\t\t"
tags:
  - dp
  - 计数
url: 6777.html
id: 6777
categories:
  - Solution
date: 2019-03-03 14:55:53
---

考虑计算长度为$k$的不降子序列数量，然后再容斥掉对于已经是不降的子序列做操作的部分。 设$f\[i\]\[j\]$为当前选到第$i$个元素，第$i$个元素必选，长度为$j$的不降子序列方案数。直接枚举前面选的元素可以$O(n^3)$转移。考虑对于每个位置维护一个dp的树状数组，就可以将转移效率优化到$O(n^2\\log)$。 $h\[i\]=\\sum_{j=1}^n f\[j\]\[i\]$ 表示从中选取一个不降子序列的方案数。接下来考虑容斥：对于长度为$i$的子序列，如果操作不合法，那么之前一定是一个长度为$i+1$的子序列。考虑删数的过程带有顺序，那么我们枚举哪个数是在已经得到长度为$i+1$的子序列以后再被删去的，于是就有 $$ ans=\\sum_{i=1}^n(h\[i\]\\times (n-i)!-h\[i+1\]\\times (n-i-1)!\\times (i+1)) $$ 时间复杂度还是$O(n^2 \\log)$。