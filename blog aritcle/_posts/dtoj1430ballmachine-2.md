---
title: " DTOJ1430ballmachine\t\t"
tags:
  - 倍增
  - 思路
  - 线段树
url: 3404.html
id: 3404
categories:
  - Solution
date: 2018-08-12 16:27:46
---

首先要知道的是，删去一个球，会发生滚动的球肯定是这个球到根路径上的所有球，最后被删去的是最上面的那颗球。

于是，我们首先跑出奇怪的dfs序，每次dfs先走有编号最小点的子树。那么，每次加球，一定是加到一段连续的dfs序上的点。

由于每次只删去一个球，所以一共加球的个数不会很多。最多会加n+Q个球，于是我们每次暴力加球，找到dfs序上第一个没球的位置加球。这个可以用线段树维护。加最后一个球的时候输出位置。查询我们可以倍增找到最上面的球并且删掉。然后输出两个点之间deep的差就好了。