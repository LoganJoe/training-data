---
title: " BZOJ2510弱题\t\t"
tags:
  - 奇技淫巧
  - 期望
  - 概率
  - 矩阵
url: 6340.html
id: 6340
categories:
  - BZOJ
  - Solution
date: 2019-02-05 17:59:21
---

考虑经过一次操作后会变成怎么样。我们考虑标号为$i$的球的数量变化。 如果抽到了标号为$i$的球，那么数量$-1$，也就是有$\\frac {a\_i}M$的概率变成$a\_i-1$。 如果抽到了标号为$i-1$的球，那么数量$+1$，也就是有$\\frac{a_{i-1}}M$的概率变成$a\_i+1$。 否则数量不变。 那么标号为$i​$的球的期望个数就变成了 $$ \\frac{a\_{i}}M(a\_i-1)+\\frac{a\_{i-1}}{M}(a\_i+1)+(1-\\frac{a\_i}M-\\frac{a_{i-1}}M)a\_i $$ 化简可得 $$ \\frac 1 M a\_{i-1}+(1-\\frac 1 M)a\_i $$ 我们可以构造一个矩阵来更新每个$a\_i$，这样就可以用矩阵快速幂来加速了。 矩阵大概长这样： ![](http://www.dtenomde.com/wp-content/uploads/2019/02/DFB95F8A-F8A9-4D80-92FE-CE07EB168AD2.jpg) 这样时间复杂度是$\\Theta(N^3\\log K)$的。 发现这个矩阵长的十分有规律：每行循环右移一位变成下一行。 这种矩阵叫做循环矩阵。 循环矩阵自乘若干次后仍然是循环矩阵，这说明我们只用维护矩阵的任意一行即可。 这样时间复杂度就变成了$\\Theta(N^2\\log K)$，已经可以通过了。 有意思的是，两个循环矩阵相乘其实是对维护的那行做了一次卷积。这说明我们还可以用FFT加速卷积，可以做到$\\Theta(n\\log n\\log K)$。