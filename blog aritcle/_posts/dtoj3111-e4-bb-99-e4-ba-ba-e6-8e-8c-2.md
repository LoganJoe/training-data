---
title: " DTOJ3111仙人掌\t\t"
tags:
  - 思路
  - 树形dp
url: 3825.html
id: 3825
categories:
  - Solution
date: 2018-09-03 23:36:04
---

对于在环上，上面的点不可能再被覆盖。因为无论如何连出来的都不是仙人掌了。

于是我们把环拆掉，那么剩下的就是一堆森林了。我们考虑计算一个森林的答案。最后的答案就是乘法原理合并的答案。

对于点$x$，我们考虑计算$f\[x\]$为$x$的子树连边形成一个仙人掌的方案数。

*   假设$x$为根，那么这个子树一定不会和祖先连边。
*   $x$是根外其他点，这个子树有可能和祖先连边。

对于第一种不连的情况，我们只需要简单地将所有儿子的$f\[v\]$乘起来，算上$x$的儿子之间互相连边的情况，乘起来就是当前点的答案了。

否则对于第二种情况，我们强制每个结点的子树必须向外连一条边（显然最多一条），我们发现这个方案数只和儿子节点个数有关，递推式是：

$$g\[i\]=g\[i-1\]+(i-1)*g\[i-2\]$$

接下来我们删掉环以后分讨就可以了。