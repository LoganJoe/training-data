---
title: " DTOJ2603不稳定的传送门\t\t"
tags:
  - 思路
  - 期望
url: 3476.html
id: 3476
categories:
  - DTOJ
  - Solution
date: 2018-08-17 22:03:47
---

考虑dp，记$f\[i\]$为$i$到$N$的期望最短路。 那么对于一个传送门，我们有 $$f\[s\]=\\min(f\[s\],w+pf\[t\]+(1-p)f\[s\])$$ 同时我们有$f\[i\]=f\[i+1\]+c\_i(i<n)$。 那么对于每个点$i$，我们要决定起点为$i$的传送门的选择顺序，来求出一个最优的$f\[i\]$。 我们考虑两个传送门的顺序，如果先选第一个传送门再选第二个传送门，那么代价是 $$w\_1+p\_1f\[t\_1\]+(1-p\_1)(w\_2+p\_2f\[t\_2\])+(1-p\_1)(1-p\_2)f\[s\]$$ 如果先选第二个再选第一个，那么代价是 $$w\_2+p\_2f\[t\_2\]+(1-p\_2)(w\_1+p\_1f\[t\_1\])+(1-p\_1)(1-p\_2)f\[s\]$$ 我们记$cost\_i=w\_i+p\_if\[t\_i\]$。 那么如果$p\_1cost\_2>p\_2cost\_1$即$\\frac{cost\_1}{p\_1}<\\frac{cost\_2}{p\_2}$，先选择第一个传送门更优。 那么我们按照$\\frac{cost\_i}{p_i}$从小到大排序，依次代进式子算期望即可。 最终$f\[1\]$就是答案。 注意，如果你代码写的是这样↓

for(int j=0;j<S\[i\].size();j++)
	e=S\[i\]\[j\],f\[i\]=min(f\[i\],e.v+e.p\*f\[e.to\]+(1-e.p)\*f\[i\]);

那么实际上要从大到小排序。 因为这个for实际上是倒着尝试传送门的，当前$f\[i\]$的值是试了第$j$个传送门后失败的期望最短路。