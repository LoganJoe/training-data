---
title: " DTOJ1923Axonometric Projection\t\t"
tags:
  - dp
  - 思路
url: 3119.html
id: 3119
categories:
  - DTOJ
  - Solution
date: 2018-07-28 14:21:37
---

这是一道很…神奇的题目。 首先要知道，我们打乱给的数列的顺序，答案是不变的。这个应该是挺好理解的，可以当做交换了建筑的两行/两列。 那么我们把给的数列从小到大排序。 记排完序后左视图第$i$个数为$a\_i$，正视图第$i$个数位$b\_i$，记$h_{i,j}=\\min(a\_i,b\_j)$。 显然$h_{i,j}$就是$(i,j)$这个格子上合法的最大高度。 那么$h$中相同的数字会聚集在一起，形成一个L形（或者退化成一个矩形）。 大概长这样：![](http://www.dtenomde.com/wp-content/uploads/2018/07/7BC86ADF-542B-4173-B116-1B79982C9722.jpg) 一个L形中最大能填的数字是相同的，而每个L形之间相互独立，因此我们可以分别算每个L形的方案数，最后再乘起来。 记当前L形最大能填的数是$L$，L形中行列重合的有$R$行$C$列，没重合的有$L1$行和$L2$列。 如图：![](http://www.dtenomde.com/wp-content/uploads/2018/07/5726FCE0-4D88-4CEF-A114-3565D343509A.jpg) 我们要求的就是满足前$R$行中每行有一个$H$，前$C$列中每列有一个$H$的方案数（左下角为第$1$行第$1$列）。 我们可以用dp求解：记$f\[i\]\[j\]$为前$i$行填完，且已经有$j$列有一个$H$的方案数。 那么我们可以枚举下一行要新满足几列，也就是枚举要填几个$H$在没填过$H$的列上，然后其他列可以随便填，转移系数大概就是一个组合数乘上$H$的幂。 注意前$R$行转移和后$L1$行转移的不同。前$R$行转移时一定要保证每行都填了一个$H$，而后$L1$行就不用。前$R$行和后$L1$行每行的长度也不一样，求方案数的时候要注意。 由于细节太多转移就不写出来了…… 如果L形退化成矩形的话方案数就不用dp算了，直接快速幂加加减减即可。但我不知道用dp算会不会出错。 那么求一个$L$形的方案数的时间复杂度是$\\Theta((R+L1)C^2)$。总的复杂度不是很会算，反正上界是$\\Theta(n^3)$，可以过。