---
title: " DTOJ1731排斥反应\t\t"
tags:
  - 思路
  - 状压dp
  - 矩阵
url: 3660.html
id: 3660
categories:
  - DTOJ
  - Solution
date: 2018-08-27 22:42:04
---

这题真是神奇。 考虑这样一个表格，第一行第一列为$1$，然后往右走一格就$+p$，往下走一格就$+q$。 比如下图就是$p=5,q=6$的例子。

1

6

11

16

21

26

7

12

17

22

27

2

13

18

23

28

3

8

19

24

29

4

9

14

25

30

5

10

15

20

然后你就发现，$1\\sim pq$中每个数都出现了一次，这是为什么呢？ 发现题目中有个看起来很没有用的性质：$p,q$互质。 显然每列都$\\%p$都相同，而当$x\\in\[0,p)$时，$xq\\%p$是显然两两不同的。 同理每行都$\\%q$都相同，当$x\\in\[0,q)$时，$xp\\%q$是显然两两不同的。 那么$1\\sim pq$中的一个数$x$，都可以通过$x\\%p$所属的行和$x\\%q$所属的列来确定唯一的一个位置。 这样的话，我们发现，题目可以转换成：给一个$p\\times q$的表格，表格上下相接且左右相接，求选出若干个互不相邻的数的方案数。 注意到$p\\leq 10$。 那么我们可以状压每一行的选择状态，然后利用状压dp求解。 由于$q$很大，我们可以利用矩阵快速幂来加速。 这样时间复杂度是$\\Theta(2^{3p}\\log q)$的，还是无法通过此题。 注意到$2^p$种状态中，会有很多是不合法的（选了相邻的数）。 枚举所有合法情况后发现，当$p=10$时，合法状态也只有$123$种。 那么时间复杂度就变成了$\\Theta(123^3\\log q)$，可以通过。