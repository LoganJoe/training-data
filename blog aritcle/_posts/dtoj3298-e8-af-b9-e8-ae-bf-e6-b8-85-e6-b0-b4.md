---
title: " DTOJ3298诹访清水\t\t"
tags:
  - 线段树
  - 莫队
url: 4301.html
id: 4301
categories:
  - Solution
date: 2018-10-21 15:30:52
---

对于浇水的一个点，水流过的点是在dfs序上面连续的一段区间。影响到的部分是dfs序上区间内叶子的数量。

由于是对一段区间浇水，而区间内点的子树的dfs序区间可能会有交集。于是我们用莫队来解决这个问题。

维护以dfs序为下标的线段树。节点上记录这段区间被覆盖的次数。当覆盖次数大于0的时候这段区间内的叶子节点数就可以被算入答案。否则我们就计算其左右儿子中可以被算入答案的叶子节点个数。

那么莫队在推区间端点的时候，其操作就相当于区间的加减，答案可以在pushup的时候顺便计算。

时间复杂度$O(n \\log n)$。