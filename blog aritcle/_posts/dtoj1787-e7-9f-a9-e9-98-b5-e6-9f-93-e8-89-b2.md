---
title: " DTOJ1787矩阵染色\t\t"
tags:
  - 数学
url: 436.html
id: 436
categories:
  - DTOJ
  - Solution
date: 2018-01-31 21:32:41
---

推一下式子发现有$f(i)=m(m-1)(m^2-3m+3)^{i-1}$。 令$t=m^2-3m+3$，则答案为

$\\frac{2^mm(m-1)}{t}\\sum_{i=1}^{n}t^ii^m$

令$S_{n,m}=\\sum_{i=1}^{n}t^ii^m$，则变成了求$S_{n,m}$。 对于$n\\leqslant 10^5$可以暴力算。 对于$p\\leqslant 10^3$，发现$t^i$在$%p$意义下有长度为$p-1$的循环节，$i^m$在$%p$意义下有长度为$p$的循环节。因此$t^ii^m$在$%p$意义下一定有一个长度不超过$(p-1)p$的循环，算出前$(p-1)p$项就可以了。 对于$m\\leqslant 10^3$，这个推导就比较巧妙了。

$S_{n+1,m}=t+\\sum_{i=1}^{n}t^{i+1}{i+1}^m$

$S_{n,m}+t^{n+1}(n+1)^m=t+t\\sum_{i=1}^{n}t^i{i+1}^m$

$S_{n,m}+t^{n+1}(n+1)^m=t+t\\sum_{i=1}^{n}t^i\\sum_{j=0}^{m}C_{m}^{j}i^j$

$S_{n,m}+t^{n+1}(n+1)^m=t+t\\sum_{i=0}^{m}C_{m}^{j}S_{n,i}$

发现如果所有的$S_{n,i}$都已知，就可以解方程求出$S_{n,m}$。 而$S_{n,0}$其实是等比数列求和，可以直接求出。因此我们就可以递推出$S_{n,m}$。