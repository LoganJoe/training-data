---
title: " DTOJ3758轰炸\t\t"
tags:
  - 树形dp
  - 线段树合并
url: 2492.html
id: 2492
categories:
  - DTOJ
  - Solution
date: 2018-06-16 18:47:47
---

记$f\[i\]\[j\]$为覆盖了$i$的子树和$i$到深度为$j$的祖先的最小代价。 枚举子树转移。记$i$的一个儿子为$son$，那么有 $$f\[i\]\[j\]+f\[son\]\[k\]\\Rightarrow f'\[i\]\[min(j,k)\]$$ 对于一个$j$，和所有$\\geqslant j$的$k$都能转移到$f'\[i\]\[j\]$。 因此对于固定的$j$，能选择的$k$是一段后缀。 同理对于固定的$k$，能选择的$j$也是一段后缀。 那么我们考虑线段树合并。 只要在合并的过程中顺便维护一下$f\[i\]$和$f\[son\]$的后缀最小值即可。 注意要打加法标记，要记得下放。 实际上，我们并不用维护后缀最小值。 对于一个固定的$j$，如果和所有可能的$k$都转移到$f'\[i\]\[j\]$，最终答案是不会变的。我们可以认为给$f\[i\]$做了一个前缀$min$，显然这是不影响正确性的。 那么我们可以先查询$f\[i\]$和$f\[son\]$的最小值，然后直接线段树合并即可。