---
title: " BZOJ4399魔法少女LJJ\t\t"
tags:
  - 线段树合并
url: 6701.html
id: 6701
categories:
  - BZOJ
  - Solution
date: 2019-02-27 20:09:20
---

注意看题。 希望你看到了$c\\leq 7$。不然你就被4399玩了（雾）。 考虑操作$6$，权值之积肯定很大，不能直接维护。 这时候就要用到一个小技巧，我们可以要乘的每个数取个对数，那么乘法就变成了加法，也就是变成了比较对数和的大小。 我们对于每个连通块开一棵权值线段树，维护每种权值出现的数量和对数和。 连接两个点时如果合并了两个连通块，那么就进行一次线段树合并。 操作$3,4$就是查询一段区间的数的个数、区间清零和单点加，打个清零标记即可。不过据说好像暴力清零的复杂度也是对的。 操作$5$就是找第$k$小，在线段树上二分即可。 操作$6$就是查询连通块内所有数的对数和，直接在线段树上查即可。 时间复杂度$\\Theta(n\\log n)$。 注意有点卡空间！ 网上别人的程序线段树开$18n$过了，我开$18n$MLE了！得开$16n$才过呜呜呜。