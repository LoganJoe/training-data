---
title: " DTOJ3124开锁\t\t"
tags:
  - dp
  - 概率
url: 3713.html
id: 3713
categories:
  - DTOJ
  - Solution
date: 2018-08-28 12:41:02
---

傻逼出题人。 上帝视角告诉你用db存组合数然后求合法方案数再转化成概率不会错，好了傻逼题。 虽然的确很傻逼还是讲一下吧。 对于每个$i$，由$i$向$a\_i$连边。那么就形成了若干个环。 记有$m$个环，那么能打开所有盒子的条件就是每个环中至少有一个盒子被魔法打开了。 我们考虑dp。 即$f\[i\]\[j\]$为前$i$个环中，有$j$个盒子被魔法打开，且每个环中至少有一个盒子被魔法打开的方案数。 那么有 $$f\[i\]\[j\]\\times \\binom{size\_{i+1}}{s}\\Rightarrow f\[i+1\]\[j+s\]$$ 即枚举新的环中有几个盒子被魔法打开了。其中，$size_i$为第$i$个环的大小。 最终答案就是$\\frac{f\[m\]\[k\]}{\\binom{n}{k}}$。