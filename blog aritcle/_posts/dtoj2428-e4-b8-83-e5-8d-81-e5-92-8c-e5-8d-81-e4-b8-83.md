---
title: " DTOJ2428七十和十七\t\t"
tags:
  - dp
  - 思路
url: 2054.html
id: 2054
categories:
  - DTOJ
  - Solution
date: 2018-05-23 21:32:42
---

我们先研究一下对于某个排列，计数器的值有什么特点。 记$f\[i\]$为在一个有序的数列末尾加入一个第$i$大的数（不是最大的数），计数器增加的值。 显然有 $$f\[i\]=1+\\sum_{j=1}^{i-1}f\[j\]$$ 发现$f\[1\]=1,f\[2\]=2,f\[3\]=4…$显然$f\[i\]=2^{i-1}$。 记$g\[i\]$为长度为$i$的所有排列排序后计数器的值。那么答案就是$\\frac{g\[n\]}{n!}$。 考虑如何求$g\[i\]$。 考虑最后一位的数是$j$，对于前$i-1$位的共$(i-1)!$种情况，排完序后计数器的值一共会增加$g\[i-1\]$。 那么有 $$g\[i\]=i\\times g\[i-1\]+(i-1)!\\sum_{j=1}^{i-1}f\[j\]$$ 即 $$g\[i\]=i\\times g\[i-1\]+(i-1)!\\sum_{j=0}^{i-2}2^j$$ $$g\[i\]=i\\times g\[i-1\]+(i-1)!\\times (2^{j-1}-1)$$ 那么预处理阶乘和阶乘的逆元即可。