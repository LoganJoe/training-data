---
title: " DTOJ2488象棋游戏\t\t"
tags:
  - 无标签
url: 2073.html
id: 2073
categories:
  - DTOJ
  - Solution
date: 2018-05-25 22:59:29
---

每次移动可以看做先拿走一个棋子，再放一个棋子。 先考虑如何维护被攻击的棋子个数。 对于第$i$行，记这行的异或值为$val$，那么只要列异或值不为$val$的列与这行的交点都会被攻击。那么我们可以通过维护列异或值为$val$的列数来计算这行不会被攻击的棋子个数。 那么第$i$列不会被攻击的棋子个数也同理。注意这样同一个格子会被算两次。 每行每列的异或值可以离散后用数组存下，每种异或值的行数列数可以用map维护。 现在考虑放一个权值为$v$棋子在$(x,y)$带来的影响。 显然第$x$行和第$y$列的异或值改变了，每种异或值的行数列数也改变了。 那么只要减去之前第$x$行和第$y$列会被攻击的棋子个数，再加上放完这个棋子后第$x$行和第$y$列会被攻击的棋子个数即可。注意到$(x,y)$这个格子会被考虑两次。 拿走一个棋子可以看做在同一个位置放一个同样权值的棋子，因为异或两个相同的值就抵消了。当然和放棋子一样写个删棋子也行。