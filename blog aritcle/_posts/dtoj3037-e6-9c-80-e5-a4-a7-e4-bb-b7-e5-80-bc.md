---
title: " DTOJ3037最大价值\t\t"
tags:
  - 二分
  - 平衡树
url: 3428.html
id: 3428
categories:
  - DTOJ
  - Solution
date: 2018-08-12 20:59:33
---

见过好几次这题了，上次还又听了一遍Solution，还写到一半，这次测试遇到血赚233 对于选好的物品，我们贪心地想，肯定把$a\_i$小的放前面最优。 那么我们可以先让所有物品按$a\_i$从小到大排序。 那么我们可以很容易想到一个$\\Theta(n^2)$的dp：记$f\[i\]\[j\]$为前$i$个物品中选$j$个的最大价值。 那么有 $$f\[i\]\[j\]=\\max(f\[i-1\]\[j\],f\[i-1\]\[j-1\]+a\_i(j-1)+b\_i)$$ 对于同一个$i$不同的$j$，显然前一段的$f\[i\]\[j\]$是从$f\[i-1\]\[j\]$转移来，后一段的$f\[i\]\[j\]$是从$f\[i-1\]\[j-1\]$转移来。 大概就是如果选$j$个的最优方案里选了第$i$个物品，那么选$j+1$个的最优方案里也会选第$i$个物品。 那么$f\[i-1\]$转移到$f\[i\]$，就可以看作复制前面一段，然后后面一段往后移动一位并加上公差为$a\_i$的等差数列，中间再塞入一个新的数。 而两端的分界点我们是可以二分的。 由于要插入一个数，我们可以用平衡树维护。 但是维护等差数列过于麻烦，我们把$f\[i\]\[j\]$差分一下，即记$g\[i\]\[j\]=\\max(g\[i-1\]\[j\],g\[i-1\]\[j-1\]+a\_i)$，那么就相当于在$g$数组上区间加。 $f$数组的分界点和$g$数组的分界点是一样的，那么我们维护$g$数组即可。 二分可以在平衡树上二分。 Splay真是一个厉害的数据结构，插入可以强行塞一个点，只要瞎splay一下就能平衡。 时间复杂度$\\Theta(n\\log n)$。