---
title: " DTOJ2455有趣的有趣的家庭菜园\t\t"
tags:
  - dp
  - 线段树
url: 6495.html
id: 6495
categories:
  - DTOJ
  - Solution
date: 2019-02-20 20:54:44
---

显然我们保留的是一个不降子序列然后接着一个不升子序列。我们可以枚举不降子序列和不升子序列的交界点，这样我们就只需要求出以每个位置结尾/开头的最优不降子序列/不升子序列。 记$f\[i\]$为以$i$结尾的不降子序列的最大收益，$g\[i\]$为以$i$开头的不升子序列的最大收益。 考虑转移，我们枚举子序列的上一个位置$j$。 $$ f\[i\]=\\max_{j=0}^{i-1}\\{f\[j\]+cost(j+1,i)\\}+P\_i $$ 其中$cost(j+1,i)=\\sum \\limits\_{k=j+1}^{i-1}\[H\_k>H\_i\]C\_k$，也就是拔掉$\[i+1,j\]$不符合要求的草的代价。 我们以高度为下标建一棵线段树，每个位置上维护以这种高度转移过来的最小代价。 求完某个$f\[i\]$后，我们对线段树上的区间$\[1,H\_i)$减去$C\_i$，代表在这之后从$\[1,H\_i)$转移的代价都增加了$C\_i$。 你可能会想，$cost$的值和$H\_i$也有关，如果前面的某个$H\_j$给区间$\[1,H\_j)$全部减去了$C\_j$，然后我后面的某个$H\_i$从$k(k<H\_j)$转移过来的代价不就错了吗？ 我们会发现，此时从$k$转移过来一定不是最优的，从$H\_j$转移过来一定会比从$k$转移过来优。 所以这种情况不会影响到最优答案。 因此我们可以用线段树优化dp转移，$g\[i\]$也同理（倒着做就好了），时间复杂度$\\Theta(n\\log n)$。