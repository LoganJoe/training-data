---
title: " DTOJ3688毒瘤\t\t"
tags:
  - 思路
  - 树形dp
  - 虚树
url: 5920.html
id: 5920
categories:
  - Algorithm
date: 2019-01-01 14:28:47
---

一眼看过去：仙人掌上最大独立集？？？ 可惜它不是仙人掌。一个点可以属于一个以上的简单环。 考虑跑出dfs树，多余边化为非树边。考虑非树边链接的两个点会受到非树边影响。其余点不会被影响。 那么枚举某条非树边选或不选，可以得到所有的关键点选或不选。而剩下的就是一个带限制的树上最大独立集dp。 但是这样的效率是$O(2^{m-n}n)$。看着就跑不过去。事实上，这个可以拿到75分。 考虑对于所有的关键点建出虚树。那么虚树上一条边有固定的转移系数。具体地，对于$f\[u\]\[0/1\]$,从$f\[v\]\[0/1\]$转移到$f\[u\]\[0/1\]$，中间没有关键点，其转移系数是恒定的： $$ f\[u\]\[0\] \\Leftarrow f\[u\]\[0\] * (1ll * w0.a\*f\[v\]\[0\] % mod + w0.b\*f\[v\]\[1\]) f\[u\]\[1\] \\Rightarrow f\[u\]\[1\] * (1ll * w1.a\*f\[v\]\[0\] % mod + w1.b\*f\[v\]\[1\]) $$； 其中，$w0$和$w1$对应的是从某条边上转移上来的转移系数。这个结论很好想到：对于虚树上面的其他点，其对于答案的贡献一直是恒定的。 于是效率就变成了虚树的效率:$O(2^{m-n}2(m-n))$。 注意到这题只有一棵虚树，因此我们可以在一遍dfs中顺带把虚树建出来，省掉了栈和求lca的过程。