---
title: " DTOJ2293幻想乡开店\t\t"
tags:
  - 动态点分治
url: 3936.html
id: 3936
categories:
  - Solution
date: 2018-09-15 16:24:36
---

题目所求的是给定的某个点到权值范围内的点的距离和。我们不考虑点权的要求，先只考虑 到各点距离和 要如何计算。

每次我们进行树分治的时候，我们是对于一个根，计算从根出发到块内树各点的距离。而对于一个点的点分树，其到根路径上的所有点的块都会计算一次该点的答案。

然后由于我每次做一块的时候会重复计算这个子树内的答案，于是我们每次上跳，都要减去当前块内点到父亲的距离和。还要加上上个重心到这个重心的距离乘以点的个数。

然后这样就可以处理各点距离和了。考虑点权的限制怎么解决。把点权存下来，每个重心保存其子树内的所有情况，按点权排序，每次就求$\[1,R\]-\[1,L-1\]$上的答案，相当于是每次求一个前缀和就可以了。