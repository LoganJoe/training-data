---
title: " DTOJ2827矩阵\t\t"
tags:
  - 二维树状数组
url: 2165.html
id: 2165
categories:
  - DTOJ
  - Solution
date: 2018-03-05 20:31:35
---

（可以说是很气了我居然忘记写了这道题的题解） 关于子矩阵的问题很容易想到用二维前缀和拆成四个同类型的问题。 先考虑矩阵加，我们可以拆成以$(0,0)$为一个顶点的四个矩阵加上某个数，假如我们要在$(0,0)$到$(x,y)$的矩阵全部加上$v$，我们可以视为在$(x,y)$打上$+v$的标记。 再考虑询问，同样可以拆成以$(0,0)$为一个顶点的四个矩阵的和，假如我们要求的是$(0,0)$到$(a,b)$的矩阵和。 显然只有$x\\leqslant a,y\\leqslant b$的$(x,y)$标记才会对$(0,0)$到$(a,b)$的矩阵和产生贡献。具体地，在$(x,y)$在$+v$标记，会对矩阵的和产生的贡献是$(a-x+1)(b-y+1)$。 化简一下，发现是$(a+1)(b+1)v-(b+1)xv-(a+1)yv+xyv$。 那么我们只要维护$(0,0)$到$(a,b)$的$v,xv,yv,xyv$的和即可。 可以用二维树状数组完成。 注意到空间限制是400MB，而我们要开$4n^2$的数组，刚好被卡了233 发现模数很小，可以想到用short，然而好像还是不行。 正解是开char，但char的范围是$\[-128,128)$。因此，开unsigned char即可！ 没想到吧。